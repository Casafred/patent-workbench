# 功能八v5.0 部署验证指南

## 📋 快速检查清单

### 1️⃣ 确认本地文件正确 ✅

```bash
# 检查文件行数
wc -l js/drawingMarkerInteractive.js
# 预期: 608 行

# 检查版本标识
head -10 js/drawingMarkerInteractive.js
# 预期: 包含 "v5.0"

# 检查Git状态
git log --oneline -1
# 预期: 878d740 功能八v5.0完整交互版本
```

**✅ 本地验证通过**:
- 文件行数: 608
- 版本: v5.0
- Git提交: 878d740
- 编码: UTF-8
- 中文注释正常

### 2️⃣ 服务器部署步骤

#### 连接服务器
```bash
ssh root@47.115.230.206
```

#### 进入项目目录
```bash
cd /www/wwwroot/ipx.asia
```

#### 拉取最新代码
```bash
git pull origin main
```

#### 验证文件
```bash
# 检查文件行数
wc -l js/drawingMarkerInteractive.js

# 查看版本
head -10 js/drawingMarkerInteractive.js

# 查看Git提交
git log --oneline -1
```

#### 重启服务
```bash
# 重启应用
sudo systemctl restart patent_app

# 重启Nginx
sudo systemctl reload nginx

# 检查服务状态
sudo systemctl status patent_app
sudo systemctl status nginx
```

### 3️⃣ 清除缓存

#### 浏览器缓存
1. **Chrome/Edge**: 
   - Ctrl + Shift + Delete
   - 选择"缓存的图片和文件"
   - 点击"清除数据"

2. **强制刷新**:
   - Ctrl + F5
   - 或 Ctrl + Shift + R

3. **开发者工具**:
   - F12 打开开发者工具
   - Network标签
   - 勾选"Disable cache"
   - 刷新页面

#### Nginx缓存（如果配置了）
```bash
# 清除Nginx缓存
sudo rm -rf /var/cache/nginx/*
sudo systemctl reload nginx
```

### 4️⃣ 功能测试

#### 基础功能
- [ ] 访问 https://ipx.asia
- [ ] 进入功能八（专利附图标记）
- [ ] 上传一张附图
- [ ] OCR识别成功
- [ ] 标注显示正常

#### 主界面交互（新功能）
- [ ] **拖拽标注**: 鼠标按住标注文字，拖动到新位置
- [ ] **双击编辑**: 双击标注文字，弹出编辑框
- [ ] **右键删除**: 右键点击标注，确认删除
- [ ] **标注列表**: 右侧显示所有标注列表

#### 弹窗交互（新功能）
- [ ] 点击"放大查看"按钮
- [ ] **缩放范围**: 滑块可以从10%拖到1000%
- [ ] **拖拽标注**: 在弹窗中拖动标注位置
- [ ] **拖拽背景**: 按住图片空白处拖动背景
- [ ] **字体调整**: 字体大小滑块从12px到48px
- [ ] **双击编辑**: 双击标注编辑
- [ ] **右键删除**: 右键删除标注

#### 同步测试
- [ ] 主界面修改标注 → 弹窗中同步显示
- [ ] 弹窗中修改标注 → 关闭后主界面同步
- [ ] 删除操作双向同步

## 🔍 故障排查

### 问题1: 页面没有变化
**可能原因**: 浏览器缓存
**解决方案**: 
1. Ctrl + Shift + Delete 清除缓存
2. Ctrl + F5 强制刷新
3. 开发者工具 → Network → Disable cache

### 问题2: 功能不完整
**可能原因**: 服务器文件未更新
**检查方法**:
```bash
# 服务器上执行
cd /www/wwwroot/ipx.asia
git log --oneline -1
# 应该显示: 878d740

# 检查文件
head -10 js/drawingMarkerInteractive.js
# 应该包含: v5.0
```

### 问题3: 缩放范围还是50%-500%
**可能原因**: 加载了旧版本JS
**解决方案**:
1. 检查HTML引用: `frontend/index.html` 第1551行
   ```html
   <script src="../js/drawingMarkerInteractive.js?v=20260130"></script>
   ```
2. 清除浏览器缓存
3. 检查服务器文件版本

### 问题4: 无法拖拽标注
**可能原因**: JS文件未正确加载
**检查方法**:
1. F12 打开开发者工具
2. Console标签查看错误
3. Network标签查看JS文件是否加载
4. 确认文件大小（应该约30KB）

## 📊 版本对比验证

### v4.0 特征
- 缩放范围: 50%-500%
- 主界面: 静态显示
- 弹窗: 只能缩放，不能拖拽

### v5.0 特征（应该看到的）
- 缩放范围: 10%-1000%
- 主界面: 可拖拽、编辑、删除
- 弹窗: 可拖拽标注、拖拽背景、调整字体

## 🎯 关键验证点

### 1. 缩放滑块
打开弹窗后，缩放滑块应该能够：
- 向左拖到10%（图片变得很小）
- 向右拖到1000%（图片变得很大）

### 2. 拖拽操作
- **主界面**: 鼠标按住标注文字，可以拖动
- **弹窗**: 
  - 按住标注文字 → 拖动标注
  - 按住图片空白处 → 拖动背景

### 3. 编辑删除
- **双击标注** → 弹出输入框
- **右键标注** → 弹出删除确认

### 4. 标注列表
右侧应该显示标注列表，包含：
- 标注编号和名称
- 定位按钮
- 编辑按钮
- 删除按钮

## 📝 测试用例

### 测试用例1: 基础拖拽
1. 上传附图，OCR识别
2. 在主界面拖动一个标注
3. 打开弹窗，确认标注位置已同步
4. 在弹窗中拖动标注到新位置
5. 关闭弹窗，确认主界面已同步

### 测试用例2: 编辑功能
1. 双击主界面的标注
2. 修改名称，确认
3. 打开弹窗，确认名称已同步
4. 在弹窗中双击标注
5. 再次修改名称
6. 关闭弹窗，确认主界面已同步

### 测试用例3: 删除功能
1. 右键点击主界面的标注
2. 确认删除
3. 打开弹窗，确认标注已消失
4. 在弹窗中右键删除另一个标注
5. 关闭弹窗，确认主界面已同步

### 测试用例4: 缩放和字体
1. 打开弹窗
2. 拖动缩放滑块到10%
3. 确认图片变小
4. 拖动缩放滑块到1000%
5. 确认图片变大
6. 拖动字体滑块到12px
7. 确认标注文字变小
8. 拖动字体滑块到48px
9. 确认标注文字变大

## ✅ 部署成功标志

当你看到以下所有功能时，说明v5.0部署成功：

1. ✅ 缩放滑块可以到10%和1000%
2. ✅ 主界面可以拖拽标注
3. ✅ 主界面可以双击编辑
4. ✅ 主界面可以右键删除
5. ✅ 弹窗可以拖拽标注
6. ✅ 弹窗可以拖拽背景
7. ✅ 弹窗可以调整字体大小
8. ✅ 标注列表显示并可操作
9. ✅ 所有修改双向同步

## 🚨 如果还是不行

### 最后的杀手锏
```bash
# 服务器上强制更新
cd /www/wwwroot/ipx.asia
git fetch origin
git reset --hard origin/main
sudo systemctl restart patent_app
sudo systemctl reload nginx
```

### 浏览器端
1. 关闭所有标签页
2. 清除所有浏览数据（时间范围选"全部"）
3. 重启浏览器
4. 重新访问网站

## 📞 需要帮助？

如果按照以上步骤操作后仍有问题，请提供：
1. 服务器上 `git log --oneline -1` 的输出
2. 服务器上 `head -10 js/drawingMarkerInteractive.js` 的输出
3. 浏览器开发者工具 Console 的错误信息
4. 具体哪个功能不工作

---

**最后更新**: 2026-01-30
**版本**: v5.0
**提交**: 878d740
