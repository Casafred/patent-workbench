<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒåˆ©è¦æ±‚å¯è§†åŒ–UIä¿®å¤æµ‹è¯•</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        
        #claims_visualization_container {
            width: 100%;
            height: 600px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: #fafafa;
        }
        
        .controls {
            margin-bottom: 20px;
        }
        
        .controls button {
            margin-right: 10px;
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .controls button:hover {
            background: #0056b3;
        }
        
        .info {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æƒåˆ©è¦æ±‚å¯è§†åŒ–UIä¿®å¤æµ‹è¯•</h1>
        
        <div class="info">
            <strong>æµ‹è¯•ç›®æ ‡ï¼š</strong>
            <ul>
                <li>éªŒè¯æƒåˆ©è¦æ±‚å¼•ç”¨å…³ç³»æ˜¯å¦æ­£ç¡®ï¼ˆç‹¬ç«‹æƒåˆ©è¦æ±‚ä½œä¸ºæ ¹èŠ‚ç‚¹ï¼‰</li>
                <li>éªŒè¯èŠ‚ç‚¹ç‚¹å‡»åæ˜¯å¦æ˜¾ç¤ºæ­£ç¡®çš„å¼¹çª—è¯¦æƒ…</li>
                <li>éªŒè¯å¼¹çª—æ ·å¼å’Œå†…å®¹æ˜¯å¦æ­£ç¡®æ˜¾ç¤º</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h3>æµ‹è¯•æ•°æ®</h3>
            <div id="test-data-info"></div>
        </div>
        
        <div class="test-section">
            <h3>å¯è§†åŒ–æ§åˆ¶</h3>
            <div class="controls">
                <button onclick="testVisualization()">ç”Ÿæˆæµ‹è¯•å¯è§†åŒ–</button>
                <button onclick="testModalDialog()">æµ‹è¯•æ¨¡æ€æ¡†</button>
                <button onclick="clearVisualization()">æ¸…é™¤å¯è§†åŒ–</button>
            </div>
        </div>
        
        <div class="test-section">
            <h3>æƒåˆ©è¦æ±‚å…³ç³»å›¾</h3>
            <div id="claims_visualization_container"></div>
        </div>
        
        <div class="test-section">
            <h3>æµ‹è¯•ç»“æœ</h3>
            <div id="test-results"></div>
        </div>
    </div>

    <script src="js/claimsProcessorIntegrated.js"></script>
    <script>
        // æµ‹è¯•æ•°æ®
        const testData = {
            patent_number: 'CN202510001A',
            nodes: [
                {
                    id: 'claim_1',
                    claim_number: 1,
                    claim_text: 'ä¸€ç§æ™ºèƒ½æ‰‹æœºï¼ŒåŒ…æ‹¬å¤„ç†å™¨å’Œå­˜å‚¨å™¨ã€‚',
                    claim_type: 'independent',
                    level: 0,
                    dependencies: []
                },
                {
                    id: 'claim_2',
                    claim_number: 2,
                    claim_text: 'æ ¹æ®æƒåˆ©è¦æ±‚1æ‰€è¿°çš„æ™ºèƒ½æ‰‹æœºï¼Œå…¶ç‰¹å¾åœ¨äºè¿˜åŒ…æ‹¬æ‘„åƒå¤´ã€‚',
                    claim_type: 'dependent',
                    level: 1,
                    dependencies: [1]
                },
                {
                    id: 'claim_3',
                    claim_number: 3,
                    claim_text: 'æ ¹æ®æƒåˆ©è¦æ±‚2æ‰€è¿°çš„æ™ºèƒ½æ‰‹æœºï¼Œå…¶ç‰¹å¾åœ¨äºæ‘„åƒå¤´å…·æœ‰å…‰å­¦é˜²æŠ–åŠŸèƒ½ã€‚',
                    claim_type: 'dependent',
                    level: 2,
                    dependencies: [2]
                },
                {
                    id: 'claim_4',
                    claim_number: 4,
                    claim_text: 'æ ¹æ®æƒåˆ©è¦æ±‚1æ‰€è¿°çš„æ™ºèƒ½æ‰‹æœºï¼Œå…¶ç‰¹å¾åœ¨äºè¿˜åŒ…æ‹¬æŒ‡çº¹è¯†åˆ«æ¨¡å—ã€‚',
                    claim_type: 'dependent',
                    level: 1,
                    dependencies: [1]
                }
            ],
            links: [
                {
                    source: 'claim_1',
                    target: 'claim_2',
                    type: 'dependency'
                },
                {
                    source: 'claim_2',
                    target: 'claim_3',
                    type: 'dependency'
                },
                {
                    source: 'claim_1',
                    target: 'claim_4',
                    type: 'dependency'
                }
            ],
            metadata: {
                total_claims: 4,
                independent_claims: 1,
                dependent_claims: 3
            }
        };
        
        let renderer = null;
        
        function displayTestData() {
            const infoDiv = document.getElementById('test-data-info');
            infoDiv.innerHTML = `
                <p><strong>ä¸“åˆ©å·ï¼š</strong>${testData.patent_number}</p>
                <p><strong>æƒåˆ©è¦æ±‚æ€»æ•°ï¼š</strong>${testData.metadata.total_claims}</p>
                <p><strong>ç‹¬ç«‹æƒåˆ©è¦æ±‚ï¼š</strong>${testData.metadata.independent_claims}</p>
                <p><strong>ä»å±æƒåˆ©è¦æ±‚ï¼š</strong>${testData.metadata.dependent_claims}</p>
                <p><strong>é¢„æœŸå…³ç³»ï¼š</strong></p>
                <ul>
                    <li>æƒåˆ©è¦æ±‚1ï¼ˆç‹¬ç«‹ï¼‰â†’ æƒåˆ©è¦æ±‚2ï¼ˆä»å±ï¼‰</li>
                    <li>æƒåˆ©è¦æ±‚2ï¼ˆä»å±ï¼‰â†’ æƒåˆ©è¦æ±‚3ï¼ˆä»å±ï¼‰</li>
                    <li>æƒåˆ©è¦æ±‚1ï¼ˆç‹¬ç«‹ï¼‰â†’ æƒåˆ©è¦æ±‚4ï¼ˆä»å±ï¼‰</li>
                </ul>
            `;
        }
        
        function testVisualization() {
            try {
                // åˆå§‹åŒ–æ¸²æŸ“å™¨
                if (!renderer) {
                    renderer = new ClaimsD3TreeRenderer('claims_visualization_container');
                }
                
                // æ¸²æŸ“å¯è§†åŒ–
                renderer.render(testData, 'tree');
                
                addTestResult('âœ… å¯è§†åŒ–ç”ŸæˆæˆåŠŸ', 'success');
                addTestResult('è¯·ç‚¹å‡»èŠ‚ç‚¹æµ‹è¯•æ¨¡æ€æ¡†åŠŸèƒ½', 'info');
                
            } catch (error) {
                console.error('å¯è§†åŒ–æµ‹è¯•å¤±è´¥:', error);
                addTestResult(`âŒ å¯è§†åŒ–ç”Ÿæˆå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function testModalDialog() {
            try {
                // æµ‹è¯•æ¨¡æ€æ¡†æ˜¾ç¤º
                const testClaimData = testData.nodes[0];
                showClaimsClaimModal(testClaimData);
                
                addTestResult('âœ… æ¨¡æ€æ¡†æµ‹è¯•æˆåŠŸ', 'success');
                
            } catch (error) {
                console.error('æ¨¡æ€æ¡†æµ‹è¯•å¤±è´¥:', error);
                addTestResult(`âŒ æ¨¡æ€æ¡†æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function clearVisualization() {
            const container = document.getElementById('claims_visualization_container');
            container.innerHTML = '';
            renderer = null;
            addTestResult('ğŸ§¹ å¯è§†åŒ–å·²æ¸…é™¤', 'info');
        }
        
        function addTestResult(message, type) {
            const resultsDiv = document.getElementById('test-results');
            const resultItem = document.createElement('div');
            resultItem.className = type;
            resultItem.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            resultsDiv.appendChild(resultItem);
        }
        
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæµ‹è¯•æ•°æ®
        document.addEventListener('DOMContentLoaded', function() {
            displayTestData();
            addTestResult('ğŸ“‹ æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ', 'info');
        });
        
        // ç›‘å¬æ¨¡æ€æ¡†å…³é—­äº‹ä»¶
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                addTestResult('âŒ¨ï¸ ESCé”®å…³é—­æ¨¡æ€æ¡†', 'info');
            }
        });
    </script>
</body>
</html>