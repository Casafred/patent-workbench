<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»„ä»¶åŠ è½½å™¨æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        button {
            padding: 8px 16px;
            background: #4a6cf7;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #3a5ce7;
        }
        #component-target {
            min-height: 100px;
            background: #f9f9f9;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
        .log {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª ç»„ä»¶åŠ è½½å™¨æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>æµ‹è¯•1: åŠ è½½æµ‹è¯•ç»„ä»¶</h3>
            <button onclick="testLoadComponent()">åŠ è½½ç»„ä»¶</button>
            <button onclick="clearTarget()">æ¸…ç©º</button>
            <div id="component-target"></div>
        </div>

        <div class="test-section">
            <h3>æµ‹è¯•2: åŠ è½½ä¸å­˜åœ¨çš„ç»„ä»¶ (é”™è¯¯å¤„ç†)</h3>
            <button onclick="testLoadNonExistent()">åŠ è½½ä¸å­˜åœ¨çš„ç»„ä»¶</button>
        </div>

        <div class="test-section">
            <h3>æ§åˆ¶å°æ—¥å¿—</h3>
            <div id="log" class="log"></div>
        </div>
    </div>

    <script src="js/core/component-loader.js"></script>
    <script>
        // æ‹¦æˆªconsole.logä»¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
        const logDiv = document.getElementById('log');
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        function addLog(type, ...args) {
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
            ).join(' ');
            
            const logEntry = document.createElement('div');
            logEntry.style.color = type === 'error' ? 'red' : type === 'warn' ? 'orange' : 'black';
            logEntry.textContent = `[${type.toUpperCase()}] ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog('log', ...args);
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addLog('error', ...args);
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addLog('warn', ...args);
        };

        // æµ‹è¯•å‡½æ•°
        async function testLoadComponent() {
            console.log('å¼€å§‹æµ‹è¯•: åŠ è½½ç»„ä»¶');
            // åˆ›å»ºä¸€ä¸ªç®€å•çš„æµ‹è¯•ç»„ä»¶
            const testHtml = '<div style="padding: 10px; background: #e3f2fd; border-radius: 4px;"><strong>âœ“ æµ‹è¯•ç»„ä»¶åŠ è½½æˆåŠŸ!</strong><br>è¿™æ˜¯ä¸€ä¸ªåŠ¨æ€åŠ è½½çš„HTMLç»„ä»¶ã€‚</div>';
            
            // æ¨¡æ‹Ÿç»„ä»¶æ–‡ä»¶ (å®é™…åº”ç”¨ä¸­ä¼šä»æœåŠ¡å™¨åŠ è½½)
            const blob = new Blob([testHtml], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            const success = await loadComponent(url, 'component-target');
            console.log('åŠ è½½ç»“æœ:', success ? 'æˆåŠŸ' : 'å¤±è´¥');
            
            URL.revokeObjectURL(url);
        }

        async function testLoadNonExistent() {
            console.log('å¼€å§‹æµ‹è¯•: åŠ è½½ä¸å­˜åœ¨çš„ç»„ä»¶');
            const success = await loadComponent('frontend/components/non-existent.html', 'component-target');
            console.log('åŠ è½½ç»“æœ:', success ? 'æˆåŠŸ' : 'å¤±è´¥ (é¢„æœŸ)');
        }

        function clearTarget() {
            document.getElementById('component-target').innerHTML = '';
            console.log('å·²æ¸…ç©ºç›®æ ‡åŒºåŸŸ');
        }

        console.log('ç»„ä»¶åŠ è½½å™¨æµ‹è¯•é¡µé¢å·²å°±ç»ª');
    </script>
</body>
</html>
