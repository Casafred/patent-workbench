<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ ‡è®°å¸ƒå±€ç®—æ³•æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 6px;
        }
        canvas {
            border: 2px solid #ddd;
            margin: 10px 0;
            display: block;
        }
        .info {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 14px;
        }
        .legend {
            display: flex;
            gap: 20px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ æ ‡è®°å¸ƒå±€ç®—æ³•æµ‹è¯• - ä¸‰åˆ†ä¹‹ä¸€è·ç¦»ç§»åŠ¨</h1>
        
        <div class="info">
            <strong>æ–°ç®—æ³•è¯´æ˜ï¼š</strong>
            <ul>
                <li>æ ‡è®°æ–‡å­—æ¡†åˆå§‹ä½ç½®åœ¨è¯†åˆ«å‡ºæ¥çš„æ ‡è®°æ—è¾¹</li>
                <li>ç„¶åå‘ç¦»è¯¥åæ ‡æœ€è¿‘çš„åŸå›¾è¾¹ç•Œç§»åŠ¨<strong>ä¸‰åˆ†ä¹‹ä¸€</strong>çš„è·ç¦»</li>
                <li>è¿™æ ·æ—¢ä¸ä¼šå¤ªè¿œç¦»æ ‡è®°ç‚¹ï¼Œä¹Ÿä¸ä¼šå¤ªé è¿‘è¾¹ç•Œ</li>
            </ul>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #FF5722;"></div>
                <span>æ ‡è®°ç‚¹ï¼ˆçº¢è‰²åœ†ç‚¹ï¼‰</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #2196F3;"></div>
                <span>æ–‡å­—æ ‡ç­¾ï¼ˆè“è‰²ï¼‰</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #4CAF50;"></div>
                <span>è¿æ¥çº¿ï¼ˆç»¿è‰²ï¼‰</span>
            </div>
        </div>

        <div class="test-section">
            <h3>æµ‹è¯•åœºæ™¯1ï¼šå››ä¸ªè§’è½çš„æ ‡è®°</h3>
            <canvas id="canvas1" width="800" height="600"></canvas>
        </div>

        <div class="test-section">
            <h3>æµ‹è¯•åœºæ™¯2ï¼šè¾¹ç¼˜ä¸­å¿ƒçš„æ ‡è®°</h3>
            <canvas id="canvas2" width="800" height="600"></canvas>
        </div>

        <div class="test-section">
            <h3>æµ‹è¯•åœºæ™¯3ï¼šéšæœºåˆ†å¸ƒçš„æ ‡è®°</h3>
            <canvas id="canvas3" width="800" height="600"></canvas>
        </div>
    </div>

    <script>
        // æ–°çš„å¸ƒå±€ç®—æ³•å®ç°
        function calculateLabelPosition(markerX, markerY, canvasWidth, canvasHeight, textWidth, textHeight) {
            // è®¡ç®—åˆ°å„è¾¹ç•Œçš„è·ç¦»
            const distances = {
                top: markerY,
                right: canvasWidth - markerX,
                bottom: canvasHeight - markerY,
                left: markerX
            };
            
            // æ‰¾åˆ°æœ€è¿‘çš„è¾¹ç•Œ
            let closestEdge = Object.keys(distances).reduce((a, b) => 
                distances[a] < distances[b] ? a : b
            );
            
            // å‘æœ€è¿‘è¾¹ç•Œç§»åŠ¨ä¸‰åˆ†ä¹‹ä¸€è·ç¦»
            const moveDistance = distances[closestEdge] / 3;
            
            let labelX, labelY;
            
            switch (closestEdge) {
                case 'top':
                    labelX = markerX;
                    labelY = markerY - moveDistance;
                    break;
                case 'right':
                    labelX = markerX + moveDistance;
                    labelY = markerY;
                    break;
                case 'bottom':
                    labelX = markerX;
                    labelY = markerY + moveDistance;
                    break;
                case 'left':
                    labelX = markerX - moveDistance;
                    labelY = markerY;
                    break;
            }
            
            // è¾¹ç•Œé™åˆ¶
            labelX = Math.max(textWidth / 2 + 10, Math.min(canvasWidth - textWidth / 2 - 10, labelX));
            labelY = Math.max(textHeight / 2 + 10, Math.min(canvasHeight - textHeight / 2 - 10, labelY));
            
            return { labelX, labelY, closestEdge, moveDistance };
        }

        // ç»˜åˆ¶æµ‹è¯•åœºæ™¯
        function drawTestScene(canvasId, markers) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, width, height);
            
            // ç»˜åˆ¶è¾¹ç•Œ
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 2;
            ctx.strokeRect(0, 0, width, height);
            
            // è®¾ç½®å­—ä½“
            ctx.font = 'bold 16px Arial';
            
            markers.forEach((marker, index) => {
                const text = `${marker.number}: ${marker.name}`;
                const textWidth = ctx.measureText(text).width;
                const textHeight = 16 * 1.5;
                
                // è®¡ç®—æ ‡ç­¾ä½ç½®
                const result = calculateLabelPosition(
                    marker.x, marker.y, width, height, textWidth, textHeight
                );
                
                // ç»˜åˆ¶æ ‡è®°ç‚¹
                ctx.fillStyle = '#FF5722';
                ctx.beginPath();
                ctx.arc(marker.x, marker.y, 6, 0, Math.PI * 2);
                ctx.fill();
                
                // ç»˜åˆ¶è¿æ¥çº¿
                ctx.strokeStyle = '#4CAF50';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(marker.x, marker.y);
                ctx.lineTo(result.labelX, result.labelY);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // ç»˜åˆ¶æ–‡å­—æ ‡ç­¾èƒŒæ™¯
                const padding = 8;
                ctx.fillStyle = 'rgba(33, 150, 243, 0.9)';
                ctx.fillRect(
                    result.labelX - textWidth / 2 - padding,
                    result.labelY - textHeight / 2 - padding,
                    textWidth + padding * 2,
                    textHeight + padding * 2
                );
                
                // ç»˜åˆ¶æ–‡å­—
                ctx.fillStyle = '#ffffff';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(text, result.labelX, result.labelY);
                
                // æ˜¾ç¤ºè·ç¦»ä¿¡æ¯
                ctx.fillStyle = '#666';
                ctx.font = '12px Arial';
                ctx.fillText(
                    `${result.closestEdge} (${Math.round(result.moveDistance)}px)`,
                    result.labelX,
                    result.labelY + textHeight / 2 + 15
                );
            });
        }

        // æµ‹è¯•åœºæ™¯1ï¼šå››ä¸ªè§’è½
        drawTestScene('canvas1', [
            { x: 100, y: 100, number: '1', name: 'å·¦ä¸Šè§’' },
            { x: 700, y: 100, number: '2', name: 'å³ä¸Šè§’' },
            { x: 100, y: 500, number: '3', name: 'å·¦ä¸‹è§’' },
            { x: 700, y: 500, number: '4', name: 'å³ä¸‹è§’' }
        ]);

        // æµ‹è¯•åœºæ™¯2ï¼šè¾¹ç¼˜ä¸­å¿ƒ
        drawTestScene('canvas2', [
            { x: 400, y: 50, number: '5', name: 'ä¸Šè¾¹ç¼˜' },
            { x: 750, y: 300, number: '6', name: 'å³è¾¹ç¼˜' },
            { x: 400, y: 550, number: '7', name: 'ä¸‹è¾¹ç¼˜' },
            { x: 50, y: 300, number: '8', name: 'å·¦è¾¹ç¼˜' }
        ]);

        // æµ‹è¯•åœºæ™¯3ï¼šéšæœºåˆ†å¸ƒ
        drawTestScene('canvas3', [
            { x: 200, y: 150, number: '9', name: 'ç»„ä»¶A' },
            { x: 450, y: 200, number: '10', name: 'ç»„ä»¶B' },
            { x: 600, y: 350, number: '11', name: 'ç»„ä»¶C' },
            { x: 300, y: 450, number: '12', name: 'ç»„ä»¶D' },
            { x: 150, y: 350, number: '13', name: 'ç»„ä»¶E' },
            { x: 650, y: 150, number: '14', name: 'ç»„ä»¶F' }
        ]);
    </script>
</body>
</html>
