<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº¤äº’å¼æ ‡æ³¨æµ‹è¯• v2.0 - æ”¯æŒç¼©æ”¾å’Œå¼¹çª—</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4caf50;
            padding-bottom: 10px;
        }
        .info-box {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .canvas-container {
            margin: 20px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background-color: #fafafa;
            overflow: hidden;
        }
        button {
            background-color: #4caf50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: opacity 0.2s;
        }
        button:hover {
            opacity: 0.8;
        }
        button.secondary {
            background-color: #2196f3;
        }
        button.danger {
            background-color: #f44336;
        }
        button.warning {
            background-color: #ff9800;
        }
        .legend {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            border: 2px solid #333;
        }
        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        .zoom-display {
            background-color: #e0e0e0;
            padding: 8px 15px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 16px;
        }
        .feature-highlight {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ äº¤äº’å¼æ ‡æ³¨ç³»ç»Ÿæµ‹è¯• v2.0</h1>
        
        <div class="feature-highlight">
            <strong>ğŸ‰ æ–°åŠŸèƒ½:</strong><br>
            â€¢ <strong>é«˜æ¸…æ˜¾ç¤º</strong>ï¼šå›¾ç‰‡ä¸å†æ¨¡ç³Šï¼Œä¿æŒåŸå§‹åˆ†è¾¨ç‡<br>
            â€¢ <strong>ç¼©æ”¾åŠŸèƒ½</strong>ï¼šé¼ æ ‡æ»šè½®æˆ–æŒ‰é’®ç¼©æ”¾ï¼ˆ50% - 300%ï¼‰<br>
            â€¢ <strong>å¼¹çª—æŸ¥çœ‹</strong>ï¼šå…¨å±å¼¹çª—ï¼Œæ›´å¤§è§†é‡<br>
            â€¢ <strong>æ™ºèƒ½å­—ä½“</strong>ï¼šæ ‡æ³¨æ¡†å­—ä½“éšç¼©æ”¾è‡ªé€‚åº”
        </div>
        
        <div class="info-box">
            <strong>ğŸ’¡ äº¤äº’æç¤º:</strong><br>
            â€¢ <strong>æ‹–åŠ¨æ ‡æ³¨æ¡†</strong>ï¼šç‚¹å‡»å¹¶æ‹–åŠ¨ç»¿è‰²/è“è‰²/æ©™è‰²æ¡†<br>
            â€¢ <strong>åŒå‡»æ ‡æ³¨æ¡†</strong>ï¼šç¼–è¾‘éƒ¨ä»¶åç§°<br>
            â€¢ <strong>é¼ æ ‡æ»šè½®</strong>ï¼šåœ¨å›¾ç‰‡ä¸Šæ»šåŠ¨ç¼©æ”¾<br>
            â€¢ <strong>é¼ æ ‡æ‚¬åœ</strong>ï¼šæŸ¥çœ‹é¢œè‰²å˜åŒ–æ•ˆæœ<br>
            â€¢ <strong>ç‚¹å‡»ç©ºç™½</strong>ï¼šå–æ¶ˆé€‰ä¸­
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: #4caf50;"></div>
                <span>ç»¿è‰² = æ™®é€šæ ‡æ³¨</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #2196f3;"></div>
                <span>è“è‰² = é€‰ä¸­çŠ¶æ€</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #ff9800;"></div>
                <span>æ©™è‰² = é¼ æ ‡æ‚¬åœ</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #f44336;"></div>
                <span>çº¢ç‚¹ = è¯†åˆ«ä½ç½®</span>
            </div>
        </div>
        
        <div class="controls">
            <span class="zoom-display" id="zoom_display">100%</span>
            <button onclick="zoomOut()">ç¼©å° -</button>
            <button onclick="resetZoom()" class="secondary">é‡ç½® 100%</button>
            <button onclick="zoomIn()">æ”¾å¤§ +</button>
            <button onclick="openModal()" class="warning">ğŸ” å¼¹çª—æŸ¥çœ‹</button>
            <button onclick="exportImage()">ğŸ“¥ å¯¼å‡ºå›¾ç‰‡</button>
            <button onclick="resetAnnotations()" class="secondary">ğŸ”„ é‡ç½®ä½ç½®</button>
            <button onclick="showAnnotationData()">ğŸ“Š æŸ¥çœ‹æ•°æ®</button>
        </div>
        
        <div class="canvas-container">
            <canvas id="test_canvas" style="width: 100%; border-radius: 4px;"></canvas>
        </div>
        
        <div id="data_display" style="margin-top: 20px; padding: 15px; background-color: #f5f5f5; border-radius: 4px; display: none;">
            <h3>æ ‡æ³¨æ•°æ®</h3>
            <pre id="data_content" style="background-color: white; padding: 10px; border-radius: 4px; overflow-x: auto;"></pre>
        </div>
    </div>
    
    <script src="frontend/js/drawingMarkerInteractive.js"></script>
    <script>
        // æ¨¡æ‹Ÿæµ‹è¯•æ•°æ®
        const testImageUrl = 'tests/test patent pic.png';
        
        const testDetectedNumbers = [
            { number: '21', x: 313, y: 78, confidence: 66.6 },
            { number: '20', x: 89, y: 88, confidence: 66.4 },
            { number: '19', x: 200, y: 88, confidence: 66.7 },
            { number: '11', x: 626, y: 173, confidence: 66.2 },
            { number: '10', x: 662, y: 199, confidence: 66.0 }
        ];
        
        const testReferenceMap = {
            '10': 'å¤–å£³',
            '11': 'ç”µæœº',
            '19': 'é½¿è½®',
            '20': 'è½´æ‰¿',
            '21': 'èºæ “'
        };
        
        // åˆ›å»ºäº¤äº’å¼æ ‡æ³¨å®ä¾‹
        let marker = null;
        
        // åˆå§‹åŒ–
        function init() {
            marker = new InteractiveDrawingMarker(
                'test_canvas',
                testImageUrl,
                testDetectedNumbers,
                testReferenceMap,
                {
                    enableModal: true,
                    onZoomChange: (zoom) => {
                        document.getElementById('zoom_display').textContent = `${Math.round(zoom * 100)}%`;
                    }
                }
            );
        }
        
        // ç¼©æ”¾æ§åˆ¶
        function zoomIn() {
            if (!marker) return;
            marker.zoomIn();
        }
        
        function zoomOut() {
            if (!marker) return;
            marker.zoomOut();
        }
        
        function resetZoom() {
            if (!marker) return;
            marker.resetZoom();
        }
        
        // æ‰“å¼€å¼¹çª—
        function openModal() {
            if (!marker) return;
            
            // åˆ›å»ºå¼¹çª—
            const modal = document.createElement('div');
            modal.style.cssText = `
                display: flex;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.95);
                z-index: 10000;
                justify-content: center;
                align-items: center;
                flex-direction: column;
                padding: 20px;
                box-sizing: border-box;
            `;
            
            // å·¥å…·æ 
            const toolbar = document.createElement('div');
            toolbar.style.cssText = `
                position: absolute;
                top: 20px;
                right: 20px;
                display: flex;
                gap: 10px;
                z-index: 10001;
            `;
            
            const modalZoomDisplay = document.createElement('div');
            modalZoomDisplay.style.cssText = `
                background-color: rgba(255, 255, 255, 0.95);
                padding: 8px 15px;
                border-radius: 4px;
                font-weight: bold;
                font-size: 16px;
            `;
            modalZoomDisplay.textContent = `${Math.round(marker.zoom * 100)}%`;
            
            const createBtn = (text, onClick, bgColor = '#4caf50') => {
                const btn = document.createElement('button');
                btn.textContent = text;
                btn.style.cssText = `
                    background-color: ${bgColor};
                    color: white;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 14px;
                    font-weight: bold;
                `;
                btn.addEventListener('click', onClick);
                return btn;
            };
            
            toolbar.appendChild(modalZoomDisplay);
            toolbar.appendChild(createBtn('ç¼©å° -', () => {
                marker.zoomOut();
                modalZoomDisplay.textContent = `${Math.round(marker.zoom * 100)}%`;
            }));
            toolbar.appendChild(createBtn('é‡ç½®', () => {
                marker.resetZoom();
                modalZoomDisplay.textContent = `${Math.round(marker.zoom * 100)}%`;
            }, '#2196f3'));
            toolbar.appendChild(createBtn('æ”¾å¤§ +', () => {
                marker.zoomIn();
                modalZoomDisplay.textContent = `${Math.round(marker.zoom * 100)}%`;
            }));
            toolbar.appendChild(createBtn('å…³é—­ Ã—', () => {
                marker.resetZoom();
                modal.remove();
            }, '#f44336'));
            
            const container = document.createElement('div');
            container.style.cssText = `
                max-width: 95%;
                max-height: 90%;
                overflow: auto;
                background-color: #fff;
                border-radius: 8px;
                padding: 20px;
            `;
            
            const clonedCanvas = marker.canvas.cloneNode(true);
            clonedCanvas.getContext('2d').drawImage(marker.canvas, 0, 0);
            clonedCanvas.style.cssText = `
                display: block;
                margin: 0 auto;
                max-width: 100%;
            `;
            
            const hint = document.createElement('div');
            hint.style.cssText = `
                margin-top: 15px;
                padding: 10px;
                background-color: rgba(33, 150, 243, 0.1);
                border-radius: 4px;
                text-align: center;
            `;
            hint.innerHTML = '<strong>ğŸ’¡ æç¤º:</strong> ä½¿ç”¨ä¸Šæ–¹æŒ‰é’®æˆ–é¼ æ ‡æ»šè½®ç¼©æ”¾ | ç‚¹å‡»èƒŒæ™¯å…³é—­';
            
            container.appendChild(clonedCanvas);
            container.appendChild(hint);
            modal.appendChild(toolbar);
            modal.appendChild(container);
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    marker.resetZoom();
                    modal.remove();
                }
            });
            
            container.addEventListener('wheel', (e) => {
                e.preventDefault();
                if (e.deltaY > 0) {
                    marker.zoomOut();
                } else {
                    marker.zoomIn();
                }
                modalZoomDisplay.textContent = `${Math.round(marker.zoom * 100)}%`;
                clonedCanvas.style.width = marker.canvas.style.width;
            }, { passive: false });
            
            document.body.appendChild(modal);
        }
        
        // å¯¼å‡ºå›¾ç‰‡
        function exportImage() {
            if (!marker) return;
            const imageData = marker.exportImage();
            const link = document.createElement('a');
            link.download = 'test_annotated.png';
            link.href = imageData;
            link.click();
            alert('å›¾ç‰‡å·²å¯¼å‡ºï¼');
        }
        
        // é‡ç½®æ ‡æ³¨ä½ç½®
        function resetAnnotations() {
            if (!marker) return;
            marker.initializeAnnotations();
            marker.render();
            alert('æ ‡æ³¨ä½ç½®å·²é‡ç½®ï¼');
        }
        
        // æ˜¾ç¤ºæ ‡æ³¨æ•°æ®
        function showAnnotationData() {
            if (!marker) return;
            const data = marker.exportAnnotations();
            const dataDisplay = document.getElementById('data_display');
            const dataContent = document.getElementById('data_content');
            dataContent.textContent = JSON.stringify(data, null, 2);
            dataDisplay.style.display = 'block';
        }
        
        // é¡µé¢åŠ è½½ååˆå§‹åŒ–
        window.addEventListener('load', init);
    </script>
</body>
</html>
