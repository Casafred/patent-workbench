<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è”ç½‘æœç´¢åŠŸèƒ½è°ƒè¯•æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        .section {
            margin: 30px 0;
            padding: 20px;
            background: #f9f9f9;
            border-left: 4px solid #2196F3;
            border-radius: 4px;
        }
        .section h2 {
            margin-top: 0;
            color: #2196F3;
        }
        .test-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .test-button:hover {
            background: #45a049;
        }
        .test-button.secondary {
            background: #2196F3;
        }
        .test-button.secondary:hover {
            background: #0b7dda;
        }
        .console-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid transparent;
        }
        .log-entry.info {
            border-left-color: #2196F3;
            color: #4FC3F7;
        }
        .log-entry.success {
            border-left-color: #4CAF50;
            color: #81C784;
        }
        .log-entry.warning {
            border-left-color: #FF9800;
            color: #FFB74D;
        }
        .log-entry.error {
            border-left-color: #f44336;
            color: #E57373;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-indicator.active {
            background: #4CAF50;
            box-shadow: 0 0 8px #4CAF50;
        }
        .status-indicator.inactive {
            background: #9E9E9E;
        }
        .checklist {
            list-style: none;
            padding: 0;
        }
        .checklist li {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 4px;
            border-left: 4px solid #9E9E9E;
        }
        .checklist li.checked {
            border-left-color: #4CAF50;
        }
        .checklist li::before {
            content: 'â˜ ';
            font-size: 18px;
            margin-right: 10px;
        }
        .checklist li.checked::before {
            content: 'â˜‘ ';
            color: #4CAF50;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” è”ç½‘æœç´¢åŠŸèƒ½è°ƒè¯•æµ‹è¯•</h1>
        
        <div class="section">
            <h2>ğŸ“Š å½“å‰çŠ¶æ€</h2>
            <p>
                <span class="status-indicator inactive" id="statusIndicator"></span>
                <strong>æœç´¢æ¨¡å¼ï¼š</strong>
                <span id="searchStatus">æœªçŸ¥</span>
            </p>
            <p><strong>æœç´¢å¼•æ“ï¼š</strong> <span id="searchEngine">-</span></p>
            <p><strong>ç»“æœæ•°é‡ï¼š</strong> <span id="searchCount">-</span></p>
            <p><strong>å†…å®¹é•¿åº¦ï¼š</strong> <span id="contentSize">-</span></p>
        </div>

        <div class="section">
            <h2>ğŸ§ª æµ‹è¯•æ­¥éª¤</h2>
            <ol class="checklist" id="checklist">
                <li id="step1">æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰</li>
                <li id="step2">ç‚¹å‡»"æ£€æŸ¥æœç´¢çŠ¶æ€"æŒ‰é’®</li>
                <li id="step3">ç‚¹å‡»"æ¨¡æ‹Ÿå¯ç”¨æœç´¢"æŒ‰é’®</li>
                <li id="step4">è§‚å¯Ÿæ§åˆ¶å°è¾“å‡º</li>
                <li id="step5">è¿”å›ä¸»åº”ç”¨æµ‹è¯•å®é™…æœç´¢</li>
            </ol>
        </div>

        <div class="section">
            <h2>ğŸ® æµ‹è¯•æ§åˆ¶</h2>
            <button class="test-button" onclick="checkSearchState()">æ£€æŸ¥æœç´¢çŠ¶æ€</button>
            <button class="test-button secondary" onclick="simulateEnableSearch()">æ¨¡æ‹Ÿå¯ç”¨æœç´¢</button>
            <button class="test-button secondary" onclick="simulateDisableSearch()">æ¨¡æ‹Ÿå…³é—­æœç´¢</button>
            <button class="test-button" onclick="testRequestPayload()">æµ‹è¯•è¯·æ±‚å‚æ•°</button>
            <button class="test-button" onclick="clearConsole()">æ¸…ç©ºæ—¥å¿—</button>
        </div>

        <div class="section">
            <h2>ğŸ“ æ§åˆ¶å°è¾“å‡º</h2>
            <div class="console-output" id="consoleOutput">
                <div class="log-entry info">ç­‰å¾…æµ‹è¯•...</div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ’¡ è¯Šæ–­å»ºè®®</h2>
            <div id="diagnostics">
                <p>ç‚¹å‡»"æ£€æŸ¥æœç´¢çŠ¶æ€"å¼€å§‹è¯Šæ–­...</p>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿ appState
        const appState = {
            chat: {
                searchMode: {
                    enabled: false,
                    searchEngine: 'search_pro',
                    count: 5,
                    contentSize: 'medium'
                }
            }
        };

        function log(message, type = 'info') {
            const output = document.getElementById('consoleOutput');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(entry);
            output.scrollTop = output.scrollHeight;
            
            // åŒæ—¶è¾“å‡ºåˆ°æµè§ˆå™¨æ§åˆ¶å°
            console.log(`ğŸ” [æµ‹è¯•] ${message}`);
        }

        function updateStatus() {
            const indicator = document.getElementById('statusIndicator');
            const status = document.getElementById('searchStatus');
            const engine = document.getElementById('searchEngine');
            const count = document.getElementById('searchCount');
            const size = document.getElementById('contentSize');

            if (appState.chat.searchMode.enabled) {
                indicator.className = 'status-indicator active';
                status.textContent = 'å·²å¯ç”¨';
                status.style.color = '#4CAF50';
                status.style.fontWeight = 'bold';
            } else {
                indicator.className = 'status-indicator inactive';
                status.textContent = 'æœªå¯ç”¨';
                status.style.color = '#9E9E9E';
                status.style.fontWeight = 'normal';
            }

            engine.textContent = appState.chat.searchMode.searchEngine;
            count.textContent = appState.chat.searchMode.count;
            size.textContent = appState.chat.searchMode.contentSize;
        }

        function checkStep(stepId) {
            const step = document.getElementById(stepId);
            if (step) {
                step.classList.add('checked');
            }
        }

        function checkSearchState() {
            log('å¼€å§‹æ£€æŸ¥æœç´¢çŠ¶æ€...', 'info');
            checkStep('step2');
            
            log(`æœç´¢æ¨¡å¼çŠ¶æ€: ${JSON.stringify(appState.chat.searchMode, null, 2)}`, 'info');
            
            if (appState.chat.searchMode.enabled) {
                log('âœ“ æœç´¢æ¨¡å¼å·²å¯ç”¨', 'success');
            } else {
                log('âœ— æœç´¢æ¨¡å¼æœªå¯ç”¨', 'warning');
            }
            
            updateStatus();
            updateDiagnostics();
        }

        function simulateEnableSearch() {
            log('æ¨¡æ‹Ÿå¯ç”¨æœç´¢...', 'info');
            checkStep('step3');
            
            appState.chat.searchMode.enabled = true;
            
            log('ğŸ” [è”ç½‘æœç´¢] æœç´¢æ¨¡å¼åˆ‡æ¢: ' + JSON.stringify(appState.chat.searchMode, null, 2), 'success');
            log('âœ“ æœç´¢å·²å¯ç”¨', 'success');
            
            updateStatus();
            updateDiagnostics();
        }

        function simulateDisableSearch() {
            log('æ¨¡æ‹Ÿå…³é—­æœç´¢...', 'info');
            
            appState.chat.searchMode.enabled = false;
            
            log('ğŸ” [è”ç½‘æœç´¢] æœç´¢æ¨¡å¼åˆ‡æ¢: ' + JSON.stringify(appState.chat.searchMode, null, 2), 'warning');
            log('âœ“ æœç´¢å·²å…³é—­', 'warning');
            
            updateStatus();
            updateDiagnostics();
        }

        function testRequestPayload() {
            log('æµ‹è¯•è¯·æ±‚å‚æ•°æ„å»º...', 'info');
            checkStep('step4');
            
            const requestPayload = {
                model: 'GLM-4-Flash',
                temperature: 0.7,
                messages: [
                    { role: 'user', content: 'æµ‹è¯•æ¶ˆæ¯' }
                ]
            };
            
            log('åŸºç¡€è¯·æ±‚å‚æ•°: ' + JSON.stringify(requestPayload, null, 2), 'info');
            
            if (appState.chat.searchMode.enabled) {
                requestPayload.enable_web_search = true;
                requestPayload.search_engine = appState.chat.searchMode.searchEngine;
                requestPayload.count = appState.chat.searchMode.count;
                requestPayload.content_size = appState.chat.searchMode.contentSize;
                requestPayload.search_prompt = "æµ‹è¯•æœç´¢æç¤ºè¯";
                
                log('ğŸ” [è”ç½‘æœç´¢] å·²å¯ç”¨ï¼è¯·æ±‚å‚æ•°: ' + JSON.stringify({
                    enable_web_search: requestPayload.enable_web_search,
                    search_engine: requestPayload.search_engine,
                    count: requestPayload.count,
                    content_size: requestPayload.content_size
                }, null, 2), 'success');
                
                log('âœ“ è¯·æ±‚å‚æ•°åŒ…å«æœç´¢é…ç½®', 'success');
            } else {
                log('ğŸ” [è”ç½‘æœç´¢] æœªå¯ç”¨ï¼Œä½¿ç”¨æ™®é€šå¯¹è¯æ¨¡å¼', 'warning');
                log('âœ— è¯·æ±‚å‚æ•°ä¸åŒ…å«æœç´¢é…ç½®', 'warning');
            }
            
            log('å®Œæ•´è¯·æ±‚å‚æ•°: ' + JSON.stringify(requestPayload, null, 2), 'info');
        }

        function clearConsole() {
            document.getElementById('consoleOutput').innerHTML = '<div class="log-entry info">æ—¥å¿—å·²æ¸…ç©º</div>';
        }

        function updateDiagnostics() {
            const diagnostics = document.getElementById('diagnostics');
            let html = '';
            
            if (!appState.chat.searchMode.enabled) {
                html += '<p><strong>âš ï¸ æœç´¢æœªå¯ç”¨</strong></p>';
                html += '<ul>';
                html += '<li>è¯·ç‚¹å‡»"æ¨¡æ‹Ÿå¯ç”¨æœç´¢"æŒ‰é’®</li>';
                html += '<li>æˆ–åœ¨ä¸»åº”ç”¨ä¸­ç‚¹å‡»æœç´¢æŒ‰é’®ï¼ˆğŸ”å›¾æ ‡ï¼‰</li>';
                html += '</ul>';
            } else {
                html += '<p><strong>âœ… æœç´¢å·²å¯ç”¨</strong></p>';
                html += '<ul>';
                html += '<li>æœç´¢å¼•æ“: <code>' + appState.chat.searchMode.searchEngine + '</code></li>';
                html += '<li>ç»“æœæ•°é‡: <code>' + appState.chat.searchMode.count + '</code></li>';
                html += '<li>å†…å®¹é•¿åº¦: <code>' + appState.chat.searchMode.contentSize + '</code></li>';
                html += '</ul>';
                html += '<p><strong>ä¸‹ä¸€æ­¥ï¼š</strong></p>';
                html += '<ul>';
                html += '<li>ç‚¹å‡»"æµ‹è¯•è¯·æ±‚å‚æ•°"æŸ¥çœ‹å®Œæ•´é…ç½®</li>';
                html += '<li>è¿”å›ä¸»åº”ç”¨å‘é€æµ‹è¯•æ¶ˆæ¯</li>';
                html += '<li>è§‚å¯Ÿæµè§ˆå™¨æ§åˆ¶å°å’Œåç«¯æ—¥å¿—</li>';
                html += '</ul>';
            }
            
            diagnostics.innerHTML = html;
        }

        // åˆå§‹åŒ–
        window.onload = function() {
            log('æµ‹è¯•é¡µé¢å·²åŠ è½½', 'success');
            log('è¯·æŒ‰ç…§æµ‹è¯•æ­¥éª¤è¿›è¡Œæ“ä½œ', 'info');
            checkStep('step1');
            updateStatus();
            updateDiagnostics();
        };

        // ç›‘å¬æ§åˆ¶å°
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            // å¯ä»¥åœ¨è¿™é‡Œæ•è·æ§åˆ¶å°è¾“å‡º
        };
    </script>
</body>
</html>
