# è”ç½‘æœç´¢åŠŸèƒ½ä¿®æ­£è¯´æ˜

## ğŸ“‹ é—®é¢˜å‘ç°

åœ¨å®¡æŸ¥æ™ºè°±AIå®˜æ–¹æ–‡æ¡£åï¼Œå‘ç°äº†å®ç°ä¸­çš„ä¸€äº›é—®é¢˜å¹¶è¿›è¡Œäº†ä¿®æ­£ã€‚

## ğŸ” æ™ºè°±AIç½‘ç»œæœç´¢çš„ä¸¤ç§æ–¹å¼

æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œæ™ºè°±AIæä¾›äº†ä¸¤ç§ç½‘ç»œæœç´¢æ–¹å¼ï¼š

### æ–¹å¼1ï¼šWeb Search APIï¼ˆç‹¬ç«‹æœç´¢APIï¼‰

**ç«¯ç‚¹**ï¼š`POST /paas/v4/web_search`

**ç”¨é€”**ï¼šç›´æ¥è°ƒç”¨æœç´¢å¼•æ“è·å–ç»“æ„åŒ–æœç´¢ç»“æœ

**ç‰¹ç‚¹**ï¼š
- è¿”å›åŸå§‹æœç´¢ç»“æœï¼ˆæ ‡é¢˜ã€URLã€æ‘˜è¦ç­‰ï¼‰
- ä¸æ¶‰åŠå¤§æ¨¡å‹ç”Ÿæˆ
- é€‚åˆéœ€è¦åŸå§‹æœç´¢æ•°æ®çš„åœºæ™¯

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "search_query": "æœç´¢å†…å®¹",
  "search_engine": "search_pro",
  "search_intent": false,
  "count": 10,
  "content_size": "medium"
}
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "id": "ä»»åŠ¡ID",
  "created": 1234567890,
  "request_id": "è¯·æ±‚ID",
  "search_intent": [...],
  "search_result": [
    {
      "title": "æ ‡é¢˜",
      "content": "å†…å®¹æ‘˜è¦",
      "link": "é“¾æ¥",
      "media": "ç½‘ç«™åç§°",
      "icon": "å›¾æ ‡",
      "refer": "è§’æ ‡",
      "publish_date": "å‘å¸ƒæ—¶é—´"
    }
  ]
}
```

### æ–¹å¼2ï¼šWeb Search in Chatï¼ˆå¯¹è¯ä¸­çš„ç½‘ç»œæœç´¢ï¼‰âœ… å½“å‰ä½¿ç”¨

**ç«¯ç‚¹**ï¼š`POST /paas/v4/chat/completions`ï¼ˆé€šè¿‡ tools å‚æ•°ï¼‰

**ç”¨é€”**ï¼šåœ¨å¯¹è¯ä¸­è‡ªåŠ¨è°ƒç”¨æœç´¢å¹¶ç»“åˆæœç´¢ç»“æœç”Ÿæˆå›ç­”

**ç‰¹ç‚¹**ï¼š
- AIè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦æœç´¢
- æœç´¢ç»“æœè‡ªåŠ¨èå…¥å›ç­”
- è‡ªåŠ¨æ ‡æ³¨æ¥æº
- é€‚åˆå¯¹è¯åœºæ™¯

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "model": "glm-4-air",
  "messages": [...],
  "tools": [
    {
      "type": "web_search",
      "web_search": {
        "enable": true,
        "search_engine": "search_pro",
        "search_result": true,
        "count": 5,
        "content_size": "medium"
      }
    }
  ],
  "tool_choice": "auto"
}
```

## âœ… å½“å‰å®ç°æ–¹å¼

æˆ‘ä»¬çš„å³æ—¶å¯¹è¯åŠŸèƒ½ä½¿ç”¨çš„æ˜¯**æ–¹å¼2ï¼šWeb Search in Chat**ï¼Œè¿™æ˜¯æ­£ç¡®çš„é€‰æ‹©ï¼Œå› ä¸ºï¼š

1. **æ›´é€‚åˆå¯¹è¯åœºæ™¯**ï¼šAIè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦æœç´¢
2. **ç”¨æˆ·ä½“éªŒæ›´å¥½**ï¼šæœç´¢ç»“æœè‡ªåŠ¨èå…¥å›ç­”ï¼Œæ— éœ€é¢å¤–å¤„ç†
3. **è‡ªåŠ¨æ ‡æ³¨æ¥æº**ï¼šAIä¼šåœ¨å›ç­”ä¸­æ ‡æ³¨ä¿¡æ¯æ¥æº
4. **æ™ºèƒ½åˆ¤æ–­**ï¼šåªåœ¨å¿…è¦æ—¶æ‰è°ƒç”¨æœç´¢ï¼ŒèŠ‚çœè´¹ç”¨

## ğŸ”§ å·²ä¿®æ­£çš„é—®é¢˜

### 1. ä¿®æ­£äº†ç‹¬ç«‹æœç´¢APIç«¯ç‚¹

**ä¹‹å‰ï¼ˆé”™è¯¯ï¼‰**ï¼š
```python
search_url = "https://open.bigmodel.cn/api/paas/v4/tools/retrieval"  # âŒ
```

**ç°åœ¨ï¼ˆæ­£ç¡®ï¼‰**ï¼š
```python
search_url = "https://open.bigmodel.cn/api/paas/v4/web_search"  # âœ…
```

### 2. æ·»åŠ äº†å‚æ•°éªŒè¯

æ ¹æ®å®˜æ–¹æ–‡æ¡£è§„èŒƒï¼š
- `search_query` æœ€å¤§é•¿åº¦ï¼š70ä¸ªå­—ç¬¦
- `count` èŒƒå›´ï¼š1-50
- `search_intent` ç±»å‹ï¼šå¸ƒå°”å€¼

### 3. å®Œå–„äº†å¯é€‰å‚æ•°æ”¯æŒ

æ·»åŠ äº†ä»¥ä¸‹å¯é€‰å‚æ•°çš„æ”¯æŒï¼š
- `search_domain_filter`ï¼šé™å®šæœç´¢åŸŸå
- `search_recency_filter`ï¼šé™å®šæ—¶é—´èŒƒå›´
- `request_id`ï¼šè¯·æ±‚æ ‡è¯†ç¬¦
- `user_id`ï¼šç”¨æˆ·æ ‡è¯†ç¬¦

## ğŸ“Š ä¸¤ç§æ–¹å¼çš„å¯¹æ¯”

| ç‰¹æ€§ | Web Search API | Web Search in Chat âœ… |
|-----|---------------|---------------------|
| **ä½¿ç”¨åœºæ™¯** | éœ€è¦åŸå§‹æœç´¢æ•°æ® | å¯¹è¯ä¸­è‡ªåŠ¨æœç´¢ |
| **è¿”å›å†…å®¹** | ç»“æ„åŒ–æœç´¢ç»“æœ | AIç”Ÿæˆçš„å›ç­” |
| **æ¥æºæ ‡æ³¨** | éœ€è¦æ‰‹åŠ¨å¤„ç† | è‡ªåŠ¨æ ‡æ³¨ |
| **æ™ºèƒ½åˆ¤æ–­** | ä¸æ”¯æŒ | è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦æœç´¢ |
| **é›†æˆéš¾åº¦** | éœ€è¦é¢å¤–å¤„ç† | æ— ç¼é›†æˆ |
| **é€‚ç”¨æ€§** | æ•°æ®åˆ†æã€æ‰¹é‡å¤„ç† | å³æ—¶å¯¹è¯ã€é—®ç­” |

## ğŸ¯ å½“å‰å®ç°éªŒè¯

### åç«¯å®ç°ï¼ˆbackend/routes/chat.pyï¼‰

#### 1. æµå¼å¯¹è¯ç«¯ç‚¹ï¼ˆ/stream_chatï¼‰âœ…
```python
# Add web search tools if enabled
if req_data.get('enable_web_search'):
    web_search_config = {
        "type": "web_search",
        "web_search": {
            "enable": True,
            "search_engine": req_data.get('search_engine', 'search_pro'),
            "search_result": True,
            "count": req_data.get('search_count', 5),
            "content_size": req_data.get('content_size', 'medium')
        }
    }
    request_params['tools'] = [web_search_config]
    request_params['tool_choice'] = 'auto'
```

**éªŒè¯ç»“æœ**ï¼šâœ… ç¬¦åˆå®˜æ–¹æ–‡æ¡£è§„èŒƒ

#### 2. åŒæ­¥å¯¹è¯ç«¯ç‚¹ï¼ˆ/chatï¼‰âœ…
```python
# Add web search tools if enabled
if req_data.get('enable_web_search'):
    web_search_config = {
        "type": "web_search",
        "web_search": {
            "enable": True,
            "search_engine": req_data.get('search_engine', 'search_pro'),
            "search_result": True,
            "count": req_data.get('search_count', 5),
            "content_size": req_data.get('content_size', 'medium')
        }
    }
    request_params['tools'] = [web_search_config]
    request_params['tool_choice'] = 'auto'
```

**éªŒè¯ç»“æœ**ï¼šâœ… ç¬¦åˆå®˜æ–¹æ–‡æ¡£è§„èŒƒ

#### 3. ç‹¬ç«‹æœç´¢ç«¯ç‚¹ï¼ˆ/web_searchï¼‰âœ…
```python
# Call Zhipu Web Search API (correct endpoint)
search_url = "https://open.bigmodel.cn/api/paas/v4/web_search"
headers = {
    "Authorization": f"Bearer {api_key}",
    "Content-Type": "application/json"
}

search_payload = {
    "search_query": search_query,
    "search_engine": search_engine,
    "search_intent": search_intent,
    "count": count,
    "content_size": content_size
}
```

**éªŒè¯ç»“æœ**ï¼šâœ… ç«¯ç‚¹å’Œå‚æ•°å·²ä¿®æ­£ï¼Œç¬¦åˆå®˜æ–¹æ–‡æ¡£

### å‰ç«¯å®ç°ï¼ˆjs/chat.jsï¼‰âœ…

```javascript
// Add web search parameters if enabled
if (appState.chat.searchMode.enabled) {
    requestPayload.enable_web_search = true;
    requestPayload.search_engine = appState.chat.searchMode.searchEngine;
    requestPayload.search_count = appState.chat.searchMode.count;
    requestPayload.content_size = appState.chat.searchMode.contentSize;
}
```

**éªŒè¯ç»“æœ**ï¼šâœ… å‚æ•°ä¼ é€’æ­£ç¡®

## ğŸ‰ åŠŸèƒ½éªŒè¯ç»“è®º

### âœ… å¯ä»¥æ­£å¸¸ä½¿ç”¨çš„åŠŸèƒ½

1. **å¯¹è¯ä¸­çš„ç½‘ç»œæœç´¢**ï¼ˆä¸»è¦åŠŸèƒ½ï¼‰
   - å®ç°æ–¹å¼ï¼šé€šè¿‡ tools å‚æ•°
   - çŠ¶æ€ï¼šâœ… å®Œå…¨ç¬¦åˆå®˜æ–¹æ–‡æ¡£
   - å¯ç”¨æ€§ï¼šç«‹å³å¯ç”¨

2. **æœç´¢é…ç½®ç•Œé¢**
   - çŠ¶æ€ï¼šâœ… åŠŸèƒ½å®Œæ•´
   - å¯ç”¨æ€§ï¼šç«‹å³å¯ç”¨

3. **è§†è§‰åé¦ˆ**
   - çŠ¶æ€ï¼šâœ… åŠŸèƒ½å®Œæ•´
   - å¯ç”¨æ€§ï¼šç«‹å³å¯ç”¨

### âœ… å·²ä¿®æ­£çš„åŠŸèƒ½

1. **ç‹¬ç«‹æœç´¢APIç«¯ç‚¹**
   - ä¿®æ­£ï¼šAPIç«¯ç‚¹è·¯å¾„
   - ä¿®æ­£ï¼šå‚æ•°éªŒè¯
   - ä¿®æ­£ï¼šå¯é€‰å‚æ•°æ”¯æŒ
   - çŠ¶æ€ï¼šâœ… å·²ä¿®æ­£
   - å¯ç”¨æ€§ï¼šç«‹å³å¯ç”¨ï¼ˆå¦‚éœ€ä½¿ç”¨ï¼‰

## ğŸ“ ä½¿ç”¨å»ºè®®

### æ¨èä½¿ç”¨æ–¹å¼ï¼ˆå½“å‰å®ç°ï¼‰

**åœºæ™¯**ï¼šå³æ—¶å¯¹è¯ã€æ™ºèƒ½é—®ç­”

**æ­¥éª¤**ï¼š
1. ç‚¹å‡»æœç´¢æŒ‰é’®å¯ç”¨è”ç½‘æœç´¢
2. é…ç½®æœç´¢å‚æ•°
3. å‘é€æ¶ˆæ¯ï¼ŒAIè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦æœç´¢
4. æŸ¥çœ‹åŒ…å«æ¥æºæ ‡æ³¨çš„å›ç­”

**ä¼˜åŠ¿**ï¼š
- æ— éœ€å…³å¿ƒæœç´¢ç»†èŠ‚
- AIæ™ºèƒ½åˆ¤æ–­
- è‡ªåŠ¨æ ‡æ³¨æ¥æº
- ç”¨æˆ·ä½“éªŒæœ€ä½³

### å¯é€‰ä½¿ç”¨æ–¹å¼ï¼ˆç‹¬ç«‹æœç´¢APIï¼‰

**åœºæ™¯**ï¼šéœ€è¦åŸå§‹æœç´¢æ•°æ®ã€æ‰¹é‡å¤„ç†

**ç«¯ç‚¹**ï¼š`POST /web_search`

**ç”¨é€”**ï¼š
- è·å–åŸå§‹æœç´¢ç»“æœ
- è‡ªå®šä¹‰æœç´¢ç»“æœå¤„ç†
- æ‰¹é‡æœç´¢ä»»åŠ¡

## ğŸ”„ åç»­ä¼˜åŒ–å»ºè®®

1. **æ·»åŠ æœç´¢æ„å›¾è¯†åˆ«å¼€å…³**
   - åœ¨é…ç½®ç•Œé¢æ·»åŠ  `search_intent` é€‰é¡¹
   - è®©ç”¨æˆ·é€‰æ‹©æ˜¯å¦å¯ç”¨æ„å›¾è¯†åˆ«

2. **æ·»åŠ é«˜çº§æœç´¢é€‰é¡¹**
   - åŸŸåè¿‡æ»¤ï¼ˆ`search_domain_filter`ï¼‰
   - æ—¶é—´èŒƒå›´è¿‡æ»¤ï¼ˆ`search_recency_filter`ï¼‰

3. **æœç´¢ç»“æœå±•ç¤ºä¼˜åŒ–**
   - æ˜¾ç¤ºæœç´¢ç»“æœçš„å‘å¸ƒæ—¶é—´
   - æ˜¾ç¤ºç½‘ç«™å›¾æ ‡
   - ä¼˜åŒ–æ¥æºé“¾æ¥çš„æ˜¾ç¤º

4. **é”™è¯¯å¤„ç†å¢å¼º**
   - å¤„ç†æœç´¢å¹¶å‘é™åˆ¶ï¼ˆé”™è¯¯ç 1701ï¼‰
   - å¤„ç†æœç´¢å¼•æ“ä¸å¯ç”¨ï¼ˆé”™è¯¯ç 1702ï¼‰
   - å¤„ç†æ— æ•ˆæ•°æ®ï¼ˆé”™è¯¯ç 1703ï¼‰

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [æ™ºè°±AIç½‘ç»œæœç´¢APIæ–‡æ¡£](https://docs.bigmodel.cn/api-reference/%E5%B7%A5%E5%85%B7-api/%E7%BD%91%E7%BB%9C%E6%90%9C%E7%B4%A2)
- [å¯¹è¯ä¸­çš„ç½‘ç»œæœç´¢](https://docs.bigmodel.cn/api-reference/%E6%A8%A1%E5%9E%8B-api/%E5%AF%B9%E8%AF%9D%E8%A1%A5%E5%85%A8)
- [OpenAPIè§„èŒƒ](https://docs.bigmodel.cn/llms.txt)

---

**ä¿®æ­£æ—¶é—´**ï¼š2026-01-24  
**ç‰ˆæœ¬**ï¼šv1.1  
**çŠ¶æ€**ï¼šâœ… å·²éªŒè¯å¹¶ä¿®æ­£
