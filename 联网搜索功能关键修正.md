# è”ç½‘æœç´¢åŠŸèƒ½å…³é”®ä¿®æ­£

## ğŸ” é—®é¢˜å‘ç°

åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°è”ç½‘æœç´¢åŠŸèƒ½æ— æ³•è§¦å‘ï¼Œç»è¿‡ä»”ç»†å®¡æŸ¥æ™ºè°±AIå®˜æ–¹æ–‡æ¡£åï¼Œå‘ç°äº†**å…³é”®é—®é¢˜**ã€‚

## âš ï¸ å…³é”®é—®é¢˜ï¼šå‚æ•°ç±»å‹é”™è¯¯

### é—®é¢˜æè¿°

æ ¹æ®æ™ºè°±AIå®˜æ–¹æ–‡æ¡£çš„ç¤ºä¾‹ä»£ç ï¼Œ`web_search` é…ç½®ä¸­çš„æŸäº›å‚æ•°å¿…é¡»æ˜¯**å­—ç¬¦ä¸²ç±»å‹**ï¼Œè€Œä¸æ˜¯å¸ƒå°”å€¼æˆ–æ•°å­—ç±»å‹ï¼

### å®˜æ–¹æ–‡æ¡£ç¤ºä¾‹

```python
tools = [{
    "type": "web_search",
    "web_search": {
        "enable": "True",  # âš ï¸ å­—ç¬¦ä¸² "True"ï¼Œä¸æ˜¯å¸ƒå°”å€¼ True
        "search_engine": "search_pro",
        "search_result": "True",  # âš ï¸ å­—ç¬¦ä¸² "True"ï¼Œä¸æ˜¯å¸ƒå°”å€¼ True
        "count": "5",  # âš ï¸ å­—ç¬¦ä¸² "5"ï¼Œä¸æ˜¯æ•°å­— 5
        "search_domain_filter": "www.sohu.com",
        "search_recency_filter": "noLimit",
        "content_size": "high"
    }
}]
```

### é”™è¯¯çš„å®ç°ï¼ˆä¹‹å‰ï¼‰

```python
web_search_config = {
    "type": "web_search",
    "web_search": {
        "enable": True,  # âŒ é”™è¯¯ï¼šå¸ƒå°”å€¼
        "search_engine": "search_pro",
        "search_result": True,  # âŒ é”™è¯¯ï¼šå¸ƒå°”å€¼
        "count": 5,  # âŒ é”™è¯¯ï¼šæ•°å­—
        "content_size": "medium"
    }
}
```

### æ­£ç¡®çš„å®ç°ï¼ˆç°åœ¨ï¼‰

```python
web_search_config = {
    "type": "web_search",
    "web_search": {
        "enable": "True",  # âœ… æ­£ç¡®ï¼šå­—ç¬¦ä¸² "True"
        "search_engine": "search_pro",
        "search_result": "True",  # âœ… æ­£ç¡®ï¼šå­—ç¬¦ä¸² "True"
        "count": "5",  # âœ… æ­£ç¡®ï¼šå­—ç¬¦ä¸² "5"
        "content_size": "medium"
    }
}
```

## ğŸ”§ ä¿®æ­£å†…å®¹

### 1. ä¿®æ­£å‚æ•°ç±»å‹

**æ–‡ä»¶**ï¼š`backend/routes/chat.py`

**ä¿®æ”¹ä½ç½®**ï¼š`stream_chat` å’Œ `chat` ä¸¤ä¸ªç«¯ç‚¹

**ä¿®æ”¹å†…å®¹**ï¼š
```python
# ä¿®æ”¹å‰
"enable": True,
"search_result": True,
"count": req_data.get('search_count', 5),

# ä¿®æ”¹å
"enable": "True",  # å­—ç¬¦ä¸²
"search_result": "True",  # å­—ç¬¦ä¸²
"count": str(req_data.get('search_count', 5)),  # è½¬æ¢ä¸ºå­—ç¬¦ä¸²
```

### 2. æ·»åŠ å¯é€‰å‚æ•°æ”¯æŒ

æ ¹æ®æ–‡æ¡£ï¼Œæ·»åŠ äº†ä»¥ä¸‹å¯é€‰å‚æ•°çš„æ”¯æŒï¼š

```python
# æ·»åŠ å¯é€‰å‚æ•°
if req_data.get('search_prompt'):
    web_search_config['web_search']['search_prompt'] = req_data.get('search_prompt')

if req_data.get('search_domain_filter'):
    web_search_config['web_search']['search_domain_filter'] = req_data.get('search_domain_filter')

if req_data.get('search_recency_filter'):
    web_search_config['web_search']['search_recency_filter'] = req_data.get('search_recency_filter')
```

## ğŸ“Š å‚æ•°ç±»å‹å¯¹ç…§è¡¨

| å‚æ•°å | é”™è¯¯ç±»å‹ | æ­£ç¡®ç±»å‹ | ç¤ºä¾‹ |
|-------|---------|---------|------|
| enable | `bool` | `str` | `"True"` |
| search_result | `bool` | `str` | `"True"` |
| count | `int` | `str` | `"5"` |
| search_engine | `str` | `str` | `"search_pro"` |
| content_size | `str` | `str` | `"medium"` |
| search_prompt | `str` | `str` | `"è‡ªå®šä¹‰æç¤ºè¯"` |
| search_domain_filter | `str` | `str` | `"www.example.com"` |
| search_recency_filter | `str` | `str` | `"oneWeek"` |

## ğŸ¯ ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿ

1. **APIè®¾è®¡ç‰¹æ®Šæ€§**ï¼šæ™ºè°±AIçš„ web_search å·¥å…·å‚æ•°è®¾è®¡è¦æ±‚æŸäº›å¸ƒå°”å€¼å’Œæ•°å­—å¿…é¡»ä»¥å­—ç¬¦ä¸²å½¢å¼ä¼ é€’
2. **æ–‡æ¡£ç»†èŠ‚**ï¼šè¿™ä¸ªç»†èŠ‚åœ¨æ–‡æ¡£çš„ç¤ºä¾‹ä»£ç ä¸­æœ‰ä½“ç°ï¼Œä½†å®¹æ˜“è¢«å¿½ç•¥
3. **ç±»å‹æ¨æ–­**ï¼šå¼€å‘è€…é€šå¸¸ä¼šæ ¹æ®å‚æ•°å«ä¹‰æ¨æ–­ç±»å‹ï¼ˆå¦‚ enable åº”è¯¥æ˜¯å¸ƒå°”å€¼ï¼‰ï¼Œä½†å®é™…APIè¦æ±‚ä¸åŒ

## âœ… éªŒè¯æ–¹æ³•

### æµ‹è¯•æ­¥éª¤

1. **å¯ç”¨è”ç½‘æœç´¢**
   - ç‚¹å‡»æœç´¢æŒ‰é’®
   - é…ç½®æœç´¢å‚æ•°
   - ä¿å­˜å¹¶å¯ç”¨

2. **å‘é€æµ‹è¯•é—®é¢˜**
   ```
   è¾“å…¥ï¼š2025å¹´1æœˆæœ‰å“ªäº›é‡è¦çš„ç§‘æŠ€æ–°é—»ï¼Ÿ
   ```

3. **æ£€æŸ¥å“åº”**
   - æŸ¥çœ‹æµè§ˆå™¨Networkæ ‡ç­¾
   - æ£€æŸ¥è¯·æ±‚payloadä¸­çš„toolså‚æ•°
   - ç¡®è®¤å‚æ•°ç±»å‹æ­£ç¡®

4. **éªŒè¯ç»“æœ**
   - AIåº”è¯¥è°ƒç”¨ç½‘ç»œæœç´¢
   - è¿”å›åŒ…å«æ¥æºé“¾æ¥çš„å›ç­”
   - å›ç­”å†…å®¹åº”è¯¥æ˜¯æœ€æ–°çš„

### é¢„æœŸçš„è¯·æ±‚payload

```json
{
  "model": "glm-4-air",
  "messages": [...],
  "tools": [
    {
      "type": "web_search",
      "web_search": {
        "enable": "True",
        "search_engine": "search_pro",
        "search_result": "True",
        "count": "5",
        "content_size": "medium"
      }
    }
  ],
  "tool_choice": "auto"
}
```

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. æäº¤ä¿®æ”¹

```bash
git add backend/routes/chat.py
git commit -m "fix: ä¿®æ­£web_searchå‚æ•°ç±»å‹ï¼Œenableå’Œsearch_resultå¿…é¡»æ˜¯å­—ç¬¦ä¸²"
git push origin main
```

### 2. é‡å¯æœåŠ¡

```bash
# é‡å¯Flaskåº”ç”¨
sudo systemctl restart your-app-name
```

### 3. æ¸…é™¤ç¼“å­˜

- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
- æˆ–è€…å¼ºåˆ¶åˆ·æ–°ï¼ˆCtrl+F5ï¼‰

### 4. æµ‹è¯•éªŒè¯

æŒ‰ç…§ä¸Šè¿°éªŒè¯æ–¹æ³•è¿›è¡Œæµ‹è¯•

## ğŸ“ ç»éªŒæ•™è®­

1. **ä»”ç»†é˜…è¯»å®˜æ–¹æ–‡æ¡£**ï¼šç‰¹åˆ«æ³¨æ„ç¤ºä¾‹ä»£ç ä¸­çš„ç»†èŠ‚
2. **å‚æ•°ç±»å‹éªŒè¯**ï¼šä¸è¦æ ¹æ®å‚æ•°åç§°æ¨æ–­ç±»å‹ï¼Œä»¥å®˜æ–¹æ–‡æ¡£ä¸ºå‡†
3. **å®Œæ•´æµ‹è¯•**ï¼šåœ¨å®é™…ç¯å¢ƒä¸­æµ‹è¯•åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ
4. **æŸ¥çœ‹APIå“åº”**ï¼šå¦‚æœåŠŸèƒ½ä¸å·¥ä½œï¼Œæ£€æŸ¥APIçš„é”™è¯¯å“åº”

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [æ™ºè°±AIå¯¹è¯ä¸­çš„ç½‘ç»œæœç´¢æ–‡æ¡£](https://docs.bigmodel.cn/api-reference/%E6%A8%A1%E5%9E%8B-api/%E5%AF%B9%E8%AF%9D%E8%A1%A5%E5%85%A8)
- [Web Search APIæ–‡æ¡£](https://docs.bigmodel.cn/api-reference/%E5%B7%A5%E5%85%B7-api/%E7%BD%91%E7%BB%9C%E6%90%9C%E7%B4%A2)

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœä¿®æ­£åä»ç„¶æ— æ³•æ­£å¸¸å·¥ä½œï¼Œè¯·æ£€æŸ¥ï¼š
1. APIå¯†é’¥æ˜¯å¦æœ‰ç½‘ç»œæœç´¢æƒé™
2. æ™ºè°±AI SDKç‰ˆæœ¬æ˜¯å¦æ”¯æŒweb_searchåŠŸèƒ½
3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
4. æŸ¥çœ‹åç«¯æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

---

**ä¿®æ­£æ—¶é—´**ï¼š2026-01-24  
**ç‰ˆæœ¬**ï¼šv1.2  
**çŠ¶æ€**ï¼šâœ… å·²ä¿®æ­£ï¼Œå¾…æµ‹è¯•éªŒè¯
