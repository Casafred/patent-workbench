# 第三轮修复测试指南

## ✅ 代码已推送到GitHub

提交ID: `7cdb598`  
提交信息: 第三轮错误修复：API方法、模板初始化、Markdown渲染

---

## 🧪 测试步骤

### 步骤1：清除浏览器缓存（必须！）

**方法1：强制刷新**
```
Windows: Ctrl + F5
Mac: Cmd + Shift + R
```

**方法2：完全清除缓存**
```
1. 按 Ctrl + Shift + Delete
2. 选择"全部时间"
3. 勾选"缓存的图片和文件"
4. 点击"清除数据"
5. 按 Ctrl + F5 刷新
```

---

### 步骤2：测试 /patent/version API

1. 打开网站 https://ipx.asia
2. 按 F12 打开开发者工具
3. 切换到 Console 标签
4. 进入"批量专利查询与解读"标签页
5. 输入专利号：`CN104154208B`
6. 点击"批量查询专利"

**预期结果**:
- ✅ 控制台不再出现 "405 Method Not Allowed" 错误
- ✅ 可以看到 "✅ 后端版本信息:" 日志
- ✅ 专利查询成功

**如果失败**:
- 检查是否清除了缓存
- 检查Network标签，确认 `main.js` 不是 "from cache"

---

### 步骤3：测试模板加载

1. 刷新页面（Ctrl + F5）
2. 进入"大批量处理"标签页
3. 查看控制台

**预期结果**:
- ✅ 控制台不再出现 "模板不存在: undefined" 错误
- ✅ 模板选择器有默认值（应该是"默认模板"）
- ✅ 可以正常选择和切换模板

**如果失败**:
- 完全清除浏览器缓存
- 使用隐私模式测试
- 检查 `largeBatch.js` 是否是最新版本

---

### 步骤4：测试Markdown渲染（重点！）

#### 4.1 准备测试
1. 进入"批量专利查询与解读"标签页
2. 输入专利号：`CN104154208B`
3. 点击"批量查询专利"
4. 等待查询完成

#### 4.2 打开问一问对话框
1. 在专利卡片上找到"问一问"按钮
2. 点击打开对话窗口

#### 4.3 测试Markdown渲染
输入以下问题：
```
请用Markdown格式总结这个专利的核心内容，包括：
1. **技术领域**
2. *创新点*
3. `关键技术`
```

#### 4.4 检查渲染结果

**预期结果**:
- ✅ **粗体文字** 显示为粗体（不是 `**文字**`）
- ✅ *斜体文字* 显示为斜体（不是 `*文字*`）
- ✅ `代码` 有灰色背景（不是 `` `代码` ``）
- ✅ 列表正确缩进和显示项目符号
- ✅ 标题有正确的大小和样式
- ✅ 引用有左侧边框和缩进

**示例对比**:

❌ **修复前**（显示原始符号）:
```
这个专利的**核心创新点**包括：
- *技术方案*：新型算法
- `实现方式`：Python
```

✅ **修复后**（正确渲染）:
这个专利的**核心创新点**包括：
- *技术方案*：新型算法
- `实现方式`：Python

---

### 步骤5：测试更多Markdown语法

#### 测试标题
提问：
```
请用标题格式总结：
# 一级标题
## 二级标题
### 三级标题
```

**预期**: 标题有不同的大小和粗细

#### 测试代码块
提问：
```
请展示一段代码：
```python
def hello():
    print("Hello World")
```
```

**预期**: 代码块有深色背景，代码有语法高亮

#### 测试引用
提问：
```
请用引用格式：
> 这是一个重要的引用
> 包含多行内容
```

**预期**: 引用有左侧边框，背景色略有不同

#### 测试链接
提问：
```
请提供一个链接：
[点击这里](https://example.com)
```

**预期**: 链接可点击，有下划线和颜色

---

## 🐛 常见问题排查

### 问题1：还是显示 ** 符号

**原因**: 浏览器缓存未清除

**解决**:
1. 完全关闭浏览器
2. 重新打开
3. 按 Ctrl + Shift + Delete 清除缓存
4. 访问网站

### 问题2：Markdown部分渲染，部分不渲染

**原因**: marked.js加载失败

**检查**:
1. 打开控制台
2. 输入 `typeof marked`
3. 应该返回 "object" 或 "function"
4. 如果返回 "undefined"，说明marked.js未加载

**解决**:
1. 检查网络连接
2. 检查CDN是否可访问
3. 刷新页面重新加载

### 问题3：控制台有Markdown渲染错误

**检查**:
1. 查看错误信息
2. 如果是 "Markdown渲染失败"，会自动降级到简单格式化
3. 简单格式化也支持基本的粗体、斜体

---

## ✅ 验证清单

完成以下所有项目即表示测试通过：

- [ ] 控制台无 "405 Method Not Allowed" 错误
- [ ] 控制台无 "模板不存在: undefined" 错误
- [ ] 控制台无 "Response.text已被消费" 错误
- [ ] 模板选择器有默认值
- [ ] 可以正常切换模板
- [ ] 问一问对话框打开正常
- [ ] **粗体** 正确渲染（不显示 `**`）
- [ ] *斜体* 正确渲染（不显示 `*`）
- [ ] `代码` 有灰色背景（不显示 `` ` ``）
- [ ] 列表正确缩进
- [ ] 标题有正确大小
- [ ] 引用有左侧边框
- [ ] 链接可点击

---

## 📸 截图对比

### 修复前
```
AI回答：这个专利的**核心创新点**包括：
- *技术方案*：新型算法
- `实现方式`：Python
```
（显示原始Markdown符号）

### 修复后
AI回答：这个专利的**核心创新点**包括：
- *技术方案*：新型算法
- `实现方式`：Python

（正确渲染为HTML样式）

---

## 🚀 部署到阿里云

测试通过后，部署到生产环境：

```bash
.\阿里云拉取移动端更新.bat
```

或手动部署：
```bash
ssh root@ipx.asia
cd /www/wwwroot/ipx.asia
git pull origin main
sudo systemctl restart patent-workbench
```

---

## 📞 如果测试失败

请提供以下信息：
1. 浏览器类型和版本
2. 控制台完整错误信息
3. Network标签的请求详情
4. 是否清除了缓存
5. 具体哪个功能不正常

---

**测试时间**: 2026-01-26 22:00+  
**预计测试时长**: 10-15分钟  
**测试环境**: Chrome/Edge/Firefox 最新版本
