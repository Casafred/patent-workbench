# é˜¿é‡Œäº‘éƒ¨ç½²æœ€ä½³å®è·µ

## é—®é¢˜åˆ†æ

ä½ æå‡ºäº†ä¸€ä¸ªéå¸¸é‡è¦çš„é—®é¢˜ï¼š**å¦‚ä½•åœ¨ä½¿ç”¨Git PullåŒæ­¥ä»£ç çš„åŒæ—¶ï¼Œä¿æŒæœåŠ¡å™¨ç¯å¢ƒé…ç½®ä¸è¢«è¦†ç›–ï¼Ÿ**

## è§£å†³æ–¹æ¡ˆï¼šåˆ†ç¦»ä»£ç å’Œç¯å¢ƒé…ç½®

### æ ¸å¿ƒåŸåˆ™

1. **ä»£ç æ–‡ä»¶** â†’ é€šè¿‡Gitç®¡ç†ï¼Œå¯ä»¥éšæ—¶Pullæ›´æ–°
2. **ç¯å¢ƒé…ç½®** â†’ åœ¨æœåŠ¡å™¨ä¸Šä¸€æ¬¡æ€§é…ç½®ï¼Œä¸ä¼šè¢«Gitè¦†ç›–
3. **ä¾èµ–ç®¡ç†** â†’ é€šè¿‡requirements.txtç®¡ç†ï¼ŒæœåŠ¡å™¨ä¸Šå®‰è£…åˆ°è™šæ‹Ÿç¯å¢ƒ

## æ–‡ä»¶åˆ†ç±»

### ğŸ“¦ åº”è¯¥æäº¤åˆ°Gitçš„æ–‡ä»¶ï¼ˆä¼šè¢«Pullæ›´æ–°ï¼‰

```
âœ… ä»£ç æ–‡ä»¶
- backend/**/*.py
- frontend/**/*.html
- frontend/**/*.css
- js/**/*.js
- requirements.txt
- gunicorn_config.py
- wsgi.py
- app.py

âœ… é…ç½®æ¨¡æ¿
- .env.example
- config/models.json
- config/scraper_config.json
```

### ğŸš« ä¸åº”è¯¥æäº¤åˆ°Gitçš„æ–‡ä»¶ï¼ˆæœåŠ¡å™¨ç‹¬æœ‰ï¼‰

```
âŒ ç¯å¢ƒé…ç½®ï¼ˆå·²åœ¨.gitignoreä¸­ï¼‰
- .env
- venv/
- venv311/
- __pycache__/
- *.pyc
- uploads/
- backend/user_management/users.json

âŒ ç³»ç»ŸæœåŠ¡é…ç½®ï¼ˆä¸åœ¨é¡¹ç›®ç›®å½•ï¼‰
- /etc/systemd/system/patent-app.service
```

## æ ‡å‡†éƒ¨ç½²æµç¨‹

### é¦–æ¬¡éƒ¨ç½²ï¼ˆåªéœ€æ‰§è¡Œä¸€æ¬¡ï¼‰

#### 1. æœåŠ¡å™¨ç¯å¢ƒåˆå§‹åŒ–

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cd /home/appuser/patent-app

# åˆ›å»ºPython 3.11è™šæ‹Ÿç¯å¢ƒ
python3.11 -m venv venv311

# å®‰è£…ä¾èµ–
venv311/bin/pip install -r requirements.txt

# é…ç½®systemdæœåŠ¡ï¼ˆä½¿ç”¨venv311ï¼‰
sudo nano /etc/systemd/system/patent-app.service
```

**patent-app.service é…ç½®**ï¼š
```ini
[Unit]
Description=Patent Analysis Workbench
After=network.target

[Service]
Type=notify
User=appuser
WorkingDirectory=/home/appuser/patent-app
Environment="PATH=/home/appuser/patent-app/venv311/bin"
ExecStart=/home/appuser/patent-app/venv311/bin/gunicorn -c gunicorn_config.py wsgi:app
ExecReload=/bin/kill -s HUP $MAINPID
KillMode=mixed
TimeoutStopSec=5
PrivateTmp=true
Restart=always
RestartSec=10s

[Install]
WantedBy=multi-user.target
```

```bash
# é‡æ–°åŠ è½½systemd
sudo systemctl daemon-reload

# å¯ç”¨æœåŠ¡
sudo systemctl enable patent-app

# å¯åŠ¨æœåŠ¡
sudo systemctl start patent-app
```

#### 2. é…ç½®.gitignoreï¼ˆç¡®ä¿ç¯å¢ƒæ–‡ä»¶ä¸è¢«æäº¤ï¼‰

```gitignore
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python

# Virtual environments
venv/
venv311/
env/
ENV/

# Environment variables
.env

# Uploads
uploads/
backend/uploads/

# User data
backend/user_management/users.json

# IDE
.vscode/
.idea/

# OS
.DS_Store
Thumbs.db
```

### æ—¥å¸¸æ›´æ–°æµç¨‹ï¼ˆæ¯æ¬¡ä»£ç æ›´æ–°ï¼‰

#### æ–¹å¼1ï¼šGit Pullï¼ˆæ¨èï¼‰

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cd /home/appuser/patent-app

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# å¦‚æœrequirements.txtæœ‰æ›´æ–°ï¼Œé‡æ–°å®‰è£…ä¾èµ–
venv311/bin/pip install -r requirements.txt --upgrade

# é‡å¯æœåŠ¡
sudo systemctl restart patent-app
```

#### æ–¹å¼2ï¼šæœ¬åœ°æ¨é€ + æœåŠ¡å™¨æ‹‰å–ï¼ˆè‡ªåŠ¨åŒ–ï¼‰

åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ï¼š

**deploy_to_aliyun.bat**ï¼ˆåœ¨æœ¬åœ°è¿è¡Œï¼‰ï¼š
```batch
@echo off
echo æ¨é€ä»£ç åˆ°GitHubå¹¶éƒ¨ç½²åˆ°é˜¿é‡Œäº‘...

REM 1. æäº¤å¹¶æ¨é€åˆ°GitHub
git add .
git commit -m "æ›´æ–°ä»£ç "
git push origin main

REM 2. åœ¨æœåŠ¡å™¨ä¸Šæ‹‰å–å¹¶é‡å¯
ssh root@43.99.101.195 "su - appuser -c 'cd ~/patent-app && git pull origin main && venv311/bin/pip install -r requirements.txt --upgrade' && systemctl restart patent-app"

echo éƒ¨ç½²å®Œæˆï¼
pause
```

## å…³é”®ç‚¹è¯´æ˜

### 1. è™šæ‹Ÿç¯å¢ƒä¸ä¼šè¢«è¦†ç›–

- `venv311/` ç›®å½•åœ¨ `.gitignore` ä¸­
- Git Pull ä¸ä¼šåˆ é™¤æˆ–ä¿®æ”¹å®ƒ
- ä¾èµ–é€šè¿‡ `requirements.txt` ç®¡ç†

### 2. systemdæœåŠ¡é…ç½®ç‹¬ç«‹

- æœåŠ¡é…ç½®æ–‡ä»¶åœ¨ `/etc/systemd/system/`
- ä¸åœ¨é¡¹ç›®ç›®å½•ä¸­ï¼Œä¸ä¼šè¢«Gitå½±å“
- ä¸€æ¬¡é…ç½®ï¼Œæ°¸ä¹…æœ‰æ•ˆ

### 3. ä»£ç æ›´æ–°ä¸å½±å“ç¯å¢ƒ

```
Git Pull æ›´æ–°ï¼š
âœ… Pythonä»£ç æ–‡ä»¶
âœ… HTML/CSS/JSæ–‡ä»¶
âœ… requirements.txt
âœ… gunicorn_config.py

ä¸ä¼šå½±å“ï¼š
âŒ venv311/ è™šæ‹Ÿç¯å¢ƒ
âŒ .env ç¯å¢ƒå˜é‡
âŒ users.json ç”¨æˆ·æ•°æ®
âŒ uploads/ ä¸Šä¼ æ–‡ä»¶
âŒ systemdæœåŠ¡é…ç½®
```

## å®Œæ•´çš„æ›´æ–°æ£€æŸ¥æ¸…å•

### æœ¬åœ°å¼€å‘å®Œæˆå

- [ ] æµ‹è¯•ä»£ç åŠŸèƒ½æ­£å¸¸
- [ ] æ›´æ–° requirements.txtï¼ˆå¦‚æœæœ‰æ–°ä¾èµ–ï¼‰
- [ ] æäº¤ä»£ç åˆ°Git
- [ ] æ¨é€åˆ°GitHub

### æœåŠ¡å™¨éƒ¨ç½²

- [ ] SSHç™»å½•æœåŠ¡å™¨
- [ ] `cd /home/appuser/patent-app`
- [ ] `git pull origin main`
- [ ] æ£€æŸ¥æ˜¯å¦æœ‰æ–°ä¾èµ–ï¼š`venv311/bin/pip install -r requirements.txt --upgrade`
- [ ] é‡å¯æœåŠ¡ï¼š`sudo systemctl restart patent-app`
- [ ] éªŒè¯æœåŠ¡çŠ¶æ€ï¼š`sudo systemctl status patent-app`
- [ ] æµ‹è¯•ç½‘ç«™åŠŸèƒ½

## ä¸€é”®éƒ¨ç½²è„šæœ¬

åˆ›å»º `scripts/deploy_update.sh`ï¼ˆåœ¨æœåŠ¡å™¨ä¸Šï¼‰ï¼š

```bash
#!/bin/bash
# é˜¿é‡Œäº‘ä¸€é”®æ›´æ–°è„šæœ¬

cd /home/appuser/patent-app

echo "=== æ‹‰å–æœ€æ–°ä»£ç  ==="
git pull origin main

echo "=== æ›´æ–°ä¾èµ– ==="
venv311/bin/pip install -r requirements.txt --upgrade

echo "=== æ¸…é™¤Pythonç¼“å­˜ ==="
find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
find . -type f -name '*.pyc' -delete 2>/dev/null || true

echo "=== é‡å¯æœåŠ¡ ==="
sudo systemctl restart patent-app

echo "=== ç­‰å¾…æœåŠ¡å¯åŠ¨ ==="
sleep 3

echo "=== æ£€æŸ¥æœåŠ¡çŠ¶æ€ ==="
sudo systemctl status patent-app --no-pager | head -15

echo "=== éƒ¨ç½²å®Œæˆï¼==="
```

ä½¿ç”¨æ–¹æ³•ï¼š
```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
bash /home/appuser/patent-app/scripts/deploy_update.sh
```

## æ€»ç»“

âœ… **ä»£ç æ›´æ–°**ï¼šé€šè¿‡Git Pullï¼Œç®€å•å¿«é€Ÿ
âœ… **ç¯å¢ƒéš”ç¦»**ï¼šè™šæ‹Ÿç¯å¢ƒå’Œé…ç½®ä¸å—å½±å“
âœ… **ä¾èµ–ç®¡ç†**ï¼šé€šè¿‡requirements.txtç»Ÿä¸€ç®¡ç†
âœ… **æœåŠ¡ç¨³å®š**ï¼šsystemdé…ç½®ä¸€æ¬¡æ€§è®¾ç½®

è¿™æ ·ä½ å°±å¯ä»¥ï¼š
1. åœ¨æœ¬åœ°å¼€å‘å’Œæµ‹è¯•
2. æ¨é€åˆ°GitHub
3. åœ¨æœåŠ¡å™¨ä¸Šç®€å•æ‰§è¡Œ `git pull` + `systemctl restart`
4. ç¯å¢ƒé…ç½®å®Œå…¨ä¸å—å½±å“

**ç°åœ¨å…ˆè¿è¡Œ `ä¿®å¤venv311å’ŒRapidOCR.bat` å®Œæˆç¯å¢ƒé…ç½®ï¼Œè¿™æ˜¯ä¸€æ¬¡æ€§çš„æ“ä½œã€‚ä¹‹åæ‰€æœ‰ä»£ç æ›´æ–°éƒ½å¯ä»¥é€šè¿‡Git Pullå®Œæˆï¼**
