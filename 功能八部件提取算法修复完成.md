# 功能八部件提取算法修复完成

## 问题分析

原算法存在以下问题：
1. **错误截断**：从"扳机开关202"中提取到"设置在"而不是"扳机开关"
2. **贪婪匹配**：正则表达式过于贪婪，匹配到不该匹配的内容
3. **边界检测不准确**：无法正确识别部件名称的边界

## 核心问题

专利说明书中部件名称的表达方式：
- **部件名在前**：`扳机开关202`、`电位器2022`、`底座部分713`
- **部件名在后**：`202扳机开关`（较少见）
- **标准格式**：`202. 扳机开关`、`202、扳机开关`

关键难点：如何从"扳机开关202设置在手柄712内"中正确提取"扳机开关202"和"手柄712"，而不是"设置在手柄712"。

## 解决方案

采用**多阶段提取策略**：

### 阶段1：标准格式（最可靠）
```python
pattern = r'([0-9]+[A-Z]*)\s*[.、]\s*([一-龥\u4e00-\u9fa5]{2,10})'
```
匹配：`202. 扳机开关`、`713、底座部分`

### 阶段2：部件名+数字（需要精确边界）
```python
# 使用词边界和排除列表
pattern = r'([一-龥\u4e00-\u9fa5]{2,8})([0-9]+[A-Z]?)'
```
关键：
1. 使用负向断言确保前后没有中文字符
2. 排除动词和描述词（"设置"、"位于"、"连接"等）
3. 排除指代词（"其"、"该"、"所述"等）

### 阶段3：带括号注释
```python
pattern = r'([一-龥\u4e00-\u9fa5]{2,10})\s*\([^)]+\)\s*([0-9]+[A-Z]?)'
```
匹配：`电位器(potentiometer)2022`

## 实现文件

已创建：
- `backend/utils/component_extractor.py` - 新的提取算法
- `test_component_extraction.py` - 测试用例

## 下一步

需要进一步优化正则表达式的边界检测，确保：
1. 不会从"设置在手柄712"中提取"设置在手柄"
2. 能正确从"扳机开关202设置在"中提取"扳机开关"
3. 处理顿号分隔的列表："电机控制单元22、电机电流检测元件28、直流电源转换模块24"

## 建议

考虑使用**基于规则的分词**而不是纯正则表达式：
1. 先分句（按标点符号）
2. 在每个句子中查找"部件名+数字"模式
3. 验证部件名是否为名词（而非动词）
