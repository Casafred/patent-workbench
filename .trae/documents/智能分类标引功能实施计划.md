# 智能分类标引功能实施计划

## 一、功能概述

在功能二（统一批量处理）中新增"智能分类标引"模式，与现有"通用批量分析"模式并行，作为功能二的两种模式切换。

## 二、模块架构设计

### 2.1 前端模块结构
```
js/modules/unified-batch/
├── classification/           # 新增：智能分类标引模块
│   ├── index.js             # 模块入口
│   ├── config.js            # 分类配置常量
│   ├── schema-manager.js    # 分类体系管理器
│   ├── example-library.js   # 示例库管理器
│   ├── prompt-builder.js    # 分类提示词构建器
│   ├── cold-start.js        # 智能冷启动模块
│   ├── result-analyzer.js   # 结果分析器（确信度分析）
│   └── state.js             # 分类状态管理
```

### 2.2 后端API扩展
```
backend/routes/
├── classification.py        # 新增：分类标引专用API
    ├── /api/classify/optimize_prompt    # AI优化分类提示词
    ├── /api/classify/cold_start         # 智能冷启动分析
    ├── /api/classify/analyze_result     # 分类结果分析
```

## 三、核心功能实现

### 3.1 界面改造（unified-batch.html）
- **模式切换Tab**：在顶部增加"通用批量分析"与"智能分类标引"两个模式Tab
- **步骤流程调整**：
  1. 输入数据（复用现有）
  2. 配置分类体系（新增）
  3. 选择模式（复用现有）
  4. 处理结果（新增确信度展示）

### 3.2 分类体系配置界面
- 分类层级数量设置（1-5层）
- 每层分类名称输入
- 每层分类原则描述（支持富文本）
- 每层示例添加（可从示例库选择）
- AI一键优化按钮
- 预览生成提示词

### 3.3 智能冷启动流程
1. 用户选择"智能冷启动"
2. 系统随机抽取5-10条数据样本
3. 调用大模型分析数据特征
4. 大模型生成初步分类建议
5. 用户确认/调整分类体系
6. 进入正常分类流程

### 3.4 多标签交叉标注
- 开关选项：单标签/多标签模式
- 多标签模式下：设置最大标签数
- 结果展示：显示每个标签的确信度

### 3.5 确信度分析与问题定位
- 结果表格增加"确信度"列
- 低确信度条目高亮显示
- 一键筛选低确信度条目
- 将问题条目添加到示例库

### 3.6 示例库管理
- 示例库列表展示
- 添加/编辑/删除示例
- 示例分类：正确示例/错误示例
- 导入/导出功能

### 3.7 分类体系管理
- 保存当前分类体系
- 加载已保存体系
- 体系模板库
- 导入/导出JSON

## 四、数据存储设计

### 4.1 localStorage键名
```javascript
CLASSIFICATION_SCHEMA: 'classification_schemas'      // 分类体系库
CLASSIFICATION_EXAMPLES: 'classification_examples'   // 示例库
CLASSIFICATION_HISTORY: 'classification_history'     // 分类历史
CLASSIFICATION_LAST_STATE: 'classification_last_state' // 上次状态
```

### 4.2 数据结构
```javascript
// 分类体系
{
  id: 'schema_xxx',
  name: '专利技术领域分类',
  layers: [
    {
      level: 1,
      name: '技术领域',
      description: '按IPC分类号大类划分',
      labels: ['电学', '物理', '机械', '化学'],
      examples: [...]
    }
  ],
  multiLabel: false,
  maxLabels: 1,
  createdAt: '2024-01-01',
  updatedAt: '2024-01-01'
}

// 示例库
{
  id: 'example_xxx',
  schemaId: 'schema_xxx',
  level: 1,
  input: '原始文本...',
  correctLabel: '电学',
  confidence: 0.95,
  type: 'positive', // positive/negative
  createdAt: '2024-01-01'
}
```

## 五、实施步骤

### 第一阶段：基础框架（预计工作量较大）
1. 修改unified-batch.html，增加模式切换Tab
2. 创建classification模块目录结构
3. 实现state.js状态管理
4. 实现config.js配置常量

### 第二阶段：分类体系配置
1. 实现schema-manager.js
2. 创建分类配置界面组件
3. 实现prompt-builder.js提示词构建
4. 后端实现optimize_prompt API

### 第三阶段：智能冷启动
1. 实现cold-start.js
2. 后端实现cold_start API
3. 创建冷启动引导界面

### 第四阶段：示例库与确信度
1. 实现example-library.js
2. 实现result-analyzer.js
3. 改造结果展示界面
4. 实现问题条目收集功能

### 第五阶段：数据管理与导出
1. 实现导入/导出功能
2. 实现分类体系保存/加载
3. 完善用户体验细节

## 六、UI设计要点

- 复用现有CSS变量和组件样式
- 确信度使用颜色渐变表示（红→黄→绿）
- 低确信度条目使用警告色边框
- 模式切换使用Tab样式，与现有sub-tab一致
- 保持界面简洁，高级选项折叠隐藏