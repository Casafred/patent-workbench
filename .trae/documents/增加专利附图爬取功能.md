# 实现专利附图爬取功能的计划

## 1. 需求分析

* 用户需要使用BeautifulSoup爬取专利附图

* 现有爬虫已经使用BeautifulSoup爬取专利文本数据

* 需要在现有架构基础上扩展图片爬取功能

## 2. 技术实现方案

### 2.1 数据结构扩展

* 修改`SimplePatentData`类，增加`drawings`字段用于存储附图URL列表

* 类型：`List[str]`，默认为空列表

### 2.2 核心实现逻辑

1. **图片URL提取**：

   * 在`_extract_patent_data`方法中增加图片提取逻辑

   * 优先从JSON-LD中查找图片信息（如果存在）

   * 作为备选方案，使用HTML选择器提取图片标签

   * 针对Google Patents页面结构，使用合适的CSS选择器定位附图

2. **图片提取策略**：

   * 查找包含附图的section或div元素

   * 提取所有img标签的src属性

   * 处理相对URL，转换为绝对URL

   * 去重处理，避免重复图片

3. **API集成**：

   * 确保爬取的图片URL包含在API响应中

   * 保持与现有API格式兼容

### 2.3 代码修改点

1. **`backend/scraper/simple_scraper.py`**：

   * 修改`SimplePatentData`类，增加`drawings`字段

   * 在`_extract_patent_data`方法中添加图片提取逻辑

   * 实现图片URL的提取、处理和存储

2. **`app.py`**：

   * 确保API响应包含图片数据

   * 无需重大修改，因为数据会自动包含在返回结果中

## 3. 实现步骤

### 步骤1：扩展数据结构

* 在`SimplePatentData`类中添加`drawings`字段

* 初始化时设置为空列表

### 步骤2：实现图片提取逻辑

1. **JSON-LD提取**：检查JSON-LD数据中是否包含图片信息
2. **HTML选择器提取**：

   * 查找包含附图的容器元素

   * 提取所有img标签

   * 处理URL并去重

### 步骤3：测试与验证

* 使用现有测试框架测试图片爬取功能

* 验证不同类型专利的图片爬取效果

* 确保API响应包含正确的图片URL

## 4. 预期效果

* 爬虫能够从Google Patents爬取专利附图的URL

* 附图URL包含在API响应中

* 支持批量爬取时同时获取附图

* 保持与现有功能的兼容性

* 具有良好的错误处理机制

## 5. 技术要点

* BeautifulSoup完全支持图片URL提取

* 需要正确处理Google Patents页面的动态加载特性

* 确保图片URL的完整性和正确性

* 实现高效的图片提取算法，不影响现有功能性能

