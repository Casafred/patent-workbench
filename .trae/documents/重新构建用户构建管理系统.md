# 重新构建用户构建管理系统计划

## 现状分析

### 当前系统
- 使用 `init_users.py` 在部署时生成固定的两个测试账号（admin/admin123 和 demo/demo123）
- 用户信息存储在 `users.json` 文件中，使用密码哈希
- 认证服务 `AuthService` 负责用户验证和IP管理
- 部署配置在 `render.yaml` 中，构建命令执行 `python init_users.py`

### 现有工具
- `tools/generate_user.py` 是一个命令行工具，用于在本地安全地添加或更新用户到 `users.json`
- 支持交互式添加用户，生成哈希密码

## 改进计划

### 1. 整合用户管理工具
- 将 `generate_user.py` 升级为完整的用户管理工具
- 提供命令行参数支持，便于脚本化操作
- 增加用户列表、删除用户等功能

### 2. 重构用户初始化流程
- 修改 `init_users.py`，使其支持从配置文件或环境变量读取用户信息
- 保留向后兼容性，同时支持新的用户管理方式

### 3. 增强部署配置
- 更新 `render.yaml` 配置，支持在部署时指定用户配置
- 提供环境变量选项，允许在部署时自定义用户

### 4. 完善用户管理功能
- 增加用户权限管理（可选）
- 提供用户信息查看和修改功能
- 支持密码重置和更改

### 5. 安全性增强
- 确保所有密码都使用强哈希算法
- 增加密码强度检查
- 提供安全的用户管理最佳实践

## 实现步骤

### 步骤1：升级 generate_user.py 工具
- 添加命令行参数支持
- 增加用户管理功能
- 提供帮助文档

### 步骤2：重构 init_users.py
- 支持从配置文件读取用户信息
- 支持环境变量配置
- 保留默认用户作为后备

### 步骤3：更新部署配置
- 修改 render.yaml，支持新的用户管理方式
- 提供部署时的用户配置选项

### 步骤4：测试和验证
- 测试用户添加、删除功能
- 测试部署流程
- 验证认证系统的兼容性

## 预期结果

- 一个灵活的用户构建管理系统，支持在部署时和运行时管理用户
- 与现有认证系统无缝集成
- 提供安全的用户管理功能
- 简化用户配置和部署流程