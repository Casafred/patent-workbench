# 功能七多问题修复计划

## 问题分析

### 1. 弹窗宽度问题

* **问题**：权利要求详情弹窗宽度较窄，影响用户体验

* **原因**：模态框内容宽度设置过小

### 2. EXCEL导出原表行数识别问题

* **问题**：原数据行号没有减去表头，导致行号错位

* **原因**：行号计算逻辑不一致，导出和搜索使用不同算法

### 3. 多语言权利要求识别问题

* **问题**：德语、日语权利要求字样没有识别出来（如ansprunch等）

* **原因**：语言识别顺序不正确，应该是中-英-其他语言的顺序

### 4. 引用关系图节点显示问题

* **问题**：同一个权利要求号在图中出现多次

* **原因**：节点合并逻辑缺失，每个引用都创建了新节点

### 5. 权利要求引用问题

* **问题**：当权利要求字样附近没有数字时，没有默认引用所有权利要求

* **原因**：引用识别逻辑不完整

## 修复方案

### 1. 修复弹窗宽度

* **修改文件**：`js/claimsProcessorIntegrated.js`

* **修改内容**：调整`showSimpleClaimModal`函数中模态框内容的最大宽度

* **具体修改**：将`max-width: 600px`改为更大的值，如`max-width: 800px`

### 2. 统一EXCEL行号计算

* **修改文件**：`backend/routes/claims.py`

* **修改内容**：统一行号计算逻辑，原数据行号减去表头行（减一）

* **具体修改**：确保导出和搜索功能使用相同的行号计算方法

### 3. 优化多语言权利要求识别

* **修改文件**：`patent_claims_processor/processors/claims_parser.py`

* **修改内容**：调整语言识别顺序，优先识别中文，然后是英文，最后是其他语言

* **具体修改**：添加德语、日语等语言的权利要求关键词识别

### 4. 修复引用关系图节点显示

* **修改文件**：`js/claimsProcessorIntegrated.js`

* **修改内容**：在`claimsBuildVisualizationData`函数中添加节点合并逻辑

* **具体修改**：使用Map或对象存储节点，确保每个权利要求号只创建一个节点

### 5. 完善权利要求引用识别

* **修改文件**：`patent_claims_processor/processors/claims_parser.py`

* **修改内容**：添加默认引用所有权利要求的逻辑

* **具体修改**：当权利要求字样附近没有数字时，默认引用所有权利要求

## 实施步骤

1. **修复弹窗宽度**：修改模态框样式
2. **统一行号计算**：修改后端行号处理逻辑
3. **优化语言识别**：修改语言识别顺序和关键词识别
4. **修复节点显示**：修改前端节点合并逻辑
5. **完善引用识别**：修改后端引用识别逻辑

## 验证步骤

1. **测试弹窗宽度**：点击节点，检查弹窗宽度是否合适
2. **测试行号计算**：导出Excel和搜索专利号，检查行号是否一致
3. **测试多语言识别**：使用德语、日语权利要求测试识别效果
4. **测试节点显示**：生成引用图，检查节点是否重复
5. **测试引用识别**：测试权利要求引用逻辑，特别是无数字引用的情况

## 预期效果

* 弹窗宽度合适，内容显示完整

* Excel导出和搜索的行号一致且正确

* 德语、日语等多语言权利要求能正确识别

* 引用关系图中每个权利要求号只显示一个节点

* 权利要求引用逻辑完整，包括无数字引用的情况

