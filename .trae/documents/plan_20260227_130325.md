# 暗夜模式实现计划（保守方案）

## 核心原则
- **正常模式优先**: 完全不修改现有样式，确保正常模式100%正常
- **增量式添加**: 暗夜模式作为独立增量，通过CSS选择器隔离
- **渐进增强**: 暗夜模式后续可逐步优化

---

## 实施步骤

### 步骤1: 扩展CSS变量（不修改现有变量）
在 `variables.css` 末尾添加暗夜模式变量块：
```css
/* 暗夜模式变量 - 仅在 [data-theme="dark"] 时生效 */
[data-theme="dark"] {
    --bg-color: #0f172a;
    --surface-color: #1e293b;
    --text-color: #e2e8f0;
    --text-color-secondary: #94a3b8;
    --border-color: rgba(100, 116, 139, 0.3);
    --chat-bg: #1e293b;
    --chat-user-bubble: #22C55E;
    --chat-assistant-bubble: #334155;
    /* ... 其他变量 */
}
```

### 步骤2: 创建独立的暗夜模式样式文件
新建 `frontend/css/base/dark-theme.css`：
- 使用 `[data-theme="dark"]` 选择器前缀
- 只覆盖必要的硬编码颜色
- 不影响任何现有样式

### 步骤3: 添加主题切换按钮
在header组件中添加切换按钮：
- 使用太阳/月亮图标
- 添加到现有header区域
- 样式使用CSS变量，兼容两种模式

### 步骤4: 添加主题切换JS逻辑
创建 `js/core/theme-manager.js`：
- 读取/保存localStorage偏好
- 切换 `data-theme` 属性
- 支持跟随系统主题

### 步骤5: 在index.html引入新文件
- 引入 `dark-theme.css`
- 引入 `theme-manager.js`

---

## 文件修改清单

| 文件 | 操作 | 风险等级 |
|------|------|----------|
| `variables.css` | 末尾追加暗夜变量 | 低 |
| `dark-theme.css` | 新建文件 | 无 |
| `theme-manager.js` | 新建文件 | 无 |
| `header.html` | 添加切换按钮 | 低 |
| `index.html` | 引入新文件 | 低 |

**不修改任何现有样式代码，只做增量添加！**

---

## 预期效果

1. 默认保持现有绿色主题不变
2. 点击切换按钮可切换到暗夜模式
3. 暗夜模式基本可用，后续可逐步优化
4. 用户选择自动保存，下次访问自动应用