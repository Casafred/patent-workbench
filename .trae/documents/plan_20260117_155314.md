# 集成专利公开号查询和权利要求引用图功能

## 问题分析

通过分析代码，我发现当前功能七存在以下问题：

1. **专利号列选择问题**：虽然前端有专利号列选择功能，但没有智能识别最有可能是专利公开号的列

2. **公开号查询功能缺失**：当前只能通过Excel中的专利号列进行搜索，不能直接通过公开号查询

3. **引用图生成关联问题**：专利查询与权利要求引用图生成没有直接关联

4. **数据结构不匹配**：当前的权利要求处理结果与专利查询结果的数据结构没有关联

## 修复方案

### 1. 智能识别专利公开号列

* 在文件上传后，自动分析所有列，识别最有可能包含专利公开号的列

* 基于列名和内容模式进行识别（例如包含"公开号"、"专利号"、"Patent No"等关键词）

* 在前端显示识别结果，并允许用户手动调整

### 2. 增强公开号查询功能

* 扩展后端专利查询API，支持通过公开号片段搜索

* 前端添加公开号查询输入框，允许用户直接输入公开号进行搜索

* 搜索结果显示专利基本信息和对应的Excel行号

### 3. 关联权利要求解析结果与专利查询

* 修改数据结构，将专利公开号与权利要求解析结果关联

* 当用户选择搜索结果时，自动定位到对应的权利要求解析结果

* 基于该专利的权利要求解析结果生成引用图

### 4. 优化前端用户界面

* 重新设计专利查询和可视化区域，使其更加直观

* 添加公开号查询专用输入框和搜索按钮

* 优化搜索结果显示，包含更多专利信息

* 确保引用图生成按钮在选择专利后可用

## 具体修改点

### 后端修改

1. **`backend/routes/patent.py`**：

   * 扩展专利查询API，支持通过公开号搜索

   * 添加专利号与权利要求解析结果的关联逻辑

2. **`backend/routes/claims.py`**：

   * 修改文件上传处理，添加专利公开号列智能识别

   * 添加专利号与权利要求解析结果的关联存储

### 前端修改

1. **`js/claimsProcessor.js`**：

   * 修改专利查询逻辑，支持公开号查询

   * 优化智能列识别结果显示

   * 修改引用图生成逻辑，基于选择的专利生成

2. **`frontend/claims_processor.html`**：

   * 重新设计专利查询和可视化区域

   * 添加公开号查询专用输入框

   * 优化搜索结果显示布局

### 数据结构修改

1. **`patent_claims_processor/models.py`**：

   * 添加专利公开号字段到处理结果中

   * 确保权利要求解析结果与专利公开号关联

## 验证步骤

1. 上传包含权利要求和专利公开号的Excel文件

2. 验证系统是否自动识别专利公开号列

3. 在公开号查询输入框中输入公开号片段进行搜索

4. 选择搜索结果，验证是否显示对应的专利信息

5. 点击生成引用图按钮，验证是否基于选择的专利生成权利要求引用图

6. 测试不同类型的专利公开号格式

7. 验证所有测试用例通过

## 预期结果

修复后，功能七应该能够：

* 智能识别Excel中的专利公开号列

* 允许用户通过公开号片段进行搜索

* 显示搜索结果并允许用户选择

* 基于选择的专利生成权利要求引用图

* 提供良好的用户界面和交互体验

