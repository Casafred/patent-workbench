## 功能六优化实施计划

### 优化①：完善专利详情导出到Excel的内容

**问题分析**：当前 `patent-export.js` 只导出基础字段（专利号、标题、申请人、发明人、申请日、公开日、摘要、AI解读），缺少爬取的主要内容。

**解决方案**：扩展 `exportPatentResultsToExcel` 函数，增加以下导出字段：
- CPC分类、技术领域、优先权日期
- 同族ID、同族申请列表
- 引用专利、被引用专利、相似文档（专利号列表）
- 权利要求、说明书
- 事件时间轴、法律事件

**修改文件**：`js/main/patent-export.js`

---

### 优化②：实现批量解读即时展示功能

**问题分析**：当前批量解读需要等待所有专利解读完成才能在弹窗/新标签页中看到解读结果。

**解决方案**：
1. 在 `tab-manager.js` 的 `analyzeAllPatents` 方法中，每完成一个专利解读后：
   - 立即更新 `window.patentBatchAnalysisResults`
   - 触发事件通知已打开的弹窗/新标签页刷新
2. 在 `main.js` 的解读循环中，每完成一个解读后：
   - 调用 `updatePatentDetailAnalysis` 更新弹窗
   - 通过 `BroadcastChannel` 或 `localStorage` 事件通知新标签页
3. 新标签页 `patentDetailNewTab.js` 监听更新事件，实时刷新解读区域

**修改文件**：
- `js/modules/patent-batch/tab-manager.js`
- `js/main.js`
- `js/patentDetailNewTab.js`

---

### 优化③：实现解读缓存和刷新覆盖功能

**问题分析**：当前只有爬取数据缓存，解读结果无法缓存，无法刷新覆盖。

**解决方案**：
1. 扩展 `patent-cache.js`，增加解读缓存功能：
   - 新增 `saveAnalysis(patentNumber, analysisData)` 方法
   - 新增 `getAnalysis(patentNumber)` 方法
   - 解读缓存键：`patent_analysis_${patentNumber}`
2. 在解读前检查缓存，有缓存则直接使用
3. 在解读按钮增加"刷新解读"选项（长按或右键菜单）
4. 解读完成后自动保存/覆盖缓存

**修改文件**：
- `js/modules/patent-batch/patent-cache.js`
- `js/modules/patent-batch/tab-manager.js`
- `js/main.js`

---

### 优化④：增加爬取解读历史记录功能

**问题分析**：用户无法查看历史爬取过的专利号，无法一键再次爬取或解读。

**解决方案**：
1. 新建 `js/modules/patent-batch/patent-history.js` 模块：
   - `addToHistory(patentNumber, action, timestamp)` - 添加历史记录
   - `getHistory()` - 获取历史记录列表
   - `clearHistory()` - 清空历史
   - 存储结构：`{patentNumber, action: 'crawl'|'analyze', timestamp, hasCache, hasAnalysis}`
2. 在功能六界面增加"历史记录"按钮和面板：
   - 显示历史专利号列表
   - 每条记录显示：专利号、操作类型、时间、缓存状态
   - 操作按钮：一键爬取、一键解读、删除记录
3. 支持批量选择历史记录进行操作

**新建文件**：
- `js/modules/patent-batch/patent-history.js`

**修改文件**：
- `frontend/components/tabs/patent-batch.html`（增加历史记录UI）
- `js/modules/init/init-patent-batch.js`（初始化历史记录模块）

---

### 实施顺序

1. **优化③**（解读缓存）- 基础功能，其他优化依赖此功能
2. **优化②**（即时展示）- 提升用户体验
3. **优化①**（完善导出）- 独立功能
4. **优化④**（历史记录）- 综合功能，整合前面所有优化