# 修复计划

## 问题1：标题生成在阿里云服务下的模型选择问题

**原因**：`chat-conversation.js` 中 `generateConversationTitle` 函数硬编码使用 'GLM-4-Flash' 模型，切换到阿里云服务时导致模型不存在错误

**修复方案**：
1. 修改 `generateConversationTitle` 函数，根据用户配置的API Key情况智能选择模型：
   - 如果同时配置了智谱和阿里云API Key → 使用智谱的免费模型 `glm-4-flash` 生成标题
   - 如果只配置了阿里云API Key → 使用用户当前选择的模型（从 `chat_model_select` 获取）
   - 如果只配置了智谱API Key → 使用智谱的免费模型 `glm-4-flash`

**修改文件**：
- `js/modules/chat/chat-conversation.js` - 修改 `generateConversationTitle` 函数

---

## 问题2：专利批量解读的API Key传递问题

**原因**：`patent.py` 的 `analyze_patent` 函数只使用 `get_zhipu_client()`，无法获取阿里云API Key

**修复方案**：
1. 修改 `patent.py` 的 `analyze_patent` 函数：
   - 使用 `get_llm_client()` 替代 `get_zhipu_client()`
   - 从请求中获取模型参数，判断使用哪个服务商
   - 如果是阿里云模型，使用阿里云客户端；否则使用智谱客户端

**修改文件**：
- `backend/routes/patent.py` - 修改 `analyze_patent` 函数

---

## 预期效果
1. 标题生成能够根据用户配置智能选择服务商和模型
2. 专利批量解读能够正确使用阿里云API Key进行调用
3. 两个功能都能正常工作，不再出现401和404错误