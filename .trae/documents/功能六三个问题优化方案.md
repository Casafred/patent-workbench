## 问题分析与修复方案

### 问题1：字段选择器要增加保存按钮

**修复方案**：
1. 在字段选择器面板底部添加"保存选择"按钮
2. 点击保存后显示保存成功提示
3. 将选中的字段保存到 localStorage 以便下次使用
4. 页面加载时自动恢复上次保存的字段选择

**修改文件**：
- `frontend/components/tabs/patent-batch.html` - 添加保存按钮HTML
- `js/modules/patent-batch/field-selector.js` - 添加保存/加载逻辑

---

### 问题2：字段选择器未生效（核心问题）

**根本原因**：
- 前端传递了 `selected_fields` 参数，但**后端完全没有使用它**
- `patent.py` 只接收 `crawl_specification` 参数，没有传递 `selected_fields` 给爬虫
- `simple_scraper.py` 的爬虫方法没有根据用户选择的字段来控制爬取内容

**修复方案**：

**后端修改**：
1. `patent.py` - 接收 `selected_fields` 参数并传递给爬虫
2. `simple_scraper.py` - 修改爬虫方法，根据 `selected_fields` 控制爬取哪些字段

**前端修改**：
1. 确保 `getSelectedFields()` 正确返回用户选择的字段
2. 在 API 调用时正确传递 `selected_fields` 参数

**修改文件**：
- `backend/routes/patent.py` - 接收并传递 `selected_fields`
- `backend/scraper/simple_scraper.py` - 根据 `selected_fields` 控制爬取
- `js/main.js` - 确保 API 调用传递 `selected_fields`

---

### 问题3：弹窗中解读结果不能实时显示

**根本原因**：
- `analyzeAllPatents` 函数中，`window.patentBatchAnalysisResults` 数组在**所有解读完成后**才填充
- 弹窗打开时从 `window.patentBatchAnalysisResults` 获取结果，所以看不到实时更新

**修复方案**：
1. 在 `analyzeAllPatents` 中，每解读完一个专利就立即添加到 `window.patentBatchAnalysisResults`
2. 优化 `updatePatentDetailAnalysis` 函数，确保弹窗能实时显示解读结果

**修改文件**：
- `js/modules/patent-batch/tab-manager.js` - 修改 `analyzeAllPatents` 函数
- `js/main/patent-detail-html.js` - 优化 `updatePatentDetailAnalysis` 函数

---

## 实施步骤

1. **修复问题2**：后端接收并使用 `selected_fields` 参数（最关键）
2. **修复问题1**：添加保存按钮和保存/加载逻辑
3. **修复问题3**：修改批量解读逻辑，实现弹窗实时更新