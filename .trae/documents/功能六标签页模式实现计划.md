## 功能六标签页模式实现计划

### 需求概述
为功能六（批量专利查询与解读）添加浏览器式标签页模式，允许用户在保有原始批量查询结果的同时，对同族专利、引用/被引用专利、相似专利进行并列分析。

### 实现方案

#### 1. 新增文件结构
```
js/modules/patent-batch/
├── tab-manager.js          # 标签页管理器核心模块
├── relation-batch-crawler.js # 关系专利批量爬取模块
└── tab-patent-results.js   # 标签页内专利结果渲染

frontend/components/tabs/
└── patent-batch-tabs.html  # 标签页容器HTML（可选，也可用JS动态创建）
```

#### 2. 核心功能实现

**2.1 标签页管理器 (tab-manager.js)**
- 创建 `PatentTabManager` 类管理所有标签页
- 每个标签页包含：标题（显示来源专利号+关系类型）、内容区域、关闭按钮
- 支持标签页切换、关闭、新建
- 标签页状态持久化（可选）

**2.2 关系专利批量爬取 (relation-batch-crawler.js)**
- 复用现有 `performPatentSearch` 逻辑
- 新增 `crawlRelationPatents(patentNumber, relationType, patentNumbers)` 函数
- 支持爬取同族/引用/被引用/相似专利的完整信息
- 显示独立进度条

**2.3 标签页内结果渲染 (tab-patent-results.js)**
- 复刻主页面专利条带列表样式
- 支持弹窗查看详情
- 支持新标签页打开详情
- 显示来源信息头部（如："CN123456789 的同族专利分析结果"）

#### 3. 界面修改

**3.1 patent-batch.html 修改**
- 在查询结果区域下方添加标签页容器：
```html
<div id="patent_batch_tabs_container" class="patent-batch-tabs-container" style="display: none;">
    <div class="tabs-header" id="patent_batch_tabs_header"></div>
    <div class="tabs-content" id="patent_batch_tabs_content"></div>
</div>
```

**3.2 同族/引用/相似专利列表添加操作按钮**
在 [js/patentDetailNewTab.js](file:///c:/Users/sdh777/Desktop/开发/智能请求体前后端测试/patent-workbench%20v26%20稳定完美版%2004%20-%20副本%20-%20副本%20-%20副本%20-%20副本/js/patentDetailNewTab.js) 的同族、引用、被引用、相似文档表格上方添加：
```html
<button class="analyze-relation-btn" onclick="openRelationInNewTab('${patentNumber}', 'family')">
    🔍 在新标签页分析这些同族专利
</button>
```

#### 4. 样式设计

**4.1 标签页样式**
- 类似Chrome浏览器的标签页设计
- 当前标签页高亮显示
- 支持标签页过多时横向滚动
- 每个标签页显示关闭按钮（hover时显示）

**4.2 来源标识**
- 每个标签页内容区域顶部显示醒目的来源信息横幅
- 显示：来源专利号 + 关系类型（同族/引用/被引用/相似）+ 专利数量

#### 5. 数据流设计

```
用户点击"分析同族专利"按钮
    ↓
提取该专利的所有同族专利号
    ↓
创建新标签页（显示加载状态）
    ↓
调用后端批量查询API（复用现有接口）
    ↓
实时更新进度
    ↓
渲染结果列表（复刻主页面样式）
    ↓
用户可在不同标签页间切换对比
```

#### 6. 关键代码逻辑

**6.1 打开关系分析标签页**
```javascript
window.openRelationAnalysisTab = function(sourcePatentNumber, relationType, relationData) {
    // relationType: 'family' | 'citations' | 'cited_by' | 'similar'
    // relationData: 同族/引用/被引用/相似专利的列表数据
    
    const patentNumbers = extractPatentNumbers(relationData);
    const tabId = tabManager.createTab({
        title: `${sourcePatentNumber} 的${getRelationTypeName(relationType)}`,
        sourcePatent: sourcePatentNumber,
        relationType: relationType
    });
    
    // 开始批量爬取
    crawlPatentsInTab(tabId, patentNumbers);
};
```

**6.2 标签页内容渲染**
- 复用主页面的 `renderPatentResults` 逻辑
- 添加来源信息头部
- 保持与主页面一致的交互（弹窗、新标签页打开等）

#### 7. 集成步骤

1. **创建新模块文件** - tab-manager.js、relation-batch-crawler.js、tab-patent-results.js
2. **修改 patentDetailNewTab.js** - 在同族/引用/相似区块添加"分析"按钮
3. **修改 patent-batch.html** - 添加标签页容器
4. **修改 main.js** - 导入新模块，初始化标签页管理器
5. **添加CSS样式** - 在现有样式文件中添加标签页相关样式

#### 8. 边界情况处理

- **空数据**：如果某关系类型没有数据，提示用户并阻止创建标签页
- **重复点击**：同一来源+关系类型的标签页已存在时，切换到该标签页而非新建
- **大量数据**：同族/引用专利过多时，显示确认对话框（如"发现50个同族专利，是否继续？"）
- **爬取失败**：显示错误信息，提供重试按钮

### 预期效果

1. 用户在查看某个专利详情时，可以点击"分析同族专利"等按钮
2. 在功能六页面下方出现标签页栏，新标签页显示加载状态
3. 爬取完成后，标签页内显示该关系类型的专利列表（与主页面样式一致）
4. 用户可以在原始结果标签页和各关系分析标签页之间自由切换
5. 每个标签页顶部清晰显示来源信息（如"CN123456789 的同族专利分析结果"）
6. 标签页内的专利同样支持弹窗查看详情和新标签页打开完整详情

请确认此计划后，我将开始实施具体的代码修改。