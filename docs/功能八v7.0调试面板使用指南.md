# 功能八v7.0 - 调试面板使用指南 📖

## 🎯 如何调出调试面板

### 方式1：使用测试页面（推荐）

**最简单的方式**，直接访问专门的测试页面：

```
http://你的服务器IP/test_interactive_marker_v7_debug.html
```

或者如果有域名：
```
http://ipx.asia/test_interactive_marker_v7_debug.html
```

**操作步骤**：
1. 打开测试页面
2. 上传附图（点击或拖拽）
3. 输入说明书文本
4. 点击"开始处理"
5. 自动显示调试面板

### 方式2：在主页面使用（已集成）

在主页面 `index.html` 的功能八中使用：

```
http://你的服务器IP/
```

**操作步骤**：
1. 登录系统
2. 进入"功能八：交互式附图标注"
3. 上传附图
4. 输入说明书
5. 点击"开始处理"
6. **向下滚动**，在Canvas下方会看到调试面板

## 📊 调试面板位置

调试面板会显示在**交互式Canvas的下方**：

```
┌─────────────────────────────────┐
│  功能八：交互式附图标注          │
├─────────────────────────────────┤
│  [上传附图区域]                  │
│  [说明书输入区域]                │
│  [开始处理按钮]                  │
├─────────────────────────────────┤
│  📊 处理结果统计                 │
├─────────────────────────────────┤
│  🖼️ 交互式Canvas                │
│  [附图显示 + 标注]               │
│  [工具栏按钮]                    │
├─────────────────────────────────┤
│  🔍 调试信息面板 ← 在这里！      │
│  ┌──────────┬──────────┐        │
│  │ OCR识别  │ 说明书   │        │
│  │ 结果     │ 提取结果 │        │
│  └──────────┴──────────┘        │
└─────────────────────────────────┘
```

## 🔍 调试面板内容

### 左侧：附图OCR识别结果

显示所有OCR识别到的标号：

```
📷 附图OCR识别结果

统计信息：
• 原始识别: 15 个标号
• 过滤后: 12 个标号
• 匹配成功: 10 个标号

┌──────────────────────┐
│ 标号: 71             │ 🟢 绿色 = 已匹配
│ 位置: (150, 200)     │
│ 置信度: 95%          │
│ ✅ 已匹配 → 机壳     │
└──────────────────────┘

┌──────────────────────┐
│ 标号: 99             │ 🟡 黄色 = 未匹配
│ 位置: (300, 400)     │
│ 置信度: 88%          │
│ ⚠️ 未匹配            │
└──────────────────────┘
```

### 右侧：说明书提取结果

显示说明书中提取的所有部件：

```
📝 说明书提取结果

统计信息：
• 总部件数: 12 个
• 已识别: 10 个
• 匹配率: 83%

┌──────────────────────┐
│ 71: 机壳             │ 🟢 绿色 = 已识别
│ ✅ 已在附图中识别    │
└──────────────────────┘

┌──────────────────────┐
│ 713: 底座部分        │ 🔴 红色 = 未识别
│ ❌ 未在附图中识别    │
└──────────────────────┘
```

## 🎨 颜色含义

- 🟢 **绿色**：成功匹配/识别
- 🟡 **黄色**：OCR识别到但未匹配到说明书
- 🔴 **红色**：说明书中有但未在附图中识别

## 💡 使用场景

### 场景1：检查OCR识别准确性

**问题**：不确定OCR是否正确识别了所有标号

**操作**：
1. 查看左侧"附图OCR识别结果"
2. 检查"原始识别"数量
3. 查看每个标号的置信度
4. 对比附图，验证是否有遗漏

### 场景2：检查说明书提取完整性

**问题**：不确定说明书是否完整提取

**操作**：
1. 查看右侧"说明书提取结果"
2. 检查"总部件数"是否正确
3. 查看列表，确认所有部件都被提取
4. 如有遗漏，调整说明书格式

### 场景3：定位匹配问题

**问题**：匹配率低，不知道原因

**操作**：
1. 对比左右两侧列表
2. 查看🟡黄色标号（OCR识别但未匹配）
   - 可能是噪声或其他图纸的标号
3. 查看🔴红色部件（说明书有但未识别）
   - 可能是OCR未识别或图片中没有
4. 根据情况优化图片或说明书

### 场景4：优化识别参数

**问题**：想提高识别准确率

**操作**：
1. 查看"平均置信度"
2. 如果置信度低（<80%）：
   - 提高图片质量
   - 调整图片对比度
   - 使用更清晰的扫描件
3. 如果有大量未匹配标号：
   - 检查说明书格式
   - 确认标号编号一致

## 🚀 快速访问

### 本地测试
```bash
# 启动服务
python app.py

# 浏览器访问
http://localhost:5000/test_interactive_marker_v7_debug.html
```

### 服务器访问

**测试页面**：
```
http://你的服务器IP/test_interactive_marker_v7_debug.html
```

**主页面**：
```
http://你的服务器IP/
# 进入功能八，处理后向下滚动查看调试面板
```

## 📱 移动端支持

调试面板支持移动端访问，会自动适配屏幕大小：
- 双列布局在小屏幕上会变为单列
- 列表支持滚动查看
- 触摸友好的交互

## ⚙️ 配置选项

如果你想在某些情况下**隐藏调试面板**，可以修改代码：

```javascript
// 在 frontend/index.html 中找到这段代码
const marker = new InteractiveDrawingMarker(
    canvasId,
    originalDrawing.dataUrl,
    processedDrawing.detected_numbers || [],
    currentReferenceMap,
    {
        enableModal: true,
        enableDebugPanel: false,  // 改为 false 禁用调试面板
        debugInfo: processedDrawing.debug_info,
        // ...
    }
);
```

## 🐛 故障排查

### 问题1：调试面板不显示

**检查**：
1. 确认已部署最新代码
2. 清除浏览器缓存（Ctrl+F5）
3. 检查浏览器控制台是否有错误
4. 确认API返回了debug_info数据

**解决**：
```bash
# 在服务器上
cd /root/patent_system
git pull origin main
systemctl restart patent_system

# 清除浏览器缓存后重试
```

### 问题2：调试面板显示空白

**原因**：API可能没有返回调试信息

**检查**：
```javascript
// 在浏览器控制台查看API响应
console.log('API response:', apiResponse);
console.log('Debug info:', apiResponse.data.drawings[0].debug_info);
```

**解决**：确认后端已更新到v7.0版本

### 问题3：数据不准确

**检查**：
1. 查看API响应的完整数据
2. 确认OCR识别正常工作
3. 验证说明书提取算法

## 📚 相关文档

- **详细功能说明**：`功能八v7.0调试面板完成.md`
- **部署指南**：`功能八v7.0快速部署.md`
- **示例说明**：`功能八v7.0调试面板示例.md`
- **总览文档**：`功能八v7.0_README.md`

## 💬 常见问题

**Q: 调试面板会影响性能吗？**
A: 不会。调试信息仅在前端渲染，不影响API性能。

**Q: 可以导出调试信息吗？**
A: 目前不支持，但可以通过浏览器控制台复制数据。

**Q: 调试面板可以自定义样式吗？**
A: 可以，通过CSS覆盖`.drawing-marker-debug-panel`类的样式。

**Q: 多张图片会显示多个调试面板吗？**
A: 不会，只显示一个调试面板，汇总所有图片的信息。

## 🎉 开始使用

现在就访问你的服务器，体验调试面板功能吧！

```
http://你的服务器IP/test_interactive_marker_v7_debug.html
```

或者在主页面的功能八中使用，处理完成后向下滚动即可看到！

---

**需要帮助？** 查看其他文档或联系开发团队。
