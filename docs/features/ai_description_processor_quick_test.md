# AI说明书处理器 - 快速测试指南

## 快速开始

### 1. 启动服务

```bash
# 确保已安装依赖
pip install -r requirements.txt

# 配置API密钥(可选,用于AI模式)
# 编辑 .env 文件
ZHIPU_API_KEY=your-api-key-here

# 启动服务
python run_app.py
```

### 2. 访问功能八

1. 打开浏览器访问: `http://localhost:5001/`
2. 点击导航栏的"功能八:专利附图标注"
3. 查看说明书输入框上方是否有"AI处理控制面板"

---

## 测试场景

### 场景1: 规则模式测试(默认)

**目的**: 验证原有功能未受影响

**步骤**:
1. 确保"说明书AI处理"开关是**关闭**状态
2. 上传一张专利附图(或粘贴图片)
3. 输入中文说明书文本:
   ```
   71. 机壳
   711. 前壳体
   712. 后壳体
   72. 显示屏
   73. 控制电路
   ```
4. 点击"开始处理"
5. 查看处理结果

**预期结果**:
- ✅ 处理速度快(毫秒级)
- ✅ 正确识别标记(71, 711, 712, 72, 73)
- ✅ 显示匹配率和置信度
- ✅ 不显示AI处理信息

---

### 场景2: AI模式测试(中文)

**目的**: 验证AI模式处理中文说明书

**步骤**:
1. **打开**"说明书AI处理"开关
2. 选择模型: **GLM-4-Flash (推荐)**
3. 上传一张专利附图
4. 输入中文说明书文本(同上)
5. 点击"开始处理"
6. 查看处理结果

**预期结果**:
- ✅ 显示"正在使用AI处理..."
- ✅ 处理时间3-10秒
- ✅ 显示AI处理信息:
  - 检测语言: zh-cn
  - 处理时间: X.X秒
- ✅ 正确识别标记
- ✅ 不显示翻译信息(因为原文是中文)

---

### 场景3: AI模式测试(英文)

**目的**: 验证AI模式的多语言支持和翻译功能

**步骤**:
1. 确保"说明书AI处理"开关是**打开**状态
2. 选择模型: **GLM-4-Flash**
3. 上传一张专利附图
4. 输入英文说明书文本:
   ```
   The display device includes:
   10. Housing
   20. Display screen
   30. Control circuit
   The housing 10 is used to accommodate other components.
   The display screen 20 is mounted on the front surface of the housing 10.
   The control circuit 30 is located inside the housing 10.
   ```
5. 点击"开始处理"
6. 查看处理结果

**预期结果**:
- ✅ 显示"正在使用AI处理..."
- ✅ 处理时间5-15秒(包含翻译)
- ✅ 显示AI处理信息:
  - 检测语言: en
  - **已翻译为中文**
  - 处理时间: X.X秒
- ✅ 正确识别标记(10, 20, 30)
- ✅ 标记名称为中文

---

### 场景4: 模型选择测试

**目的**: 验证不同模型的选择和使用

**步骤**:
1. 打开AI模式
2. 依次测试不同模型:
   - GLM-4-Flash (推荐)
   - GLM-4-Plus
   - GLM-4-Air
3. 使用相同的说明书文本
4. 对比处理结果

**预期结果**:
- ✅ 所有模型都能正常工作
- ✅ GLM-4-Air 速度最快
- ✅ GLM-4-Plus 准确率可能更高
- ✅ 模型选择会被保存(刷新页面后仍保持)

---

### 场景5: 提示词自定义测试

**目的**: 验证提示词编辑功能

**步骤**:
1. 打开AI模式
2. 点击"编辑提示词"按钮
3. 查看默认提示词模板
4. 修改提示词(例如,强调只提取数字标记):
   ```
   你是专利分析AI。从下面的说明书中提取数字标记(如10、20)和部件名称。
   
   重点关注:
   1. 纯数字标记(10、20、30等)
   2. 忽略图号(图1、Fig. 1等)
   
   返回JSON格式:
   {"components": [{"marker": "标记", "name": "名称"}]}
   
   文本:
   {description_text}
   ```
5. 点击"保存"
6. 使用修改后的提示词处理说明书
7. 点击"重置为默认"恢复默认提示词

**预期结果**:
- ✅ 提示词编辑器正常打开
- ✅ 可以编辑和保存自定义提示词
- ✅ 自定义提示词生效(结果可能不同)
- ✅ 可以重置为默认提示词
- ✅ 自定义提示词会被保存

---

### 场景6: 错误处理测试

**目的**: 验证错误处理和用户提示

**测试6.1: 未选择模型**
1. 打开AI模式
2. **不选择**任何模型
3. 输入说明书并点击"开始处理"

**预期结果**:
- ✅ 弹出提示: "请选择AI模型。"
- ✅ 不发送API请求

**测试6.2: 空说明书**
1. 打开AI模式
2. 选择模型
3. 说明书输入框留空
4. 点击"开始处理"

**预期结果**:
- ✅ 弹出提示: "请输入说明书内容。"

**测试6.3: API密钥未配置**
1. 确保未配置`ZHIPU_API_KEY`环境变量
2. 打开AI模式并选择模型
3. 输入说明书并处理

**预期结果**:
- ✅ 显示错误信息: "API密钥未配置"
- ✅ 或降级到规则模式处理

---

### 场景7: 状态持久化测试

**目的**: 验证用户设置的保存

**步骤**:
1. 打开AI模式
2. 选择模型: GLM-4-Plus
3. 编辑并保存自定义提示词
4. **刷新页面**
5. 返回功能八

**预期结果**:
- ✅ AI模式开关状态保持打开
- ✅ 模型选择保持为 GLM-4-Plus
- ✅ 自定义提示词保持不变

---

## 性能基准

### 规则模式
- **处理时间**: < 100ms
- **适用场景**: 中文说明书
- **成本**: 免费

### AI模式
- **处理时间**: 3-15秒
  - 中文(无翻译): 3-5秒
  - 英文(含翻译): 5-10秒
  - 日文(含翻译): 5-15秒
- **适用场景**: 多语言说明书
- **成本**: 约0.001-0.01元/次

---

## 常见问题排查

### 问题1: AI处理面板不显示

**可能原因**:
- JavaScript文件未加载
- 浏览器缓存

**解决方法**:
1. 打开浏览器开发者工具(F12)
2. 查看Console是否有错误
3. 清除浏览器缓存并刷新
4. 检查文件路径是否正确

### 问题2: AI模式处理失败

**可能原因**:
- API密钥未配置或无效
- 网络连接问题
- API服务不可用

**解决方法**:
1. 检查`.env`文件中的`ZHIPU_API_KEY`
2. 测试API连接:
   ```bash
   curl -X POST https://open.bigmodel.cn/api/paas/v4/chat/completions \
     -H "Authorization: Bearer YOUR_API_KEY" \
     -H "Content-Type: application/json" \
     -d '{"model":"glm-4-flash","messages":[{"role":"user","content":"测试"}]}'
   ```
3. 查看后端日志

### 问题3: 处理速度很慢

**可能原因**:
- 说明书文本过长
- 网络延迟
- API服务负载高

**解决方法**:
1. 缩短说明书文本长度
2. 使用更快的模型(GLM-4-Air)
3. 检查网络连接
4. 稍后重试

### 问题4: 识别结果不准确

**可能原因**:
- 说明书格式不标准
- 提示词不适合当前文本
- 模型能力限制

**解决方法**:
1. 检查说明书格式
2. 自定义提示词,增加更多示例
3. 尝试更强大的模型(GLM-4-Plus)
4. 对比规则模式的结果

---

## 测试检查清单

### 基本功能
- [ ] AI处理面板正常显示
- [ ] 开关可以切换
- [ ] 模型选择器工作正常
- [ ] 提示词编辑器工作正常

### 处理功能
- [ ] 规则模式正常工作
- [ ] AI模式(中文)正常工作
- [ ] AI模式(英文)正常工作
- [ ] 翻译功能正常工作

### 结果显示
- [ ] 规则模式结果显示正确
- [ ] AI模式结果显示正确
- [ ] AI处理信息显示完整
- [ ] 错误信息显示友好

### 错误处理
- [ ] 未选择模型时有提示
- [ ] 空说明书时有提示
- [ ] API失败时有错误提示
- [ ] 网络错误时有友好提示

### 状态持久化
- [ ] 开关状态保存
- [ ] 模型选择保存
- [ ] 自定义提示词保存

---

## 下一步

测试完成后:

1. **记录问题**: 将发现的问题记录到issue tracker
2. **性能优化**: 根据测试结果优化性能
3. **用户反馈**: 收集用户反馈并改进
4. **文档更新**: 根据测试结果更新文档

---

## 相关文档

- [用户指南](./ai_description_processor_guide.md)
- [集成完成文档](./ai_description_processor_integration_complete.md)
- [配置指南](./ai_description_processor_config.md)

---

**最后更新**: 2026-02-01  
**文档版本**: 1.0.0
