# 功能七可视化增强 - 浏览器测试指南

## 测试环境
- **应用地址**: http://localhost:5001
- **测试时间**: 2026-01-21
- **测试浏览器**: Chrome/Firefox/Edge

## 自动化测试结果 ✅

所有自动化测试已通过：
- ✅ 独权序号和换行格式
- ✅ 网络图箭头标记
- ✅ 树状图散开控制
- ✅ SVG截图生成
- ✅ CSS样式定义
- ✅ JavaScript函数完整性

## 浏览器手动测试步骤

### 准备工作

1. **启动应用**
   ```bash
   python run_app.py
   ```

2. **打开浏览器**
   访问: http://localhost:5001

3. **准备测试数据**
   使用项目中的测试文件：
   - `test_data/test_patents.xlsx`
   - `test_data/test_smartphone.xlsx`

---

### 测试1: Excel原表行号显示 📊

**目标**: 验证公开号与独权合并视窗中显示Excel行号

**步骤**:
1. 登录系统（如需要）
2. 进入"功能七：权利要求处理"页面
3. 上传Excel文件（包含专利号列）
4. 选择工作表和权利要求列
5. 点击"开始处理"
6. 等待处理完成
7. 滚动到"公开号与独权合并视窗"

**预期结果**:
- ✅ 每个专利号下方显示灰色徽章
- ✅ 徽章内容格式：`Excel行号: X`
- ✅ 行号与Excel原表对应
- ✅ 徽章样式：灰色背景、圆角、清晰易读

**截图位置**: 公开号与独权合并视窗表格

---

### 测试2: 独权序号和换行显示 📝

**目标**: 验证独立权利要求带序号并换行显示

**步骤**:
1. 在"公开号与独权合并视窗"中查看"合并的独权"列
2. 找到包含多个独立权利要求的专利
3. 检查显示格式

**预期结果**:
- ✅ 每个独权前有序号（1. 2. 3. ...）
- ✅ 不同独权之间有明显换行
- ✅ 文本不挤在一起
- ✅ 滚动条可查看完整内容
- ✅ 显示区域高度适中（150px）

**示例格式**:
```
1. 一种智能手机，包括处理器、存储器和显示屏。

2. 根据权利要求1所述的智能手机，其特征在于...

3. 一种电子设备，包括主板、电源和散热系统。
```

---

### 测试3: 网络图箭头指向 ➡️

**目标**: 验证网络图中引用线条显示箭头

**步骤**:
1. 在"公开号与独权合并视窗"中点击"查看引用图"按钮
2. 或在"专利查询"区域搜索并选择专利，点击"生成权利要求关系图"
3. 在可视化样式下拉框中选择"网络图"
4. 观察节点之间的连线

**预期结果**:
- ✅ 所有连线末端都有箭头
- ✅ 箭头为三角形，灰色填充
- ✅ 箭头方向正确（从被引用指向引用者）
- ✅ 箭头大小适中，清晰可见
- ✅ 箭头随连线角度自动旋转

**测试技巧**:
- 放大查看箭头细节
- 拖动节点观察箭头是否跟随旋转
- 检查多个连线的箭头方向

---

### 测试4: 树状图散开程度调节 🌲

**目标**: 验证树状图散开程度可调节

**步骤**:
1. 生成权利要求关系图
2. 确保样式选择为"树状图"
3. 找到"散开:"滑动条控件（应该在样式选择器旁边）
4. 拖动滑动条从0.5x到2.5x
5. 观察树状图的变化

**预期结果**:
- ✅ 滑动条只在树状图模式下显示
- ✅ 切换到网络图/径向图时，滑动条自动隐藏
- ✅ 滑动条范围：0.5x - 2.5x
- ✅ 当前倍数实时显示（如"1.0x"）
- ✅ 调节时树状图立即重新渲染
- ✅ 0.5x时节点紧凑，2.5x时节点分散

**测试场景**:
- **0.5x**: 节点紧凑，适合查看整体结构
- **1.0x**: 默认状态，平衡的显示
- **2.0x**: 节点分散，适合查看细节
- **2.5x**: 最大散开，节点间距最大

---

### 测试5: 高清截图功能 📷

**目标**: 验证可以导出高清SVG截图

**步骤**:
1. 生成任意样式的权利要求关系图
2. 找到截图按钮（📷图标）
3. 点击截图按钮
4. 检查浏览器下载

**预期结果**:
- ✅ 点击后立即触发下载
- ✅ 文件格式为SVG
- ✅ 文件命名格式：`claims_visualization_时间戳.svg`
- ✅ 文件可以在浏览器中打开查看
- ✅ 图像清晰，无失真
- ✅ 所有节点、连线、标签都完整保存
- ✅ 显示成功提示消息

**验证SVG质量**:
1. 用浏览器打开下载的SVG文件
2. 放大查看，应该无限清晰（矢量图）
3. 可以用Adobe Illustrator等工具编辑
4. 文件大小合理（通常几KB到几十KB）

**测试所有样式**:
- ✅ 树状图截图
- ✅ 网络图截图
- ✅ 径向图截图

---

## 综合测试场景

### 场景1: 完整工作流测试

1. 上传包含多个专利的Excel文件
2. 处理权利要求数据
3. 查看公开号与独权合并视窗
   - 验证行号显示
   - 验证独权序号和换行
4. 点击"查看引用图"
5. 测试三种可视化样式
   - 树状图：调节散开程度
   - 网络图：检查箭头
   - 径向图：整体布局
6. 对每种样式进行截图
7. 验证所有截图文件

### 场景2: 边界情况测试

**单个独权**:
- 只有一个独立权利要求
- 应该显示"1. ..."
- 不应该有多余的换行

**无独权**:
- 没有独立权利要求
- 应该显示"无独立权利要求"

**大量权利要求**:
- 10+个权利要求
- 树状图散开程度调节应该有明显效果
- 截图应该包含所有节点

**复杂引用关系**:
- 多层级引用
- 网络图箭头方向应该清晰
- 树状图层次应该分明

---

## 性能测试

### 响应速度
- ✅ 散开程度调节：< 500ms
- ✅ 样式切换：< 1s
- ✅ 截图生成：< 2s
- ✅ 页面滚动：流畅无卡顿

### 大数据量
- 测试100+权利要求
- 验证渲染性能
- 检查浏览器内存使用

---

## 兼容性测试

### 浏览器兼容性

**Chrome** (推荐):
- [ ] 所有功能正常
- [ ] 截图功能正常
- [ ] 滑动条交互流畅

**Firefox**:
- [ ] 所有功能正常
- [ ] SVG渲染正确
- [ ] 箭头显示正常

**Edge**:
- [ ] 所有功能正常
- [ ] 下载功能正常
- [ ] 样式显示正确

**Safari** (Mac):
- [ ] 基本功能正常
- [ ] 可能需要特殊处理

---

## 问题排查

### 常见问题

**问题1: 行号不显示**
- 检查Excel文件是否包含行号数据
- 查看浏览器控制台是否有错误
- 验证后端返回的数据结构

**问题2: 独权没有序号**
- 检查JavaScript是否正确加载
- 查看浏览器控制台错误
- 验证数据格式

**问题3: 网络图没有箭头**
- 检查D3.js是否正确加载
- 查看SVG中是否有marker定义
- 验证CSS是否覆盖了样式

**问题4: 散开控制不工作**
- 确认在树状图模式下
- 检查事件监听器是否绑定
- 查看控制台错误信息

**问题5: 截图失败**
- 检查浏览器下载权限
- 验证SVG序列化是否成功
- 查看控制台错误

---

## 测试报告模板

```markdown
## 功能七可视化增强测试报告

**测试日期**: YYYY-MM-DD
**测试人员**: [姓名]
**浏览器**: [Chrome/Firefox/Edge] [版本号]

### 测试结果

| 功能 | 状态 | 备注 |
|------|------|------|
| Excel行号显示 | ✅/❌ | |
| 独权序号和换行 | ✅/❌ | |
| 网络图箭头 | ✅/❌ | |
| 树状图散开控制 | ✅/❌ | |
| 高清截图 | ✅/❌ | |

### 发现的问题

1. [问题描述]
   - 重现步骤：
   - 预期结果：
   - 实际结果：
   - 截图：

### 建议

1. [改进建议]

### 总体评价

[优秀/良好/需改进]
```

---

## 快速验证清单

在部署到生产环境前，快速验证以下项目：

- [ ] 应用可以正常启动
- [ ] 可以上传Excel文件
- [ ] 权利要求处理正常
- [ ] 行号正确显示
- [ ] 独权格式正确（序号+换行）
- [ ] 网络图有箭头
- [ ] 树状图散开控制可用
- [ ] 截图功能正常
- [ ] 所有浏览器兼容
- [ ] 无JavaScript错误
- [ ] 无CSS样式问题
- [ ] 性能表现良好

---

## 联系方式

如果测试中发现问题，请记录：
1. 问题描述
2. 重现步骤
3. 浏览器信息
4. 截图或录屏
5. 控制台错误信息

---

## 附录：测试数据

### 推荐测试文件
- `test_data/test_patents.xlsx` - 基础测试
- `test_data/test_smartphone.xlsx` - 复杂场景

### 测试专利号示例
- US202402107869A1
- CN202410123456A
- EP202400123456A1

---

**祝测试顺利！** 🎉
