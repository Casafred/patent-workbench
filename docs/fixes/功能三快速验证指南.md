# 功能三预置模板修复 - 快速验证指南

## 立即验证修复（3步骤）

### 步骤1：打开应用（10秒钟）
1. 打开浏览器，进入应用地址
2. 使用开发者工具（按F12）打开控制台
3. 切换到 **"功能三：大批量处理"** 标签

### 步骤2：查看模板选择器（5秒钟）
在"步骤2：配置API请求模板"部分，找到"选择预置模板或新建"下拉菜单

**验证清单：**
- [ ] 下拉菜单显示5个预设模板选项
- [ ] 每个模板标注有 `[预设]` 标识
- [ ] 下拉菜单看起来清晰易读

**预期看到的选项：**
```
选择预置模板或新建
├─ 专利文本翻译 [预设]
├─ 技术方案解读 [预设]
├─ 技术文本翻译 [预设]
├─ 检索词拓展 [预设]
└─ 技术文本总结 [预设]
```

### 步骤3：测试模板加载（30秒钟）
1. 在下拉菜单中选择 **"技术方案解读 [预设]"**
2. 观察页面变化：

**验证清单：**
- [ ] 系统提示框自动填充内容
- [ ] 用户提示规则框自动填充内容
- [ ] 输出字段区域显示4个字段配置框
- [ ] 所有内容显示正确

**预期看到的字段：**
```
□ 技术方案
□ 技术问题
□ 技术效果
□ 技术关键词
```

## 控制台日志验证（可选但推荐）

在浏览器开发者工具的 **Console** 标签，应该看到：

```
✅ 正在添加预设模板：Array(5) [ "专利文本翻译", "技术方案解读", "技术文本翻译", "检索词拓展", "技术文本总结" ]
✅ 正在添加自定义模板：Array(0) []
```

**如果看到警告信息：**
```
⚠️ appState.generator.presetTemplates 为空，使用备用模板
```

这是正常的，说明自动恢复机制在工作。

## 完整功能测试（2-3分钟）

### 测试1：选择不同模板
```
操作步骤：
1. 选择 "专利文本翻译" [预设]
   ✓ 验证系统提示和用户规则内容改变

2. 选择 "检索词拓展" [预设]
   ✓ 验证内容再次改变

3. 选择空选项 "选择预置模板或新建"
   ✓ 验证显示默认提示词
```

### 测试2：生成API请求
```
操作步骤：
1. 在步骤1上传一个包含专利数据的Excel文件
2. 配置列选择（选择3-5列）
3. 在步骤2选择一个模板
4. 点击"生成请求文件"按钮
5. 查看生成的JSONL预览
```

**验证清单：**
- [ ] 预览显示3条示例请求
- [ ] 每条请求包含custom_id、method、url、body
- [ ] 请求格式是有效的JSON
- [ ] 系统提示和用户提示内容正确

### 测试3：模板管理
```
操作步骤：
1. 修改系统提示或用户规则内容
2. 点击"保存模板"按钮
3. 输入新模板名称（如"自定义模板1"）
4. 打开模板下拉菜单
```

**验证清单：**
- [ ] 新模板出现在下拉菜单中
- [ ] 可以选择并加载自定义模板
- [ ] 可以导出模板为JSON文件
- [ ] 可以导入已有的模板文件

## 一键测试页面

为了快速验证所有功能，我们提供了自动化测试页面：

### 使用方法
1. 打开 `test_feature3_templates.html` 文件
2. 页面会自动运行4个测试
3. 查看所有测试是否显示绿色 ✅

### 4个自动化测试

**测试1：检查预设模板数据**
- 验证appState中是否有5个预设模板
- 显示模板名称列表

**测试2：模板选择器初始化**
- 验证下拉菜单是否正确初始化
- 显示选项数量

**测试3：加载模板到UI**
- 加载第一个预设模板
- 验证系统提示和输出字段是否正确填充

**测试4：API请求格式验证**
- 验证生成的API请求是否符合规范
- 显示请求格式示例

## 常见验证问题及解决方案

### 问题1：下拉菜单仍然空白

**诊断步骤：**
1. 打开浏览器控制台
2. 执行命令查看模板数据：
```javascript
console.log("预设模板数量:", appState.generator.presetTemplates.length);
console.log("预设模板列表:", appState.generator.presetTemplates.map(t => t.name));
```

**可能的原因和解决方案：**

| 原因 | 解决方案 |
|------|--------|
| 页面未完全加载 | 等待几秒钟后刷新页面 |
| JavaScript加载失败 | 清除浏览器缓存并重启浏览器 |
| appState初始化失败 | 检查浏览器控制台是否有错误信息 |
| 模板选择器元素不存在 | 检查HTML中是否有ID为 `template_selector` 的元素 |

### 问题2：选择模板后内容不加载

**诊断步骤：**
1. 打开浏览器控制台
2. 手动触发模板加载：
```javascript
loadTemplate("技术方案解读");
```

**可能的原因和解决方案：**

| 原因 | 解决方案 |
|------|--------|
| change事件未绑定 | 刷新页面 |
| 模板名称不匹配 | 查看下拉菜单中的实际模板名称 |
| loadTemplateUI函数出错 | 检查控制台错误信息 |
| DOM元素不存在 | 检查页面HTML结构 |

### 问题3：生成的API请求格式不对

**诊断步骤：**
1. 在步骤2生成请求后，点击查看预览
2. 复制预览内容到JSON验证工具（如JSONLint）
3. 检查格式是否有效

**可能的原因和解决方案：**

| 原因 | 解决方案 |
|------|--------|
| 用户提示词为空 | 在规则框中输入内容或选择模板 |
| 特殊字符未转义 | 检查内容中是否有引号或换行符 |
| 输出字段配置不完整 | 确保添加输出字段时同时填写名称和描述 |

## 验证成功的标志

✅ **所有验证项都成功时，你会看到：**

1. **下拉菜单**
   - 显示5个预设模板选项，每个标有[预设]标记

2. **模板选择**
   - 点击下拉菜单能正常打开
   - 能够选择任意模板

3. **内容加载**
   - 选择模板后，系统提示和用户规则自动填充
   - 如果模板有输出字段，相应字段配置框出现

4. **API请求生成**
   - 能够生成JSONL格式的请求文件
   - 预览显示格式正确的JSON对象

5. **控制台日志**
   - 看到 ✅ 开头的成功日志
   - 没有 ❌ 开头的错误日志

## 性能验证

| 指标 | 预期值 |
|------|--------|
| 模板加载时间 | < 100ms |
| 下拉菜单响应 | 立即显示 |
| 模板选择加载 | < 50ms |
| JSONL生成时间 | 取决于数据行数 |

## 下一步操作

### 如果所有验证都成功 ✅
1. 可以开始正常使用功能三
2. 尝试上传Excel文件进行完整测试
3. 测试导入导出模板功能
4. 生成并上传JSONL文件到Batch API

### 如果某些验证失败 ❌
1. 查看"常见验证问题"部分
2. 检查浏览器控制台的错误信息
3. 尝试清除缓存重新加载
4. 如果问题仍未解决，请查阅详细修复说明文档

## 相关文档

- **详细修复说明**：docs/fixes/功能三预置模板修复说明.md
- **修复前后对比**：docs/fixes/功能三模板修复-修复前后对比.md
- **自动化测试页面**：test_feature3_templates.html

## 常用命令速查

```javascript
// 在浏览器控制台中使用这些命令快速调试

// 1. 查看预设模板
appState.generator.presetTemplates.forEach(t => console.log(t.name))

// 2. 查看自定义模板
appState.generator.customTemplates.forEach(t => console.log(t.name))

// 3. 手动加载模板
loadTemplate("技术方案解读")

// 4. 手动更新模板选择器
updateTemplateSelector()

// 5. 查看模板选择器选项数量
console.log("选项数量:", document.getElementById('template_selector').options.length)

// 6. 清除所有自定义模板（谨慎使用）
localStorage.removeItem('custom_templates')

// 7. 生成JSONL预览
generateJsonl()
```

## 验证清单

| 项目 | 状态 |
|------|------|
| [ ] 下拉菜单显示5个预设模板 | __ |
| [ ] 模板选项有[预设]标识 | __ |
| [ ] 选择模板自动加载内容 | __ |
| [ ] 系统提示正确填充 | __ |
| [ ] 用户规则正确填充 | __ |
| [ ] 输出字段正确显示 | __ |
| [ ] 生成的API请求格式正确 | __ |
| [ ] 浏览器控制台有成功日志 | __ |
| [ ] 保存自定义模板成功 | __ |
| [ ] 导入导出模板成功 | __ |

**完成度**：____ / 10 项

## 获取帮助

如果验证过程中遇到问题：

1. 查看浏览器控制台（F12）的错误信息
2. 运行上面提供的诊断命令
3. 查阅详细修复文档
4. 联系技术支持团队

---

**修复版本**：v20.2
**修复日期**：2026-02-02
**验证耗时**：约5-10分钟
