# åŠŸèƒ½å…« v8.0 - æ™ºèƒ½é¿è®©ç®—æ³•å®Œæˆ âœ…

## ğŸ“‹ ä¼˜åŒ–æ¦‚è¿°

é’ˆå¯¹ç”¨æˆ·åé¦ˆ"æ ‡æ³¨æ¡†æŒ¨å¾—è¿‘ä¼šç›¸äº’é®æŒ¡"çš„é—®é¢˜ï¼Œå®ç°äº†å…¨æ–°çš„æ™ºèƒ½é¿è®©ç®—æ³•ï¼Œç¡®ä¿æ‰€æœ‰æ ‡æ³¨æ¡†éƒ½å®Œæ•´å¯è§ä¸”ä¸ç›¸äº’é®æŒ¡ã€‚

---

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›

### 1. **æ™ºèƒ½é¿è®©ç®—æ³•** ğŸ§ 

æ–°å¢ `applySmartLayoutAvoidance()` å‡½æ•°ï¼Œå®ç°å¤šå±‚æ¬¡çš„é¿è®©ç­–ç•¥ï¼š

```javascript
ç­–ç•¥å±‚æ¬¡ï¼š
1. åŒä¸€åŒºåŸŸå†…å·¦å³/ä¸Šä¸‹é”™å¼€
2. ç©ºé—´ä¸å¤Ÿæ—¶å‘å‚ç›´æ–¹å‘æ‰©å±•
3. å¤šè½®è¿­ä»£æ£€æµ‹å’Œè°ƒæ•´
4. ç¡®ä¿æ‰€æœ‰æ ‡æ³¨æ¡†åœ¨ç”»å¸ƒèŒƒå›´å†…
```

### 2. **æ°´å¹³åŒºåŸŸé¿è®©** â†”ï¸

`resolveHorizontalOverlaps()` - å¤„ç†ä¸Š/ä¸‹è¾¹ç¼˜çš„æ ‡æ³¨æ¡†ï¼š

```javascript
ç¬¬ä¸€éï¼š
- æŒ‰Xåæ ‡æ’åº
- æ£€æµ‹Xæ–¹å‘é‡å 
- å°è¯•å‘å³ç§»åŠ¨
- ç©ºé—´ä¸å¤Ÿåˆ™æ¢è¡Œï¼ˆå‘ä¸Š/ä¸‹ï¼‰

ç¬¬äºŒéï¼š
- å¤šè½®è¿­ä»£æ£€æµ‹æ®‹ç•™é‡å 
- ç»§ç»­å‘ä¸Š/ä¸‹è°ƒæ•´
- æœ€å¤š10è½®è¿­ä»£
```

### 3. **å‚ç›´åŒºåŸŸé¿è®©** â†•ï¸

`resolveVerticalOverlaps()` - å¤„ç†å·¦/å³è¾¹ç¼˜çš„æ ‡æ³¨æ¡†ï¼š

```javascript
ç¬¬ä¸€éï¼š
- æŒ‰Yåæ ‡æ’åº
- æ£€æµ‹Yæ–¹å‘é‡å 
- å°è¯•å‘ä¸‹ç§»åŠ¨
- ç©ºé—´ä¸å¤Ÿåˆ™æ¢åˆ—ï¼ˆå‘å·¦/å³ï¼‰

ç¬¬äºŒéï¼š
- å¤šè½®è¿­ä»£æ£€æµ‹æ®‹ç•™é‡å 
- ç»§ç»­å‘å·¦/å³è°ƒæ•´
- æœ€å¤š10è½®è¿­ä»£
```

### 4. **é‡å æ£€æµ‹å‡½æ•°** ğŸ”

ä¸‰ä¸ªç²¾ç¡®çš„é‡å æ£€æµ‹å‡½æ•°ï¼š

```javascript
checkHorizontalOverlap()  // Xæ–¹å‘é‡å æ£€æµ‹
checkVerticalOverlap()    // Yæ–¹å‘é‡å æ£€æµ‹
checkLabelOverlap()       // å®Œå…¨é‡å æ£€æµ‹ï¼ˆX+Yï¼‰
```

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### ç®—æ³•æµç¨‹

```
1. åˆå§‹åŒ–æ ‡æ³¨ä½ç½®
   â†“
2. æŒ‰åŒºåŸŸåˆ†ç»„ï¼ˆä¸Š/å³/ä¸‹/å·¦ï¼‰
   â†“
3. åŒºåŸŸå†…æ’åºï¼ˆæŒ‰æ ‡æ³¨ç‚¹ä½ç½®ï¼‰
   â†“
4. ç¬¬ä¸€éå¸ƒå±€ï¼š
   - æ£€æµ‹ç›¸é‚»æ ‡æ³¨æ¡†é‡å 
   - å°è¯•åŒæ–¹å‘é”™å¼€
   - ç©ºé—´ä¸å¤Ÿåˆ™æ¢è¡Œ/åˆ—
   â†“
5. ç¬¬äºŒéä¼˜åŒ–ï¼š
   - å¤šè½®è¿­ä»£æ£€æµ‹
   - è°ƒæ•´æ®‹ç•™é‡å 
   - æœ€å¤š10è½®
   â†“
6. è¾¹ç•Œæ£€æŸ¥å’Œé™åˆ¶
   â†“
7. å®Œæˆå¸ƒå±€
```

### æ°´å¹³åŒºåŸŸç¤ºä¾‹

```
åŸå§‹å¸ƒå±€ï¼ˆæœ‰é‡å ï¼‰ï¼š
[1] [2] [3]
 â†“   â†“   â†“
é‡å ï¼

ä¼˜åŒ–åï¼ˆé”™å¼€ï¼‰ï¼š
[1]     [3]
    [2]
 â†“   â†“   â†“
å®Œç¾ï¼
```

### å‚ç›´åŒºåŸŸç¤ºä¾‹

```
åŸå§‹å¸ƒå±€ï¼ˆæœ‰é‡å ï¼‰ï¼š
[1] â† é‡å ï¼
[2]
[3]

ä¼˜åŒ–åï¼ˆé”™å¼€ï¼‰ï¼š
[1]     [2]
    [3]
å®Œç¾ï¼
```

---

## ğŸ“Š å…³é”®å‚æ•°

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|-----|------|
| **minSpacing** | 10px | æ ‡æ³¨æ¡†ä¹‹é—´çš„æœ€å°é—´è· |
| **labelHeight** | fontSize * 1.5 | æ ‡æ³¨æ¡†é«˜åº¦ |
| **margin** | 50px | è·ç¦»ç”»å¸ƒè¾¹ç¼˜çš„è·ç¦» |
| **maxIterations** | 10 | æœ€å¤§è¿­ä»£æ¬¡æ•° |

---

## ğŸ¨ é¿è®©ç­–ç•¥

### ç­–ç•¥1ï¼šåŒæ–¹å‘é”™å¼€

```javascript
// æ°´å¹³åŒºåŸŸï¼šå‘å³ç§»åŠ¨
if (xOverlap) {
    newX = prevLabel.labelX + prevLabel.textWidth + minSpacing;
}

// å‚ç›´åŒºåŸŸï¼šå‘ä¸‹ç§»åŠ¨
if (yOverlap) {
    newY = prevLabel.labelY + prevLabel.textHeight + minSpacing;
}
```

### ç­–ç•¥2ï¼šæ¢è¡Œ/åˆ—

```javascript
// æ°´å¹³åŒºåŸŸï¼šç©ºé—´ä¸å¤Ÿæ¢è¡Œ
if (newX + textWidth > canvasWidth) {
    labelY += rowOffset; // å‘ä¸‹ä¸€è¡Œ
    labelX = markerX;    // é‡ç½®Xä½ç½®
}

// å‚ç›´åŒºåŸŸï¼šç©ºé—´ä¸å¤Ÿæ¢åˆ—
if (newY + textHeight > canvasHeight) {
    labelX += colOffset; // å‘å³ä¸€åˆ—
    labelY = markerY;    // é‡ç½®Yä½ç½®
}
```

### ç­–ç•¥3ï¼šå¤šè½®è¿­ä»£

```javascript
let hasOverlap = true;
let iterations = 0;

while (hasOverlap && iterations < 10) {
    hasOverlap = false;
    
    // æ£€æµ‹æ‰€æœ‰æ ‡æ³¨æ¡†å¯¹
    for (let i = 0; i < labels.length; i++) {
        for (let j = i + 1; j < labels.length; j++) {
            if (checkOverlap(labels[i], labels[j])) {
                hasOverlap = true;
                adjustPosition(labels[j]); // è°ƒæ•´ä½ç½®
            }
        }
    }
    
    iterations++;
}
```

---

## ğŸ“ é‡å æ£€æµ‹ç®—æ³•

### Xæ–¹å‘é‡å 

```javascript
checkHorizontalOverlap(label1, label2, minSpacing) {
    const left1 = label1.labelX - label1.textWidth / 2;
    const right1 = label1.labelX + label1.textWidth / 2;
    const left2 = label2.labelX - label2.textWidth / 2;
    const right2 = label2.labelX + label2.textWidth / 2;
    
    // æ£€æŸ¥æ˜¯å¦æœ‰é—´éš™
    return !(right1 + minSpacing < left2 || 
             right2 + minSpacing < left1);
}
```

### Yæ–¹å‘é‡å 

```javascript
checkVerticalOverlap(label1, label2, minSpacing) {
    const top1 = label1.labelY - label1.textHeight / 2;
    const bottom1 = label1.labelY + label1.textHeight / 2;
    const top2 = label2.labelY - label2.textHeight / 2;
    const bottom2 = label2.labelY + label2.textHeight / 2;
    
    // æ£€æŸ¥æ˜¯å¦æœ‰é—´éš™
    return !(bottom1 + minSpacing < top2 || 
             bottom2 + minSpacing < top1);
}
```

### å®Œå…¨é‡å 

```javascript
checkLabelOverlap(label1, label2, minSpacing) {
    // Xå’ŒYæ–¹å‘éƒ½é‡å æ‰ç®—å®Œå…¨é‡å 
    return checkHorizontalOverlap(label1, label2, minSpacing) && 
           checkVerticalOverlap(label1, label2, minSpacing);
}
```

---

## ğŸ”„ è¾¹ç•Œå¤„ç†

### Xæ–¹å‘è¾¹ç•Œ

```javascript
// ç¡®ä¿æ ‡æ³¨æ¡†ä¸è¶…å‡ºå·¦å³è¾¹ç•Œ
labelX = Math.max(
    margin,  // å·¦è¾¹ç•Œ
    Math.min(
        canvasWidth - textWidth - margin,  // å³è¾¹ç•Œ
        labelX
    )
);
```

### Yæ–¹å‘è¾¹ç•Œ

```javascript
// ç¡®ä¿æ ‡æ³¨æ¡†ä¸è¶…å‡ºä¸Šä¸‹è¾¹ç•Œ
labelY = Math.max(
    textHeight / 2 + 10,  // ä¸Šè¾¹ç•Œ
    Math.min(
        canvasHeight - textHeight / 2 - 10,  // ä¸‹è¾¹ç•Œ
        labelY
    )
);
```

---

## ğŸ“Š æ•ˆæœå¯¹æ¯”

### ä¼˜åŒ–å‰

```
é—®é¢˜ï¼š
âŒ æ ‡æ³¨æ¡†ç›¸äº’é®æŒ¡
âŒ æ–‡å­—é‡å ä¸å¯è¯»
âŒ éƒ¨åˆ†æ ‡æ³¨çœ‹ä¸æ¸…
âŒ ç”¨æˆ·ä½“éªŒå·®
```

### ä¼˜åŒ–å

```
æ”¹è¿›ï¼š
âœ… æ ‡æ³¨æ¡†æ™ºèƒ½é”™å¼€
âœ… æ‰€æœ‰æ–‡å­—å®Œæ•´å¯è§
âœ… è‡ªåŠ¨æ¢è¡Œ/åˆ—
âœ… ç”¨æˆ·ä½“éªŒä¼˜ç§€
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæ ‡æ³¨å¯†é›†åŒºåŸŸ

```
åŸå§‹ï¼š[1][2][3] â† å…¨éƒ¨é‡å 
ä¼˜åŒ–ï¼š[1]  [3]
        [2]    â† è‡ªåŠ¨é”™å¼€
```

### åœºæ™¯2ï¼šè¾¹ç¼˜ç©ºé—´ä¸è¶³

```
åŸå§‹ï¼š[1][2][3][4][5] â† è¶…å‡ºè¾¹ç•Œ
ä¼˜åŒ–ï¼š[1]  [3]  [5]
        [2]  [4]    â† è‡ªåŠ¨æ¢è¡Œ
```

### åœºæ™¯3ï¼šå‚ç›´æ’åˆ—

```
åŸå§‹ï¼š[1] â† å…¨éƒ¨é‡å 
      [2]
      [3]

ä¼˜åŒ–ï¼š[1]    [2]
         [3]    â† è‡ªåŠ¨æ¢åˆ—
```

---

## ğŸ“ ä¿®æ”¹æ–‡ä»¶

### `frontend/js/multiImageViewer_v8.js`

```javascript
âœ… ä¼˜åŒ– initializeAnnotations() - è°ƒç”¨æ™ºèƒ½é¿è®©ç®—æ³•
âœ… æ–°å¢ applySmartLayoutAvoidance() - ä¸»é¿è®©å‡½æ•°
âœ… æ–°å¢ resolveHorizontalOverlaps() - æ°´å¹³åŒºåŸŸé¿è®©
âœ… æ–°å¢ resolveVerticalOverlaps() - å‚ç›´åŒºåŸŸé¿è®©
âœ… æ–°å¢ checkHorizontalOverlap() - Xæ–¹å‘é‡å æ£€æµ‹
âœ… æ–°å¢ checkVerticalOverlap() - Yæ–¹å‘é‡å æ£€æµ‹
âœ… æ–°å¢ checkLabelOverlap() - å®Œå…¨é‡å æ£€æµ‹
```

---

## ğŸš€ éƒ¨ç½²è¯´æ˜

### æœ¬åœ°æµ‹è¯•

```bash
# ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
test_multi_image_viewer_v8.html
```

### æ¨é€åˆ°GitHub

```bash
git add frontend/js/multiImageViewer_v8.js
git commit -m "ä¼˜åŒ–æ ‡æ³¨æ¡†æ™ºèƒ½é¿è®©ç®—æ³•ï¼šè‡ªåŠ¨é”™å¼€é¿å…é®æŒ¡"
git push origin main
```

### é˜¿é‡Œäº‘éƒ¨ç½²

```bash
ssh root@your-server-ip
cd /root/patent_system
git pull origin main
systemctl restart patent_system
```

---

## ğŸ” éªŒè¯æ–¹æ³•

### 1. ä¸Šä¼ å¯†é›†æ ‡æ³¨çš„ä¸“åˆ©é™„å›¾

æµ‹è¯•æ ‡æ³¨æ¡†æ˜¯å¦è‡ªåŠ¨é”™å¼€

### 2. æŸ¥çœ‹è¾¹ç¼˜åŒºåŸŸ

ç¡®è®¤æ ‡æ³¨æ¡†ä¸è¶…å‡ºç”»å¸ƒè¾¹ç•Œ

### 3. æ£€æŸ¥é‡å æƒ…å†µ

éªŒè¯æ‰€æœ‰æ ‡æ³¨æ¡†éƒ½å®Œæ•´å¯è§

### 4. æµ‹è¯•ä¸åŒæ•°é‡

- å°‘é‡æ ‡æ³¨ï¼ˆ5ä¸ªä»¥ä¸‹ï¼‰
- ä¸­ç­‰æ ‡æ³¨ï¼ˆ5-15ä¸ªï¼‰
- å¤§é‡æ ‡æ³¨ï¼ˆ15ä¸ªä»¥ä¸Šï¼‰

---

## ğŸ“ˆ æ€§èƒ½å½±å“

| æŒ‡æ ‡ | å½±å“ | è¯´æ˜ |
|------|------|------|
| **åˆå§‹åŒ–æ—¶é—´** | +10-50ms | å–å†³äºæ ‡æ³¨æ•°é‡ |
| **å†…å­˜å ç”¨** | +1-2MB | ä¸´æ—¶è®¡ç®—æ•°æ® |
| **æ¸²æŸ“æ€§èƒ½** | æ— å½±å“ | ä»…åˆå§‹åŒ–æ—¶è®¡ç®— |

**ç»“è®º**ï¼šæ€§èƒ½å½±å“æå°ï¼Œç”¨æˆ·ä½“éªŒæ˜¾è‘—æ”¹å–„ âœ…

---

## ğŸ¨ ç®—æ³•ä¼˜åŠ¿

### 1. æ™ºèƒ½åŒ–

- è‡ªåŠ¨æ£€æµ‹é‡å 
- è‡ªåŠ¨é€‰æ‹©æœ€ä½³ä½ç½®
- è‡ªåŠ¨æ¢è¡Œ/åˆ—

### 2. é²æ£’æ€§

- å¤šè½®è¿­ä»£ç¡®ä¿æ— é—æ¼
- è¾¹ç•Œæ£€æŸ¥é˜²æ­¢è¶…å‡º
- æœ€å¤§è¿­ä»£æ¬¡æ•°é˜²æ­¢æ­»å¾ªç¯

### 3. çµæ´»æ€§

- æ”¯æŒä»»æ„æ•°é‡æ ‡æ³¨
- é€‚åº”ä¸åŒç”»å¸ƒå°ºå¯¸
- å¯è°ƒæ•´å‚æ•°

### 4. é«˜æ•ˆæ€§

- æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²)
- ç©ºé—´å¤æ‚åº¦ï¼šO(n)
- æœ€å¤š10è½®è¿­ä»£

---

## ğŸ”® æœªæ¥ä¼˜åŒ–

### çŸ­æœŸï¼ˆå¯é€‰ï¼‰

1. **åŠ¨æ€é—´è·**ï¼šæ ¹æ®æ ‡æ³¨æ•°é‡è‡ªåŠ¨è°ƒæ•´é—´è·
2. **ä¼˜å…ˆçº§æ’åº**ï¼šé‡è¦æ ‡æ³¨ä¼˜å…ˆå æ®æœ€ä½³ä½ç½®
3. **ç”¨æˆ·åå¥½**ï¼šè®°ä½ç”¨æˆ·æ‰‹åŠ¨è°ƒæ•´çš„ä½ç½®

### é•¿æœŸï¼ˆå¯é€‰ï¼‰

1. **æœºå™¨å­¦ä¹ **ï¼šå­¦ä¹ æœ€ä½³å¸ƒå±€æ¨¡å¼
2. **ç‰©ç†å¼•æ“**ï¼šä½¿ç”¨åŠ›å¯¼å‘ç®—æ³•
3. **3Då¸ƒå±€**ï¼šæ”¯æŒå¤šå±‚æ ‡æ³¨

---

## âœ… å®Œæˆæ£€æŸ¥æ¸…å•

- [x] æ™ºèƒ½é¿è®©ç®—æ³•å®ç°
- [x] æ°´å¹³åŒºåŸŸé¿è®©
- [x] å‚ç›´åŒºåŸŸé¿è®©
- [x] é‡å æ£€æµ‹å‡½æ•°
- [x] è¾¹ç•Œæ£€æŸ¥
- [x] å¤šè½®è¿­ä»£ä¼˜åŒ–
- [x] ä»£ç æ³¨é‡Šå®Œæ•´
- [x] æ–‡æ¡£ç¼–å†™å®Œæˆ
- [ ] ä»£ç æ¨é€GitHub
- [ ] å®é™…æ•ˆæœéªŒè¯

---

## ğŸ‰ æ€»ç»“

### æ ¸å¿ƒæ”¹è¿›

1. âœ… **æ™ºèƒ½é¿è®©**ï¼šè‡ªåŠ¨æ£€æµ‹å’Œè°ƒæ•´é‡å 
2. âœ… **å¤šå±‚ç­–ç•¥**ï¼šåŒæ–¹å‘é”™å¼€ â†’ æ¢è¡Œ/åˆ— â†’ å¤šè½®è¿­ä»£
3. âœ… **å®Œæ•´å¯è§**ï¼šç¡®ä¿æ‰€æœ‰æ ‡æ³¨æ¡†éƒ½èƒ½çœ‹æ¸…
4. âœ… **è¾¹ç•Œå®‰å…¨**ï¼šä¸ä¼šè¶…å‡ºç”»å¸ƒèŒƒå›´

### ç”¨æˆ·ä½“éªŒ

- ğŸ¯ æ ‡æ³¨æ¡†ä¸å†é®æŒ¡
- ğŸ¯ æ‰€æœ‰æ–‡å­—å®Œæ•´å¯è¯»
- ğŸ¯ å¸ƒå±€ç¾è§‚æ•´æ´
- ğŸ¯ è‡ªåŠ¨ä¼˜åŒ–æ— éœ€æ‰‹åŠ¨è°ƒæ•´

### æŠ€æœ¯ä»·å€¼

- ğŸ’¡ ç®—æ³•é€šç”¨å¯å¤ç”¨
- ğŸ’¡ æ€§èƒ½å½±å“æå°
- ğŸ’¡ ä»£ç æ¸…æ™°æ˜“ç»´æŠ¤
- ğŸ’¡ æ‰©å±•æ€§å¼º

---

**ä¼˜åŒ–å®Œæˆæ—¶é—´**ï¼š2026-02-01  
**ç‰ˆæœ¬**ï¼šv8.0 - æ™ºèƒ½é¿è®©å¢å¼ºç‰ˆ  
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆï¼Œå¾…æ¨é€æµ‹è¯•

**ç«‹å³éƒ¨ç½²ï¼Œäº«å—å®Œç¾çš„æ ‡æ³¨å¸ƒå±€ï¼** ğŸš€
