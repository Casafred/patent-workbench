# é¡¹ç›®ç»“æ„æ¢³ç†ä¸é‡æ„è®¡åˆ’

## ğŸ“‹ å½“å‰é¡¹ç›®æ¦‚è§ˆ

### é¡¹ç›®ç±»å‹
ä¸“åˆ©åˆ†ææ™ºèƒ½å·¥ä½œå° (ALFRED X IP) - Flask Webåº”ç”¨

### æŠ€æœ¯æ ˆ
- **åç«¯**: Python Flask + PostgreSQL
- **å‰ç«¯**: åŸç”ŸJavaScript + HTML/CSS
- **AIæœåŠ¡**: æ™ºè°±AI (ZhipuAI)
- **éƒ¨ç½²**: Vercel/Render

---

## ğŸ—‚ï¸ å½“å‰æ–‡ä»¶ç»“æ„åˆ†æ

### 1. æ ¹ç›®å½•æ–‡ä»¶ (éœ€è¦æ•´ç†)
```
â”œâ”€â”€ app.py (1456è¡Œ - è¿‡å¤§ï¼Œéœ€è¦æ‹†åˆ†)
â”œâ”€â”€ demo.py, demo_export.py, demo_recovery.py (æ¼”ç¤ºæ–‡ä»¶ï¼Œå¯ç§»é™¤)
â”œâ”€â”€ create_test_user.py, generate_user.py (å·¥å…·è„šæœ¬ï¼Œåº”ç§»åˆ°tools/)
â”œâ”€â”€ debug_export.py (è°ƒè¯•æ–‡ä»¶ï¼Œå¯ç§»é™¤)
â”œâ”€â”€ test_*.py (æµ‹è¯•æ–‡ä»¶ï¼Œåº”ç§»åˆ°tests/)
â”œâ”€â”€ users.json (é…ç½®æ–‡ä»¶ï¼Œåº”ç§»åˆ°config/)
â”œâ”€â”€ *.md (æ–‡æ¡£æ–‡ä»¶ï¼Œåº”ç§»åˆ°docs/)
â”œâ”€â”€ *.html (é™æ€é¡µé¢ï¼Œåº”ç§»åˆ°templates/)
â”œâ”€â”€ *.xlsx (æµ‹è¯•æ•°æ®ï¼Œåº”ç§»åˆ°test_data/)
```

### 2. æ ¸å¿ƒæ¨¡å—
```
patent_claims_processor/
â”œâ”€â”€ models.py (æ•°æ®æ¨¡å‹)
â”œâ”€â”€ processors/ (å¤„ç†å™¨æ¨¡å—)
â”‚   â”œâ”€â”€ claims_classifier.py
â”‚   â”œâ”€â”€ claims_parser.py
â”‚   â”œâ”€â”€ excel_processor.py
â”‚   â””â”€â”€ language_detector.py
â”œâ”€â”€ services/ (æœåŠ¡å±‚)
â”‚   â”œâ”€â”€ export_service.py
â”‚   â””â”€â”€ processing_service.py
â””â”€â”€ __init__.py
```
**çŠ¶æ€**: âœ… ç»“æ„è‰¯å¥½ï¼Œæ— éœ€å¤§æ”¹

### 3. å‰ç«¯èµ„æº
```
css/
â”œâ”€â”€ main.css (1200+è¡Œ - è¿‡å¤§ï¼Œéœ€è¦æ‹†åˆ†)
â””â”€â”€ refactor.css

js/
â”œâ”€â”€ main.js (600+è¡Œ - éœ€è¦æ¨¡å—åŒ–)
â”œâ”€â”€ chat.js
â”œâ”€â”€ claimsProcessor.js
â”œâ”€â”€ asyncBatch.js
â”œâ”€â”€ largeBatch.js
â”œâ”€â”€ localPatentLib.js
â”œâ”€â”€ claimsComparison.js
â”œâ”€â”€ files.js
â”œâ”€â”€ dom.js
â””â”€â”€ state.js
```
**çŠ¶æ€**: âš ï¸ CSSè¿‡å¤§ï¼ŒJSå·²æ¨¡å—åŒ–ä½†main.jsä»éœ€æ‹†åˆ†

### 4. æµ‹è¯•æ–‡ä»¶
```
tests/
â”œâ”€â”€ test_*.py (å¤šä¸ªæµ‹è¯•æ–‡ä»¶)
â”œâ”€â”€ conftest.py
â””â”€â”€ __init__.py
```
**çŠ¶æ€**: âœ… ç»“æ„åˆç†

---

## ğŸ¯ é‡æ„ç›®æ ‡

### ä¸»è¦é—®é¢˜
1. **app.pyè¿‡äºåºå¤§** (1456è¡Œ)
   - åŒ…å«è·¯ç”±ã€ä¸šåŠ¡é€»è¾‘ã€æ•°æ®åº“æ“ä½œ
   - éš¾ä»¥ç»´æŠ¤å’Œæµ‹è¯•
   
2. **CSSæ–‡ä»¶è¿‡å¤§** (1200+è¡Œ)
   - æ‰€æœ‰æ ·å¼æ··åœ¨ä¸€èµ·
   - éš¾ä»¥å®šä½å’Œä¿®æ”¹

3. **æ ¹ç›®å½•æ··ä¹±**
   - æµ‹è¯•æ–‡ä»¶ã€æ¼”ç¤ºæ–‡ä»¶ã€æ–‡æ¡£æ··æ‚
   - ç¼ºä¹æ¸…æ™°çš„ç»„ç»‡ç»“æ„

4. **é…ç½®åˆ†æ•£**
   - ç¯å¢ƒå˜é‡ã€ç”¨æˆ·æ•°æ®ã€æ•°æ®åº“é…ç½®åˆ†æ•£

---

## ğŸ“ é‡æ„æ–¹æ¡ˆ

### é˜¶æ®µä¸€ï¼šåç«¯é‡æ„ (app.pyæ‹†åˆ†)

#### ç›®æ ‡ç»“æ„
```
backend/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ app.py (ä»…åŒ…å«åº”ç”¨åˆå§‹åŒ–å’Œé…ç½®ï¼Œ<100è¡Œ)
â”œâ”€â”€ config.py (é…ç½®ç®¡ç†)
â”œâ”€â”€ extensions.py (æ‰©å±•åˆå§‹åŒ–: CORS, db_poolç­‰)
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ user.py (ç”¨æˆ·æ¨¡å‹)
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ auth.py (ç™»å½•/ç™»å‡º)
â”‚   â”œâ”€â”€ chat.py (èŠå¤©ç›¸å…³API)
â”‚   â”œâ”€â”€ async_batch.py (å¼‚æ­¥æ‰¹å¤„ç†)
â”‚   â”œâ”€â”€ files.py (æ–‡ä»¶ç®¡ç†)
â”‚   â”œâ”€â”€ patent.py (ä¸“åˆ©æŸ¥è¯¢)
â”‚   â””â”€â”€ claims.py (æƒåˆ©è¦æ±‚å¤„ç†)
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ auth_service.py (è®¤è¯æœåŠ¡)
â”‚   â”œâ”€â”€ api_service.py (APIè°ƒç”¨å°è£…)
â”‚   â””â”€â”€ db_service.py (æ•°æ®åº“æ“ä½œ)
â”œâ”€â”€ middleware/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ auth_middleware.py (è®¤è¯ä¸­é—´ä»¶)
â””â”€â”€ utils/
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ response.py (ç»Ÿä¸€å“åº”æ ¼å¼)
    â””â”€â”€ validators.py (éªŒè¯å™¨)
```

#### æ‹†åˆ†è®¡åˆ’

**1. config.py** (é…ç½®ç®¡ç†)
```python
# é›†ä¸­ç®¡ç†æ‰€æœ‰é…ç½®
- æ•°æ®åº“é…ç½®
- APIå¯†é’¥é…ç½®
- ä¼šè¯é…ç½®
- æ–‡ä»¶ä¸Šä¼ é…ç½®
```

**2. extensions.py** (æ‰©å±•åˆå§‹åŒ–)
```python
# åˆå§‹åŒ–æ‰€æœ‰Flaskæ‰©å±•
- CORS
- PostgreSQLè¿æ¥æ± 
- å…¶ä»–æ‰©å±•
```

**3. routes/** (è·¯ç”±æ¨¡å—)
- `auth.py`: /login, /logout, /app
- `chat.py`: /api/stream_chat, /api/chat
- `async_batch.py`: /api/async_submit, /api/async_retrieve, /api/upload, /api/create_batch, /api/check_status, /api/download_result
- `files.py`: /api/files/*
- `patent.py`: /api/patent/search, /api/patent/analyze
- `claims.py`: /api/claims/*

**4. services/** (ä¸šåŠ¡é€»è¾‘)
- `auth_service.py`: ç”¨æˆ·è®¤è¯ã€IPç®¡ç†
- `api_service.py`: æ™ºè°±AI APIè°ƒç”¨å°è£…
- `db_service.py`: æ•°æ®åº“æ“ä½œå°è£…

**5. middleware/** (ä¸­é—´ä»¶)
- `auth_middleware.py`: ç™»å½•éªŒè¯ã€IPéªŒè¯

---

### é˜¶æ®µäºŒï¼šå‰ç«¯é‡æ„ (CSSæ‹†åˆ†)

#### ç›®æ ‡ç»“æ„
```
css/
â”œâ”€â”€ base/
â”‚   â”œâ”€â”€ variables.css (CSSå˜é‡å®šä¹‰)
â”‚   â”œâ”€â”€ reset.css (é‡ç½®æ ·å¼)
â”‚   â””â”€â”€ typography.css (å­—ä½“æ ·å¼)
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ buttons.css (æŒ‰é’®æ ·å¼)
â”‚   â”œâ”€â”€ forms.css (è¡¨å•æ ·å¼)
â”‚   â”œâ”€â”€ modals.css (æ¨¡æ€æ¡†æ ·å¼)
â”‚   â”œâ”€â”€ tabs.css (æ ‡ç­¾é¡µæ ·å¼)
â”‚   â”œâ”€â”€ tables.css (è¡¨æ ¼æ ·å¼)
â”‚   â””â”€â”€ cards.css (å¡ç‰‡æ ·å¼)
â”œâ”€â”€ layout/
â”‚   â”œâ”€â”€ header.css (å¤´éƒ¨æ ·å¼)
â”‚   â”œâ”€â”€ container.css (å®¹å™¨æ ·å¼)
â”‚   â””â”€â”€ grid.css (ç½‘æ ¼å¸ƒå±€)
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ chat.css (èŠå¤©é¡µé¢)
â”‚   â”œâ”€â”€ claims.css (æƒåˆ©è¦æ±‚å¤„ç†)
â”‚   â””â”€â”€ patent.css (ä¸“åˆ©æŸ¥è¯¢)
â””â”€â”€ main.css (å…¥å£æ–‡ä»¶ï¼Œå¯¼å…¥æ‰€æœ‰æ¨¡å—)
```

#### æ‹†åˆ†åŸåˆ™
1. **æŒ‰åŠŸèƒ½æ¨¡å—æ‹†åˆ†**: æ¯ä¸ªCSSæ–‡ä»¶å¯¹åº”ä¸€ä¸ªåŠŸèƒ½æ¨¡å—
2. **ä½¿ç”¨CSSå˜é‡**: ç»Ÿä¸€ç®¡ç†é¢œè‰²ã€é—´è·ç­‰
3. **æ¨¡å—åŒ–å¯¼å…¥**: main.cssä½œä¸ºå…¥å£ï¼Œå¯¼å…¥æ‰€æœ‰å­æ¨¡å—
4. **å‘½åè§„èŒƒ**: ä½¿ç”¨BEMå‘½åæ³•

---

### é˜¶æ®µä¸‰ï¼šç›®å½•ç»“æ„é‡ç»„

#### ç›®æ ‡ç»“æ„
```
project_root/
â”œâ”€â”€ backend/                    # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ app.py
â”‚   â”œâ”€â”€ config.py
â”‚   â”œâ”€â”€ extensions.py
â”‚   â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ utils/
â”œâ”€â”€ patent_claims_processor/    # æƒåˆ©è¦æ±‚å¤„ç†æ¨¡å—
â”œâ”€â”€ frontend/                   # å‰ç«¯èµ„æº
â”‚   â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ images/
â”‚   â””â”€â”€ templates/
â”‚       â”œâ”€â”€ index.html
â”‚       â””â”€â”€ help.html
â”œâ”€â”€ tests/                      # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ docs/                       # æ–‡æ¡£
â”‚   â”œâ”€â”€ API.md
â”‚   â”œâ”€â”€ DEPLOYMENT.md
â”‚   â””â”€â”€ FEATURES.md
â”œâ”€â”€ config/                     # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ users.json
â”œâ”€â”€ tools/                      # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ create_test_user.py
â”‚   â””â”€â”€ generate_user.py
â”œâ”€â”€ test_data/                  # æµ‹è¯•æ•°æ®
â”‚   â””â”€â”€ *.xlsx
â”œâ”€â”€ uploads/                    # ä¸Šä¼ æ–‡ä»¶
â”œâ”€â”€ output/                     # è¾“å‡ºæ–‡ä»¶
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ setup.py
â”œâ”€â”€ pytest.ini
â””â”€â”€ README.md
```

---

## ğŸš€ å®æ–½æ­¥éª¤

### Step 1: åˆ›å»ºæ–°çš„ç›®å½•ç»“æ„ (ä¸å½±å“ç°æœ‰åŠŸèƒ½)
```bash
mkdir -p backend/{routes,services,middleware,utils,models}
mkdir -p frontend/{css/{base,components,layout,pages},js,images,templates}
mkdir -p docs config tools test_data
```

### Step 2: åç«¯æ‹†åˆ† (é€æ­¥è¿ç§»)
1. åˆ›å»º `backend/config.py` - æå–é…ç½®
2. åˆ›å»º `backend/extensions.py` - æå–æ‰©å±•åˆå§‹åŒ–
3. åˆ›å»º `backend/utils/response.py` - æå–å“åº”å·¥å…·å‡½æ•°
4. åˆ›å»º `backend/routes/auth.py` - è¿ç§»è®¤è¯è·¯ç”±
5. åˆ›å»º `backend/routes/chat.py` - è¿ç§»èŠå¤©è·¯ç”±
6. åˆ›å»º `backend/routes/async_batch.py` - è¿ç§»å¼‚æ­¥æ‰¹å¤„ç†è·¯ç”±
7. åˆ›å»º `backend/routes/files.py` - è¿ç§»æ–‡ä»¶ç®¡ç†è·¯ç”±
8. åˆ›å»º `backend/routes/patent.py` - è¿ç§»ä¸“åˆ©æŸ¥è¯¢è·¯ç”±
9. åˆ›å»º `backend/routes/claims.py` - è¿ç§»æƒåˆ©è¦æ±‚å¤„ç†è·¯ç”±
10. åˆ›å»º `backend/services/` - æå–ä¸šåŠ¡é€»è¾‘
11. åˆ›å»º `backend/middleware/` - æå–ä¸­é—´ä»¶
12. æ›´æ–° `backend/app.py` - æ•´åˆæ‰€æœ‰æ¨¡å—

### Step 3: å‰ç«¯æ‹†åˆ† (é€æ­¥è¿ç§»)
1. åˆ›å»º `frontend/css/base/variables.css` - æå–CSSå˜é‡
2. åˆ›å»º `frontend/css/base/reset.css` - æå–é‡ç½®æ ·å¼
3. åˆ›å»º `frontend/css/components/*.css` - æ‹†åˆ†ç»„ä»¶æ ·å¼
4. åˆ›å»º `frontend/css/layout/*.css` - æ‹†åˆ†å¸ƒå±€æ ·å¼
5. åˆ›å»º `frontend/css/pages/*.css` - æ‹†åˆ†é¡µé¢æ ·å¼
6. æ›´æ–° `frontend/css/main.css` - å¯¼å…¥æ‰€æœ‰æ¨¡å—
7. æ›´æ–°HTMLæ–‡ä»¶ä¸­çš„CSSå¼•ç”¨

### Step 4: æ–‡ä»¶è¿ç§»
1. ç§»åŠ¨HTMLæ–‡ä»¶åˆ° `frontend/templates/`
2. ç§»åŠ¨å›¾ç‰‡åˆ° `frontend/images/`
3. ç§»åŠ¨æ–‡æ¡£åˆ° `docs/`
4. ç§»åŠ¨é…ç½®åˆ° `config/`
5. ç§»åŠ¨å·¥å…·è„šæœ¬åˆ° `tools/`
6. ç§»åŠ¨æµ‹è¯•æ•°æ®åˆ° `test_data/`

### Step 5: æ¸…ç†ä¸æµ‹è¯•
1. åˆ é™¤æ ¹ç›®å½•ä¸‹çš„æ¼”ç¤ºæ–‡ä»¶å’Œè°ƒè¯•æ–‡ä»¶
2. æ›´æ–°æ‰€æœ‰å¯¼å…¥è·¯å¾„
3. è¿è¡Œæµ‹è¯•ç¡®ä¿åŠŸèƒ½æ­£å¸¸
4. æ›´æ–°æ–‡æ¡£

---

## ğŸ“Š é¢„æœŸæ”¶ç›Š

### ä»£ç è´¨é‡
- âœ… å•ä¸€èŒè´£åŸåˆ™: æ¯ä¸ªæ–‡ä»¶èŒè´£æ˜ç¡®
- âœ… å¯ç»´æŠ¤æ€§: æ˜“äºå®šä½å’Œä¿®æ”¹ä»£ç 
- âœ… å¯æµ‹è¯•æ€§: æ¨¡å—åŒ–åæ›´æ˜“ç¼–å†™å•å…ƒæµ‹è¯•
- âœ… å¯æ‰©å±•æ€§: æ–°åŠŸèƒ½æ˜“äºæ·»åŠ 

### å¼€å‘æ•ˆç‡
- âœ… å‡å°‘ä»£ç å†²çª: å¤šäººåä½œæ—¶æ–‡ä»¶æ›´å°
- âœ… æé«˜å¼€å‘é€Ÿåº¦: å¿«é€Ÿå®šä½ç›¸å…³ä»£ç 
- âœ… é™ä½å­¦ä¹ æˆæœ¬: æ–°æˆå‘˜æ›´å®¹æ˜“ç†è§£é¡¹ç›®ç»“æ„

### æ€§èƒ½ä¼˜åŒ–
- âœ… CSSæŒ‰éœ€åŠ è½½: å¯ä»¥å®ç°é¡µé¢çº§CSSåŠ è½½
- âœ… JSæ¨¡å—åŒ–: å·²å®ç°ï¼Œå¯è¿›ä¸€æ­¥ä¼˜åŒ–
- âœ… ä»£ç åˆ†å‰²: ä¸ºæœªæ¥çš„ä»£ç åˆ†å‰²åšå‡†å¤‡

---

## âš ï¸ é£é™©ä¸æ³¨æ„äº‹é¡¹

### é£é™©
1. **è·¯å¾„å¼•ç”¨é—®é¢˜**: æ‹†åˆ†åéœ€è¦æ›´æ–°æ‰€æœ‰å¯¼å…¥è·¯å¾„
2. **åŠŸèƒ½å›å½’**: å¯èƒ½å¼•å…¥æ–°çš„bug
3. **éƒ¨ç½²é…ç½®**: éœ€è¦æ›´æ–°éƒ¨ç½²è„šæœ¬

### ç¼“è§£æªæ–½
1. **æ¸è¿›å¼é‡æ„**: é€æ­¥è¿ç§»ï¼Œæ¯æ¬¡è¿ç§»åæµ‹è¯•
2. **ä¿ç•™å¤‡ä»½**: é‡æ„å‰åˆ›å»ºgitåˆ†æ”¯
3. **å……åˆ†æµ‹è¯•**: æ¯ä¸ªé˜¶æ®µå®Œæˆåè¿è¡Œå®Œæ•´æµ‹è¯•
4. **æ–‡æ¡£æ›´æ–°**: åŠæ—¶æ›´æ–°å¼€å‘æ–‡æ¡£

---

## ğŸ“… æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | ä»»åŠ¡ | é¢„è®¡æ—¶é—´ |
|------|------|----------|
| 1 | åˆ›å»ºç›®å½•ç»“æ„ | 0.5å°æ—¶ |
| 2 | åç«¯æ‹†åˆ† (app.py) | 8-10å°æ—¶ |
| 3 | å‰ç«¯æ‹†åˆ† (CSS) | 4-6å°æ—¶ |
| 4 | æ–‡ä»¶è¿ç§»ä¸æ•´ç† | 2-3å°æ—¶ |
| 5 | æµ‹è¯•ä¸ä¿®å¤ | 4-6å°æ—¶ |
| 6 | æ–‡æ¡£æ›´æ–° | 2å°æ—¶ |
| **æ€»è®¡** | | **20-27å°æ—¶** |

---

## ğŸ¯ ä¼˜å…ˆçº§å»ºè®®

### é«˜ä¼˜å…ˆçº§ (ç«‹å³æ‰§è¡Œ)
1. âœ… **app.pyæ‹†åˆ†**: æœ€ç´§è¿«ï¼Œå½±å“æœ€å¤§
2. âœ… **æ ¹ç›®å½•æ¸…ç†**: æå‡é¡¹ç›®ä¸“ä¸šåº¦

### ä¸­ä¼˜å…ˆçº§ (è¿‘æœŸæ‰§è¡Œ)
3. âœ… **CSSæ‹†åˆ†**: æå‡å‰ç«¯å¯ç»´æŠ¤æ€§
4. âœ… **æ–‡æ¡£æ•´ç†**: ä¾¿äºå›¢é˜Ÿåä½œ

### ä½ä¼˜å…ˆçº§ (é•¿æœŸä¼˜åŒ–)
5. â³ **æ€§èƒ½ä¼˜åŒ–**: æŒ‰éœ€åŠ è½½ã€ä»£ç åˆ†å‰²
6. â³ **TypeScriptè¿ç§»**: æå‡ä»£ç è´¨é‡

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¯åš
1. åˆ›å»º `PROJECT_REFACTORING_PLAN.md` (æœ¬æ–‡æ¡£)
2. åˆ›å»ºæ–°çš„ç›®å½•ç»“æ„
3. å¼€å§‹æ‹†åˆ† `app.py` - ä»é…ç½®å’Œå·¥å…·å‡½æ•°å¼€å§‹

### éœ€è¦ç¡®è®¤
1. æ˜¯å¦ç«‹å³å¼€å§‹é‡æ„ï¼Ÿ
2. æ˜¯å¦éœ€è¦ä¿ç•™æ¼”ç¤ºæ–‡ä»¶ï¼Ÿ
3. éƒ¨ç½²é…ç½®æ˜¯å¦éœ€è¦åŒæ­¥æ›´æ–°ï¼Ÿ

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2026-01-14
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**è´Ÿè´£äºº**: å¼€å‘å›¢é˜Ÿ
