# åŠŸèƒ½å…« v7.0 - å¿«é€Ÿéƒ¨ç½²æŒ‡å— ğŸš€

## ğŸ“¦ æ›´æ–°å†…å®¹

æ–°å¢**è°ƒè¯•é¢æ¿**åŠŸèƒ½ï¼Œæ˜¾ç¤ºï¼š
- é™„å›¾OCRè¯†åˆ«çš„æ‰€æœ‰æ ‡å·ï¼ˆå«æœªåŒ¹é…ï¼‰
- è¯´æ˜ä¹¦æå–çš„æ‰€æœ‰éƒ¨ä»¶æ ‡è®°å’Œåç§°
- è¯¦ç»†çš„åŒ¹é…ç»Ÿè®¡å’ŒçŠ¶æ€ä¿¡æ¯

## ğŸ”„ æ›´æ–°çš„æ–‡ä»¶

### åç«¯
- `backend/routes/drawing_marker.py` - APIå“åº”å¢åŠ è°ƒè¯•ä¿¡æ¯

### å‰ç«¯
- `js/drawingMarkerInteractive_v6.js` - æ–°å¢è°ƒè¯•é¢æ¿æ–¹æ³•

### æµ‹è¯•
- `test_interactive_marker_v7_debug.html` - å®Œæ•´æµ‹è¯•é¡µé¢

## âš¡ å¿«é€Ÿéƒ¨ç½²æ­¥éª¤

### æœ¬åœ°æµ‹è¯•

```bash
# 1. ç¡®ä¿åç«¯æœåŠ¡è¿è¡Œ
python app.py

# 2. æ‰“å¼€æµ‹è¯•é¡µé¢
# æµè§ˆå™¨è®¿é—®: http://localhost:5000/test_interactive_marker_v7_debug.html

# 3. æµ‹è¯•æµç¨‹
# - ä¸Šä¼ é™„å›¾
# - è¾“å…¥è¯´æ˜ä¹¦æ–‡æœ¬
# - ç‚¹å‡»"å¼€å§‹å¤„ç†"
# - æŸ¥çœ‹è°ƒè¯•é¢æ¿
```

### é˜¿é‡Œäº‘éƒ¨ç½²

```bash
# 1. è¿æ¥æœåŠ¡å™¨
ssh root@ä½ çš„æœåŠ¡å™¨IP

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd /root/patent_system

# 3. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 4. é‡å¯æœåŠ¡
systemctl restart patent_system

# 5. éªŒè¯
curl http://localhost:5000/api/health
```

### ä½¿ç”¨Gitæ¨é€

```bash
# 1. æ·»åŠ æ›´æ–°çš„æ–‡ä»¶
git add backend/routes/drawing_marker.py
git add js/drawingMarkerInteractive_v6.js
git add test_interactive_marker_v7_debug.html
git add åŠŸèƒ½å…«v7.0è°ƒè¯•é¢æ¿å®Œæˆ.md
git add åŠŸèƒ½å…«v7.0å¿«é€Ÿéƒ¨ç½².md

# 2. æäº¤
git commit -m "åŠŸèƒ½å…«v7.0: æ–°å¢è°ƒè¯•é¢æ¿ï¼Œæ˜¾ç¤ºOCRè¯†åˆ«å’Œè¯´æ˜ä¹¦æå–çš„å®Œæ•´ä¿¡æ¯"

# 3. æ¨é€
git push origin main
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. APIæµ‹è¯•

```bash
curl -X POST http://localhost:5000/api/drawing-marker/process \
  -H "Content-Type: application/json" \
  -d '{
    "drawings": [{
      "name": "test.png",
      "type": "image/png",
      "size": 1024,
      "data": "base64_encoded_image_data"
    }],
    "specification": "1. åº•åº§\n2. æ—‹è½¬è‡‚\n3. å¤¹ç´§è£…ç½®"
  }'
```

**é¢„æœŸå“åº”**ï¼š
```json
{
  "success": true,
  "data": {
    "drawings": [{
      "debug_info": {
        "raw_ocr_results": [...],
        "filtered_count": 10,
        "matched_count": 8
      }
    }],
    "debug_info": {
      "total_markers_in_spec": 3,
      "extraction_method": "jiebaåˆ†è¯"
    }
  }
}
```

### 2. å‰ç«¯æµ‹è¯•

1. æ‰“å¼€ `test_interactive_marker_v7_debug.html`
2. ä¸Šä¼ æµ‹è¯•å›¾ç‰‡
3. è¾“å…¥è¯´æ˜ä¹¦æ–‡æœ¬
4. ç‚¹å‡»"å¼€å§‹å¤„ç†"
5. æ£€æŸ¥è°ƒè¯•é¢æ¿æ˜¯å¦æ˜¾ç¤ºï¼š
   - âœ… å·¦ä¾§æ˜¾ç¤ºOCRè¯†åˆ«ç»“æœ
   - âœ… å³ä¾§æ˜¾ç¤ºè¯´æ˜ä¹¦æå–ç»“æœ
   - âœ… é¢œè‰²ç¼–ç æ­£ç¡®ï¼ˆç»¿/é»„/çº¢ï¼‰
   - âœ… ç»Ÿè®¡ä¿¡æ¯å‡†ç¡®

## ğŸ¯ é›†æˆåˆ°ç°æœ‰é¡µé¢

### åœ¨index.htmlä¸­ä½¿ç”¨

```javascript
// 1. å¼•å…¥JSæ–‡ä»¶
<script src="js/drawingMarkerInteractive_v6.js"></script>

// 2. å¤„ç†APIå“åº”
fetch('/api/drawing-marker/process', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(requestData)
})
.then(res => res.json())
.then(data => {
    if (data.success) {
        const drawing = data.data.drawings[0];
        
        // åˆ›å»ºæ ‡æ³¨å®ä¾‹
        const marker = new InteractiveDrawingMarker(
            'canvasId',
            imageUrl,
            drawing.detected_numbers,
            data.data.reference_map,
            {
                enableDebugPanel: true,
                debugInfo: drawing.debug_info
            }
        );
        
        // åˆ›å»ºè°ƒè¯•é¢æ¿
        marker.createDebugPanel('debugPanelContainer');
    }
});

// 3. HTMLç»“æ„
<div id="canvasContainer">
    <canvas id="canvasId"></canvas>
</div>
<div id="debugPanelContainer"></div>
```

## ğŸ”§ é…ç½®é€‰é¡¹

### å¯ç”¨/ç¦ç”¨è°ƒè¯•é¢æ¿

```javascript
const marker = new InteractiveDrawingMarker(
    'canvasId',
    imageUrl,
    detectedNumbers,
    referenceMap,
    {
        enableDebugPanel: true,  // è®¾ä¸ºfalseç¦ç”¨è°ƒè¯•é¢æ¿
        debugInfo: {
            raw_ocr_results: [...],
            filtered_count: 10,
            matched_count: 8
        }
    }
);
```

## ğŸ“Š è°ƒè¯•é¢æ¿åŠŸèƒ½

### å·¦ä¾§ï¼šé™„å›¾OCRè¯†åˆ«
- åŸå§‹è¯†åˆ«æ•°é‡
- è¿‡æ»¤åæ•°é‡
- åŒ¹é…æˆåŠŸæ•°é‡
- æ¯ä¸ªæ ‡å·çš„è¯¦ç»†ä¿¡æ¯ï¼ˆæ ‡å·ã€ä½ç½®ã€ç½®ä¿¡åº¦ã€åŒ¹é…çŠ¶æ€ï¼‰

### å³ä¾§ï¼šè¯´æ˜ä¹¦æå–
- æ€»éƒ¨ä»¶æ•°
- å·²è¯†åˆ«æ•°é‡
- åŒ¹é…ç‡
- æ¯ä¸ªéƒ¨ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼ˆæ ‡å·ã€åç§°ã€è¯†åˆ«çŠ¶æ€ï¼‰

### é¢œè‰²ç¼–ç 
- ğŸŸ¢ **ç»¿è‰²**ï¼šå·²åŒ¹é…/å·²è¯†åˆ«
- ğŸŸ¡ **é»„è‰²**ï¼šOCRè¯†åˆ«ä½†æœªåŒ¹é…
- ğŸ”´ **çº¢è‰²**ï¼šè¯´æ˜ä¹¦ä¸­æœ‰ä½†æœªè¯†åˆ«

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **è°ƒè¯•ä¿¡æ¯å¤§å°**ï¼šå¤§é‡æ ‡å·æ—¶ï¼Œè°ƒè¯•é¢æ¿å¯èƒ½è¾ƒå¤§ï¼Œå»ºè®®è®¾ç½®æœ€å¤§é«˜åº¦å¹¶å¯ç”¨æ»šåŠ¨
2. **æ€§èƒ½å½±å“**ï¼šè°ƒè¯•ä¿¡æ¯ä»…åœ¨å‰ç«¯æ¸²æŸ“æ—¶ç”Ÿæˆï¼Œä¸å½±å“APIæ€§èƒ½
3. **ç”Ÿäº§ç¯å¢ƒ**ï¼šå¯é€šè¿‡é…ç½®é€‰é¡¹ç¦ç”¨è°ƒè¯•é¢æ¿
4. **æµè§ˆå™¨å…¼å®¹**ï¼šéœ€è¦ç°ä»£æµè§ˆå™¨æ”¯æŒï¼ˆChrome 90+, Firefox 88+, Safari 14+ï¼‰

## ğŸ› æ•…éšœæ’æŸ¥

### è°ƒè¯•é¢æ¿ä¸æ˜¾ç¤º
```javascript
// æ£€æŸ¥1ï¼šç¡®è®¤å®¹å™¨å­˜åœ¨
const container = document.getElementById('debugPanelContainer');
console.log('Container exists:', !!container);

// æ£€æŸ¥2ï¼šç¡®è®¤è°ƒè¯•ä¿¡æ¯å­˜åœ¨
console.log('Debug info:', marker.debugInfo);

// æ£€æŸ¥3ï¼šç¡®è®¤é€‰é¡¹å¯ç”¨
console.log('Debug panel enabled:', marker.options.enableDebugPanel);
```

### æ•°æ®ä¸å‡†ç¡®
```javascript
// æ£€æŸ¥APIå“åº”
console.log('API response:', apiResponse);
console.log('Debug info:', apiResponse.data.drawings[0].debug_info);
console.log('Reference map:', apiResponse.data.reference_map);
```

## ğŸ“ˆ æ€§èƒ½ç›‘æ§

```javascript
// æµ‹é‡æ¸²æŸ“æ—¶é—´
console.time('Debug panel render');
marker.createDebugPanel('debugPanelContainer');
console.timeEnd('Debug panel render');

// æ£€æŸ¥DOMå…ƒç´ æ•°é‡
const panel = document.querySelector('.drawing-marker-debug-panel');
console.log('Panel elements:', panel?.querySelectorAll('*').length);
```

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] åç«¯ä»£ç å·²æ›´æ–°
- [ ] å‰ç«¯JSæ–‡ä»¶å·²æ›´æ–°
- [ ] æµ‹è¯•é¡µé¢å¯è®¿é—®
- [ ] APIè¿”å›è°ƒè¯•ä¿¡æ¯
- [ ] è°ƒè¯•é¢æ¿æ­£ç¡®æ˜¾ç¤º
- [ ] é¢œè‰²ç¼–ç æ­£ç¡®
- [ ] ç»Ÿè®¡ä¿¡æ¯å‡†ç¡®
- [ ] æ»šåŠ¨åŠŸèƒ½æ­£å¸¸
- [ ] å“åº”å¼å¸ƒå±€æ­£å¸¸
- [ ] ç”Ÿäº§ç¯å¢ƒé…ç½®æ­£ç¡®

## ğŸ‰ å®Œæˆ

åŠŸèƒ½å…«v7.0è°ƒè¯•é¢æ¿å·²å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥ç«‹å³éƒ¨ç½²ä½¿ç”¨ï¼

---

**éœ€è¦å¸®åŠ©ï¼Ÿ** æŸ¥çœ‹ `åŠŸèƒ½å…«v7.0è°ƒè¯•é¢æ¿å®Œæˆ.md` äº†è§£è¯¦ç»†åŠŸèƒ½è¯´æ˜ã€‚
