# åŠŸèƒ½å…«OCRä¿®å¤ - å¿«é€Ÿå‘½ä»¤å‚è€ƒ

## ğŸš€ ä¸€é”®ä¿®å¤ï¼ˆæ¨èï¼‰

### Windowsç”¨æˆ·
åŒå‡»è¿è¡Œï¼š
```
ä¸€é”®ä¿®å¤OCRä¾èµ–.bat
```

### æˆ–è€…æ‰‹åŠ¨æ‰§è¡Œ

#### 1. ä¸Šä¼ è„šæœ¬
```bash
scp scripts/install_ocr_deps_aliyun.sh root@43.99.101.195:/home/appuser/patent-app/
```

#### 2. æ‰§è¡Œå®‰è£…
```bash
ssh root@43.99.101.195 "su - appuser -c 'cd ~/patent-app && chmod +x scripts/install_ocr_deps_aliyun.sh && ./scripts/install_ocr_deps_aliyun.sh'"
```

---

## ğŸ“‹ æ‰‹åŠ¨å®‰è£…å‘½ä»¤

### æ–¹å¼ä¸€ï¼šä¸€æ¡å‘½ä»¤å®Œæˆ
```bash
ssh root@43.99.101.195 "su - appuser -c 'cd ~/patent-app && pip3 install pytesseract==0.3.10 opencv-python==4.8.1.78 Pillow==10.1.0 && python3 -c \"import pytesseract; import cv2; from PIL import Image; print(\\\"âœ… æ‰€æœ‰åº“å®‰è£…æˆåŠŸ\\\")\"'"
```

### æ–¹å¼äºŒï¼šåˆ†æ­¥æ‰§è¡Œ
```bash
# 1. è¿æ¥æœåŠ¡å™¨
ssh root@43.99.101.195

# 2. åˆ‡æ¢ç”¨æˆ·å¹¶è¿›å…¥ç›®å½•
su - appuser
cd ~/patent-app

# 3. å®‰è£…ä¾èµ–
pip3 install pytesseract==0.3.10 opencv-python==4.8.1.78 Pillow==10.1.0

# 4. éªŒè¯å®‰è£…
python3 -c "import pytesseract; import cv2; from PIL import Image; print('âœ… æ‰€æœ‰åº“å®‰è£…æˆåŠŸ')"

# 5. é€€å‡ºappuser
exit

# 6. é‡å¯åº”ç”¨
sudo systemctl restart patent-app
```

---

## ğŸ” è¯Šæ–­å‘½ä»¤

### æ£€æŸ¥Pythonåº“æ˜¯å¦å·²å®‰è£…
```bash
ssh root@43.99.101.195 "su - appuser -c 'python3 -c \"import pytesseract; import cv2; from PIL import Image; print(\\\"âœ… æ‰€æœ‰åº“å·²å®‰è£…\\\")\"'"
```

### æŸ¥çœ‹åº”ç”¨æ—¥å¿—
```bash
ssh root@43.99.101.195 "su - appuser -c 'tail -f ~/patent-app/logs/error.log'"
```

### æŸ¥çœ‹åº”ç”¨è¿›ç¨‹
```bash
ssh root@43.99.101.195 "ps aux | grep -E 'python|gunicorn|uwsgi' | grep -v grep"
```

### æŸ¥çœ‹ç«¯å£å ç”¨
```bash
ssh root@43.99.101.195 "netstat -tlnp | grep -E ':80|:5000|:8000'"
```

---

## ğŸ”„ é‡å¯åº”ç”¨

### å¦‚æœä½¿ç”¨systemd
```bash
ssh root@43.99.101.195 "systemctl restart patent-app"
```

### å¦‚æœä½¿ç”¨gunicorn
```bash
ssh root@43.99.101.195 "pkill -HUP gunicorn"
```

### å¦‚æœä½¿ç”¨supervisor
```bash
ssh root@43.99.101.195 "supervisorctl restart patent-app"
```

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
ssh root@43.99.101.195 "systemctl status patent-app"
```

---

## ğŸ§ª æµ‹è¯•åŠŸèƒ½å…«

### 1. æ‰“å¼€ç½‘ç«™
```
http://43.99.101.195
```

### 2. è¿›å…¥åŠŸèƒ½å…«
ç‚¹å‡»"ä¸“åˆ©é™„å›¾æ ‡è®°è¯†åˆ«"

### 3. æµ‹è¯•æ•°æ®
**è¯´æ˜ä¹¦å†…å®¹**ï¼š
```
1. åº•åº§
2. æ—‹è½¬è‡‚
3. å¤¹ç´§è£…ç½®
4. æ§åˆ¶é¢æ¿
5. ç”µæºçº¿
```

### 4. é¢„æœŸç»“æœ
- âœ… è¯†åˆ«å‡ºæ•°å­—æ•°é‡ > 0ï¼ˆä¸å†æ˜¯0ï¼‰
- âœ… æ˜¾ç¤ºçœŸå®çš„åŒ¹é…ç‡
- âœ… åœ¨å›¾ç‰‡ä¸Šæ ‡æ³¨è¯†åˆ«ä½ç½®
- âœ… æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡ä¿¡æ¯

### 5. æŸ¥çœ‹æ—¥å¿—ï¼ˆåŒæ—¶åœ¨å¦ä¸€ä¸ªç»ˆç«¯ï¼‰
```bash
ssh root@43.99.101.195 "su - appuser -c 'tail -f ~/patent-app/logs/error.log'"
```

åº”è¯¥çœ‹åˆ°ï¼š
```
[DEBUG] Extracted reference_map: {'1': 'åº•åº§', '2': 'æ—‹è½¬è‡‚', ...}
[DEBUG] Processing drawing: test.png
[DEBUG] OCR detected: '1' (confidence: 95)
[DEBUG] OCR detected: '2' (confidence: 88)
[DEBUG] Matched 2 numbers with reference_map
```

---

## âš ï¸ å¸¸è§é—®é¢˜å¿«é€Ÿä¿®å¤

### é—®é¢˜1ï¼špip installå¤±è´¥
```bash
ssh root@43.99.101.195 "su - appuser -c 'pip3 install --break-system-packages pytesseract opencv-python Pillow'"
```

### é—®é¢˜2ï¼šopencv-pythonå®‰è£…å¤±è´¥
```bash
ssh root@43.99.101.195 "apt-get update && apt-get install -y libgl1-mesa-glx libglib2.0-0"
ssh root@43.99.101.195 "su - appuser -c 'pip3 install opencv-python'"
```

### é—®é¢˜3ï¼šè™šæ‹Ÿç¯å¢ƒé—®é¢˜
```bash
ssh root@43.99.101.195 "su - appuser -c 'cd ~/patent-app && source venv/bin/activate && pip install pytesseract opencv-python Pillow && deactivate'"
```

### é—®é¢˜4ï¼šæ¸…é™¤ç¼“å­˜
```bash
ssh root@43.99.101.195 "su - appuser -c 'find ~/patent-app -type d -name __pycache__ -exec rm -rf {} +'"
```

---

## ğŸ“Š å®Œæ•´è¯Šæ–­æŠ¥å‘Š

è¿è¡Œè¿™ä¸ªå‘½ä»¤è·å–å®Œæ•´è¯Šæ–­ä¿¡æ¯ï¼š
```bash
ssh root@43.99.101.195 "su - appuser -c 'cd ~/patent-app && cat << EOF
=== Tesseractç‰ˆæœ¬ ===
\$(tesseract --version 2>&1 | head -n 1)

=== Pythonç‰ˆæœ¬ ===
\$(python3 --version)

=== Pythonåº“æ£€æŸ¥ ===
\$(python3 -c \"
try:
    import pytesseract
    print(\\\"âœ… pytesseract:\\\", pytesseract.__version__)
except ImportError:
    print(\\\"âŒ pytesseract: NOT INSTALLED\\\")

try:
    import cv2
    print(\\\"âœ… opencv-python:\\\", cv2.__version__)
except ImportError:
    print(\\\"âŒ opencv-python: NOT INSTALLED\\\")

try:
    from PIL import Image
    import PIL
    print(\\\"âœ… Pillow:\\\", PIL.__version__)
except ImportError:
    print(\\\"âŒ Pillow: NOT INSTALLED\\\")
\")

=== åº”ç”¨è¿›ç¨‹ ===
\$(ps aux | grep -E \\\"python|gunicorn|uwsgi\\\" | grep -v grep)

=== ç«¯å£å ç”¨ ===
\$(netstat -tlnp | grep -E \\\":80|:5000|:8000\\\")
EOF
'"
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- ğŸ“– `ç«‹å³ä¿®å¤-åŠŸèƒ½å…«OCRä¾èµ–.md` - è¯¦ç»†ä¿®å¤æŒ‡å—
- ğŸ“– `é˜¿é‡Œäº‘OCRä¾èµ–å®‰è£…æŒ‡å—.md` - å®Œæ•´å®‰è£…æ­¥éª¤
- ğŸ“– `é˜¿é‡Œäº‘åç«¯æ—¥å¿—æŸ¥çœ‹æŒ‡å—.md` - æ—¥å¿—æŸ¥çœ‹æ–¹æ³•
- ğŸ”§ `scripts/install_ocr_deps_aliyun.sh` - è‡ªåŠ¨åŒ–å®‰è£…è„šæœ¬
- ğŸš€ `ä¸€é”®ä¿®å¤OCRä¾èµ–.bat` - Windowsä¸€é”®ä¿®å¤è„šæœ¬

---

## âœ… éªŒè¯æ¸…å•

å®‰è£…å®Œæˆåï¼Œç¡®è®¤ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] pytesseractå·²å®‰è£…
- [ ] opencv-pythonå·²å®‰è£…
- [ ] Pillowå·²å®‰è£…
- [ ] åº”ç”¨æœåŠ¡å·²é‡å¯
- [ ] åŠŸèƒ½å…«èƒ½è¯†åˆ«å‡ºæ•°å­—ï¼ˆä¸å†æ˜¯0ï¼‰
- [ ] å‰ç«¯æ˜¾ç¤ºçœŸå®çš„è¯†åˆ«ç»“æœ
- [ ] Canvasä¸Šæ­£ç¡®æ ‡æ³¨ä½ç½®
- [ ] æ—¥å¿—æ˜¾ç¤ºOCRè¯†åˆ«è¿‡ç¨‹

å…¨éƒ¨å®Œæˆåï¼ŒåŠŸèƒ½å…«å°±èƒ½æ­£å¸¸å·¥ä½œäº†ï¼ğŸ‰
