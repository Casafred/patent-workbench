# 用户管理系统 v3.0 新功能说明

## 更新内容

### 新增功能

1. **个人信息备注**
   - 为每个用户添加备注信息
   - 可以记录姓名、部门、职位等信息
   - 示例：`张三 - 研发部门 - 高级工程师`

2. **自动记录注册时间**
   - 添加用户时自动记录创建时间
   - 格式：`2026/01/20 15:30:45`
   - 便于追踪用户账号创建历史

3. **增强的用户列表显示**
   - 显示注册时间
   - 显示个人信息备注
   - 更清晰的卡片式布局

### 数据格式变更

#### 旧格式（v2.0及之前）
```json
{
    "username1": "password_hash1",
    "username2": "password_hash2"
}
```

#### 新格式（v3.0）
```json
{
    "users": {
        "username1": "password_hash1",
        "username2": "password_hash2"
    },
    "metadata": {
        "username1": {
            "createdAt": "2026/01/20 15:30:45",
            "note": "张三 - 研发部门 - 高级工程师"
        },
        "username2": {
            "createdAt": "2026/01/20 15:35:20",
            "note": "李四 - 测试部门 - 测试工程师"
        }
    },
    "version": "3.0",
    "exportedAt": "2026-01-20T07:30:45.123Z"
}
```

## 向后兼容性

### 自动兼容旧格式

系统会自动识别并兼容旧格式的 users.json 文件：

1. **导入旧格式文件**
   - 自动转换为新格式
   - 为旧用户创建默认元数据
   - 注册时间标记为"导入时未记录"

2. **后端兼容性**
   - `auth_service.py` 已更新，支持两种格式
   - 自动检测并提取用户数据
   - 无需修改现有代码

### 迁移步骤

如果你有旧格式的 users.json：

1. 在浏览器中打开 `用户管理.html`
2. 导入旧的 users.json 文件
3. 系统自动转换为新格式
4. 可选：为用户添加备注信息
5. 下载新的 users.json 文件
6. 替换到 `backend/user_management/users.json`

## 使用示例

### 添加带备注的用户

```
用户名: alfred777
密码: alfred777
个人信息备注: Alfred - 创始人 - 系统管理员
```

保存后的数据：
```json
{
    "users": {
        "alfred777": "pbkdf2:sha256:260000$..."
    },
    "metadata": {
        "alfred777": {
            "createdAt": "2026/01/20 15:30:45",
            "note": "Alfred - 创始人 - 系统管理员"
        }
    }
}
```

### 用户列表显示

```
┌─────────────────────────────────────────────┐
│ 👤 alfred777                                │
│ 📅 注册时间: 2026/01/20 15:30:45           │
│                                             │
│ 📝 个人信息备注：                           │
│ Alfred - 创始人 - 系统管理员                │
│                                             │
│ 密码哈希: pbkdf2:sha256:260000$...         │
│                                    [🗑️ 删除] │
└─────────────────────────────────────────────┘
```

## 备注字段建议格式

推荐使用以下格式记录用户信息：

### 格式 1：姓名 - 部门 - 职位
```
张三 - 研发部门 - 高级工程师
李四 - 测试部门 - 测试工程师
王五 - 产品部门 - 产品经理
```

### 格式 2：姓名 - 联系方式
```
张三 - 13800138000
李四 - lisi@company.com
```

### 格式 3：姓名 - 权限级别 - 备注
```
张三 - 管理员 - 负责系统维护
李四 - 普通用户 - 测试账号
```

### 格式 4：自由格式
```
临时测试账号，2026年3月31日到期
客户演示账号，仅供展示使用
```

## 技术细节

### 数据结构

```typescript
interface UserData {
    users: {
        [username: string]: string;  // password hash
    };
    metadata: {
        [username: string]: {
            createdAt: string;  // 注册时间
            note: string;       // 个人信息备注
        };
    };
    version: string;      // 数据格式版本
    exportedAt: string;   // 导出时间（ISO 8601）
}
```

### 时间格式

- **注册时间**：`YYYY/MM/DD HH:mm:ss`（本地时间）
- **导出时间**：ISO 8601 格式（UTC时间）

### 密码加密

仍然使用 PBKDF2-SHA256 算法：
- 迭代次数：260,000
- 哈希算法：SHA-256
- 格式：`pbkdf2:sha256:260000$salt$hash`

## 常见问题

### Q1: 旧的 users.json 还能用吗？

✅ 可以！系统完全兼容旧格式。导入后会自动转换。

### Q2: 如果不填写备注会怎样？

备注是可选的，不填写也不影响用户登录。

### Q3: 可以修改已有用户的备注吗？

目前需要删除用户后重新添加。未来版本会支持编辑功能。

### Q4: 注册时间可以手动修改吗？

当前版本不支持手动修改。时间由系统自动生成。

### Q5: 导出的文件能直接用于部署吗？

✅ 可以！后端已更新，支持新格式。直接替换即可。

## 升级建议

### 立即升级的理由

1. ✅ **更好的用户管理** - 备注功能便于识别用户
2. ✅ **审计追踪** - 记录用户创建时间
3. ✅ **向后兼容** - 不影响现有系统
4. ✅ **零风险** - 可随时回退到旧格式

### 升级步骤

1. 备份现有的 `users.json`
2. 使用新版 `用户管理.html` 导入旧文件
3. 为重要用户添加备注
4. 下载新格式文件
5. 替换到项目目录
6. 测试登录功能

## 未来计划

- [ ] 支持编辑用户备注
- [ ] 支持批量导入用户
- [ ] 支持用户权限级别
- [ ] 支持用户状态（启用/禁用）
- [ ] 支持最后登录时间记录
- [ ] 支持密码过期提醒

## 相关文档

- [用户管理指南](USER_MANAGEMENT_GUIDE.md)
- [密码重置指南](USER_PASSWORD_RESET_GUIDE.md)
- [部署配置指南](../DEPLOY_WITH_USERS.md)
