# 功能八 v6.0 部署指南

## 🎯 v6.0 核心改进

**主界面和弹窗功能完全一致！**

### 新增功能
1. ✅ **主界面滚轮缩放**：鼠标滚轮缩放图片（10%-1000%）
2. ✅ **主界面拖拽移动**：拖动空白处移动视图
3. ✅ **弹窗滚轮缩放**：弹窗中也可以滚轮缩放
4. ✅ **弹窗拖拽移动**：弹窗中也可以拖动视图
5. ✅ **点击选中标注**：单击选中，Ctrl多选
6. ✅ **快捷按钮调整字体**：选中+/选中-/全部+/全部-
7. ✅ **完全同步**：弹窗和主界面实时同步

### 修复问题
- ❌ v5.0：弹窗中无法拖拽、编辑、删除标注
- ✅ v6.0：弹窗中所有功能与主界面完全一致

- ❌ v5.0：字体调整用滑块，不方便
- ✅ v6.0：快捷按钮，可以选中部分或全部调整

- ❌ v5.0：主界面没有滚轮缩放
- ✅ v6.0：主界面和弹窗都支持滚轮缩放

## 📋 快速部署

### 1. 服务器部署
```bash
# 连接服务器
ssh root@47.115.230.206

# 进入项目目录
cd /www/wwwroot/ipx.asia

# 拉取最新代码
git pull origin main

# 验证文件
git log --oneline -1
# 应该显示: 85158f6 功能八v6.0: 主界面和弹窗功能完全一致

# 重启服务
sudo systemctl restart patent_app
sudo systemctl reload nginx

# 检查状态
sudo systemctl status patent_app
```

### 2. 清除缓存
```
浏览器：Ctrl + Shift + Delete → 清除缓存
强制刷新：Ctrl + F5
```

## 🧪 测试步骤

### 主界面测试（5分钟）

1. **滚轮缩放**
   - 滚动鼠标滚轮
   - 向上：放大
   - 向下：缩小
   - ✅ 应该能缩放到10%-1000%

2. **拖拽移动**
   - 鼠标拖动空白处
   - ✅ 视图应该跟随移动

3. **拖拽标注**
   - 鼠标拖动标注文字
   - ✅ 标注应该跟随移动

4. **双击编辑**
   - 双击标注文字
   - ✅ 弹出输入框

5. **右键删除**
   - 右键点击标注
   - ✅ 弹出确认框

6. **点击选中**
   - 单击标注
   - ✅ 标注变绿色高亮
   - Ctrl+点击另一个标注
   - ✅ 可以多选

7. **字体调整**
   - 选中一个标注
   - 点击"选中字体+"
   - ✅ 选中标注字体变大
   - 点击"全部字体+"
   - ✅ 所有标注字体变大

### 弹窗测试（5分钟）

1. **打开弹窗**
   - 点击"放大查看"按钮
   - ✅ 弹窗显示

2. **重复主界面所有操作**
   - 滚轮缩放 ✅
   - 拖拽移动 ✅
   - 拖拽标注 ✅
   - 双击编辑 ✅
   - 右键删除 ✅
   - 点击选中 ✅
   - 字体调整 ✅

3. **关闭弹窗**
   - 点击"关闭 ✕"
   - ✅ 主界面同步所有修改

## ✅ 验证清单

### 主界面
- [ ] 滚轮缩放正常
- [ ] 拖拽移动正常
- [ ] 拖拽标注正常
- [ ] 双击编辑正常
- [ ] 右键删除正常
- [ ] 点击选中正常
- [ ] Ctrl多选正常
- [ ] 选中字体+正常
- [ ] 选中字体-正常
- [ ] 全部字体+正常
- [ ] 全部字体-正常

### 弹窗
- [ ] 打开弹窗正常
- [ ] 滚轮缩放正常
- [ ] 拖拽移动正常
- [ ] 拖拽标注正常
- [ ] 双击编辑正常
- [ ] 右键删除正常
- [ ] 点击选中正常
- [ ] Ctrl多选正常
- [ ] 选中+正常
- [ ] 选中-正常
- [ ] 全部+正常
- [ ] 全部-正常
- [ ] 关闭弹窗正常
- [ ] 主界面同步正常

## 🔍 故障排查

### 问题1：滚轮缩放不工作
**检查**：
- 浏览器缓存是否清除
- JS文件是否加载（F12 → Network）
- Console是否有错误

**解决**：
```bash
# 服务器上检查文件
head -20 /www/wwwroot/ipx.asia/js/drawingMarkerInteractive.js
# 应该包含: v6.0
```

### 问题2：弹窗功能不完整
**检查**：
- 是否是v6.0版本
- 弹窗中是否有字体控制按钮

**解决**：
- 清除浏览器缓存
- Ctrl + F5 强制刷新

### 问题3：主界面和弹窗不同步
**检查**：
- 在弹窗中修改后，关闭弹窗
- 主界面是否显示修改

**解决**：
- 确认是v6.0版本
- 重新部署

## 📊 功能对比

### v5.0 vs v6.0

| 功能 | v5.0 | v6.0 | 改进 |
|------|------|------|------|
| 主界面滚轮缩放 | ❌ | ✅ | 新增 |
| 主界面拖拽视图 | ❌ | ✅ | 新增 |
| 弹窗滚轮缩放 | ⚠️ 滑块 | ✅ 滚轮 | 改进 |
| 弹窗拖拽标注 | ❌ | ✅ | 修复 |
| 弹窗双击编辑 | ❌ | ✅ | 修复 |
| 弹窗右键删除 | ❌ | ✅ | 修复 |
| 点击选中标注 | ❌ | ✅ | 新增 |
| 字体调整方式 | ⚠️ 滑块 | ✅ 按钮 | 改进 |
| 选中标注调整 | ❌ | ✅ | 新增 |
| 主界面弹窗一致 | ❌ | ✅ | 核心改进 |

## 🎯 关键验证点

### 1. 滚轮缩放
- 主界面：滚动滚轮，图片缩放 ✅
- 弹窗：滚动滚轮，图片缩放 ✅

### 2. 拖拽移动
- 主界面：拖动空白处，视图移动 ✅
- 弹窗：拖动空白处，视图移动 ✅

### 3. 拖拽标注
- 主界面：拖动标注，位置改变 ✅
- 弹窗：拖动标注，位置改变 ✅
- 同步：弹窗修改，主界面同步 ✅

### 4. 编辑删除
- 主界面：双击编辑，右键删除 ✅
- 弹窗：双击编辑，右键删除 ✅
- 同步：弹窗修改，主界面同步 ✅

### 5. 选中功能
- 主界面：点击选中，Ctrl多选 ✅
- 弹窗：点击选中，Ctrl多选 ✅
- 同步：弹窗选中，主界面同步 ✅

### 6. 字体调整
- 主界面：选中+/选中-/全部+/全部- ✅
- 弹窗：选中+/选中-/全部+/全部- ✅
- 同步：弹窗调整，主界面同步 ✅

## 🎉 部署成功标志

当你看到以下所有功能时，说明v6.0部署成功：

1. ✅ 主界面可以滚轮缩放
2. ✅ 主界面可以拖拽移动
3. ✅ 主界面可以点击选中标注（绿色高亮）
4. ✅ 主界面有字体控制按钮（选中+/选中-/全部+/全部-）
5. ✅ 弹窗可以滚轮缩放
6. ✅ 弹窗可以拖拽移动
7. ✅ 弹窗可以拖拽标注
8. ✅ 弹窗可以双击编辑
9. ✅ 弹窗可以右键删除
10. ✅ 弹窗可以点击选中标注
11. ✅ 弹窗有字体控制按钮
12. ✅ 弹窗修改后，主界面同步

## 📞 需要帮助？

如果遇到问题，请提供：

1. **服务器信息**
   ```bash
   git log --oneline -1
   head -20 js/drawingMarkerInteractive.js
   ```

2. **浏览器信息**
   - F12 → Console 的错误信息
   - F12 → Network → drawingMarkerInteractive.js 的状态

3. **具体问题**
   - 哪个功能不工作
   - 主界面还是弹窗
   - 是否清除了缓存

## 🚀 下一步

部署成功后，可以：

1. 测试所有功能
2. 体验主界面和弹窗的一致性
3. 使用滚轮缩放和拖拽移动
4. 使用快捷按钮调整字体
5. 使用选中功能批量操作

---

**版本**: v6.0  
**提交**: 85158f6  
**日期**: 2026-01-30  
**状态**: ✅ 已推送到Git
