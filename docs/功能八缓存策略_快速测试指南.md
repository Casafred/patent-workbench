# 功能八缓存策略 - 快速测试指南

## 🎯 测试目标

验证智能缓存策略是否正确工作：
- 输入变化时自动清除缓存
- 处理完成后保存缓存
- 页面刷新后智能恢复缓存

## 🧪 测试步骤

### 测试1：正常流程（缓存保存和恢复）

1. **清除所有缓存**
   - 按 F12 打开开发者工具
   - 切换到 Application 标签
   - 左侧选择 Local Storage
   - 右键 → Clear
   - 刷新页面（Ctrl + F5）

2. **上传图片并处理**
   - 上传一张图片
   - 输入说明书内容
   - 点击"开始处理"
   - 等待处理完成

3. **检查控制台**
   ```
   预期日志：
   ✅ 处理结果已缓存（可恢复），缓存键: processing_cache_xxx
   ```

4. **刷新页面**
   - 按 F5 刷新
   - **预期**：自动恢复图片和标注结果
   - **预期日志**：`✅ 发现手动保存的缓存，尝试恢复...`

### 测试2：修改图片（清除缓存）

1. **在测试1的基础上**
   - 页面已有缓存的标注结果

2. **上传新图片**
   - 点击上传区域
   - 选择一张新图片

3. **检查控制台**
   ```
   预期日志：
   🔄 图片上传变化，已清除 X 个缓存
   ```

4. **检查显示**
   - **预期**：标注结果区域被清空
   - **预期**：显示"处理完成后，标注后的附图将显示在此处"

5. **刷新页面**
   - 按 F5 刷新
   - **预期**：不恢复旧缓存
   - **预期日志**：`⚠️ 没有手动保存的缓存，跳过自动恢复`

### 测试3：删除图片（清除缓存）

1. **上传图片并处理**
   - 重复测试1的步骤

2. **删除图片**
   - 点击图片列表中的"删除"按钮

3. **检查控制台**
   ```
   预期日志：
   🔄 图片删除变化，已清除 X 个缓存
   ```

4. **检查显示**
   - **预期**：标注结果被清空

### 测试4：旋转图片（清除缓存）

1. **上传图片并处理**
   - 重复测试1的步骤

2. **旋转图片**
   - 点击图片列表中的旋转按钮（↶ 或 ↷）

3. **检查控制台**
   ```
   预期日志：
   图片 0 旋转: 0° → 90°
   🔄 图片旋转变化，已清除 X 个缓存
   ```

4. **检查显示**
   - **预期**：标注结果被清空

### 测试5：修改说明书（清除缓存，防抖）

1. **上传图片并处理**
   - 重复测试1的步骤

2. **修改说明书**
   - 在说明书输入框中修改内容
   - **等待1秒**（防抖时间）

3. **检查控制台**
   ```
   预期日志（1秒后）：
   🔄 说明书内容变化，已清除 X 个缓存
   ```

4. **检查显示**
   - **预期**：标注结果被清空

### 测试6：快速修改说明书（防抖测试）

1. **上传图片并处理**
   - 重复测试1的步骤

2. **快速连续修改说明书**
   - 输入一些字符
   - 立即删除
   - 再输入
   - 重复几次

3. **检查控制台**
   - **预期**：只在停止输入1秒后才清除缓存
   - **预期**：不会频繁清除缓存

## ✅ 验收清单

### 缓存保存
- [ ] 处理完成后，控制台显示"✅ 处理结果已缓存"
- [ ] Local Storage中有 `drawing_cache_saved` 标记
- [ ] Local Storage中有 `processing_cache_xxx` 数据

### 缓存恢复
- [ ] 页面刷新后，自动恢复图片和标注
- [ ] 控制台显示"✅ 发现手动保存的缓存"

### 缓存清除 - 图片上传
- [ ] 上传新图片后，控制台显示"🔄 图片上传变化"
- [ ] 标注结果被清空
- [ ] Local Storage中的缓存被删除

### 缓存清除 - 图片删除
- [ ] 删除图片后，控制台显示"🔄 图片删除变化"
- [ ] 标注结果被清空

### 缓存清除 - 图片旋转
- [ ] 旋转图片后，控制台显示"🔄 图片旋转变化"
- [ ] 标注结果被清空

### 缓存清除 - 说明书修改
- [ ] 修改说明书1秒后，控制台显示"🔄 说明书内容变化"
- [ ] 标注结果被清空
- [ ] 快速连续修改时，只在停止输入后清除

### 无缓存恢复
- [ ] 修改输入后刷新，不恢复旧缓存
- [ ] 控制台显示"⚠️ 没有手动保存的缓存"

## 🐛 常见问题

### Q1: 刷新后没有恢复缓存？
**检查**：
1. 控制台是否显示"✅ 发现手动保存的缓存"
2. Local Storage中是否有 `drawing_cache_saved` 标记
3. 是否在修改输入后刷新（会清除缓存）

### Q2: 修改输入后缓存没有清除？
**检查**：
1. 控制台是否显示"🔄 xxx变化"
2. 说明书修改是否等待了1秒（防抖）
3. 浏览器是否支持localStorage

### Q3: 缓存清除太频繁？
**解决**：
- 说明书输入有1秒防抖
- 其他操作立即清除是正常的

## 📊 测试报告模板

```
测试时间：____年__月__日
测试人员：________
浏览器：Chrome / Firefox / Edge / Safari

【缓存保存】
- 处理完成后保存：✅ / ❌
- 控制台日志正确：✅ / ❌
- Local Storage有标记：✅ / ❌

【缓存恢复】
- 页面刷新后恢复：✅ / ❌
- 控制台日志正确：✅ / ❌

【缓存清除 - 图片操作】
- 上传图片清除：✅ / ❌
- 删除图片清除：✅ / ❌
- 旋转图片清除：✅ / ❌

【缓存清除 - 说明书】
- 修改后清除：✅ / ❌
- 防抖工作正常：✅ / ❌

【无缓存恢复】
- 修改后刷新不恢复：✅ / ❌
- 控制台日志正确：✅ / ❌

【问题记录】
1. _______________
2. _______________

【总体评价】
优秀 / 良好 / 一般 / 需改进
```

## 🎯 高级测试

### 测试多次修改
1. 上传图片 → 处理 → 刷新（恢复）
2. 修改图片 → 刷新（不恢复）
3. 重新处理 → 刷新（恢复）
4. 修改说明书 → 刷新（不恢复）

### 测试边界情况
1. 上传多张图片
2. 删除部分图片
3. 旋转不同图片
4. 快速连续操作

### 测试浏览器兼容性
- [ ] Chrome
- [ ] Firefox
- [ ] Edge
- [ ] Safari

## 📝 反馈

如果发现问题，请记录：
1. 操作步骤
2. 预期结果
3. 实际结果
4. 控制台日志
5. Local Storage内容

---

**测试时间**：约10-15分钟  
**难度**：⭐⭐ 中等  
**重要性**：⭐⭐⭐⭐⭐ 非常重要
