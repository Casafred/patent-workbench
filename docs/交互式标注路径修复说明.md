# 交互式标注路径修复说明

## 问题

浏览器控制台报错：
```
指向"https://ipx.asia/js/drawingMarkerInteractive.js"的 <script> 加载失败。
Uncaught ReferenceError: InteractiveDrawingMarker is not defined
```

## 原因

1. **路径错误**：index.html中使用了错误的相对路径
   - 错误：`<script src="js/drawingMarkerInteractive.js"></script>`
   - 正确：`<script src="../js/drawingMarkerInteractive.js?v=20260130"></script>`

2. **文件位置错误**：JS文件放在了错误的目录
   - 错误位置：`frontend/js/drawingMarkerInteractive.js`
   - 正确位置：`js/drawingMarkerInteractive.js`（项目根目录）

## 解决方案

### 已修复的内容

1. ✅ 修正了index.html中的script标签路径
2. ✅ 将JS文件复制到正确的位置（js/目录）
3. ✅ 更新了部署脚本

### 部署步骤

#### 方法1：使用快速部署脚本（推荐）
```batch
快速部署交互式标注.bat
```

输入服务器密码后，文件会自动上传。

#### 方法2：手动上传
```bash
# 上传JS文件到正确位置
scp js/drawingMarkerInteractive.js root@43.99.101.195:/home/appuser/patent-app/js/

# 上传更新后的index.html
scp frontend/index.html root@43.99.101.195:/home/appuser/patent-app/frontend/
```

### 验证步骤

1. 访问：http://43.99.101.195
2. 按 `Ctrl + F5` 强制刷新（清除缓存）
3. 打开浏览器控制台（F12）
4. 进入"功能八：专利附图标记"
5. 上传图片和说明书，点击"开始处理"
6. 检查控制台是否还有错误

### 预期结果

- ✅ 不再有"加载失败"错误
- ✅ 不再有"InteractiveDrawingMarker is not defined"错误
- ✅ 处理完成后显示交互式标注图
- ✅ 可以拖动标注框
- ✅ 可以双击编辑标注

## 文件路径说明

### 项目结构
```
patent-app/
├── js/                          # 根目录JS文件
│   ├── state.js
│   ├── chat.js
│   ├── drawingMarkerInteractive.js  ← 新文件在这里
│   └── ...
├── frontend/
│   ├── index.html               # 使用 ../js/ 引用根目录JS
│   ├── css/
│   └── js/                      # 这个目录不用于存放共享JS
└── backend/
```

### 路径规则

从 `frontend/index.html` 引用JS文件：
- ✅ 正确：`<script src="../js/xxx.js"></script>`（回到上级目录）
- ❌ 错误：`<script src="js/xxx.js"></script>`（会找frontend/js/）
- ❌ 错误：`<script src="/js/xxx.js"></script>`（绝对路径，可能有问题）

## 故障排除

### 问题1：仍然报"加载失败"
**解决**：
1. 检查文件是否上传成功：`ssh root@43.99.101.195 "ls -la /home/appuser/patent-app/js/drawingMarkerInteractive.js"`
2. 检查文件权限：`ssh root@43.99.101.195 "chmod 644 /home/appuser/patent-app/js/drawingMarkerInteractive.js"`
3. 强制刷新浏览器：`Ctrl + F5`

### 问题2：仍然报"is not defined"
**解决**：
1. 确认JS文件已加载：在浏览器控制台Network标签查看
2. 检查JS文件内容是否完整：`ssh root@43.99.101.195 "head -20 /home/appuser/patent-app/js/drawingMarkerInteractive.js"`
3. 清除浏览器缓存并重新加载

### 问题3：图片仍然不显示
**解决**：
1. 检查控制台是否有其他错误
2. 确认API返回了正确的数据
3. 检查Canvas元素是否创建成功

## 测试命令

### 检查文件是否存在
```bash
ssh root@43.99.101.195 "ls -la /home/appuser/patent-app/js/drawingMarkerInteractive.js"
```

### 查看文件前几行
```bash
ssh root@43.99.101.195 "head -30 /home/appuser/patent-app/js/drawingMarkerInteractive.js"
```

### 检查index.html中的引用
```bash
ssh root@43.99.101.195 "grep -n 'drawingMarkerInteractive' /home/appuser/patent-app/frontend/index.html"
```

---

**修复时间**: 2026-01-30 23:15
**状态**: 已修复，等待部署验证
