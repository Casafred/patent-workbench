# ç¬¬ä¸‰è½®é”™è¯¯ä¿®å¤å®Œæˆ - 2026-01-26

## ä¿®å¤çš„é—®é¢˜

### 1. âœ… /patent/version API 405é”™è¯¯

**é”™è¯¯ä¿¡æ¯**:
```
APIè°ƒç”¨ /patent/version å¤±è´¥: Error: <!doctype html><html lang=en><title>405 Method Not Allowed</title>
```

**åŸå› **: 
- `/patent/version` æ˜¯GETç«¯ç‚¹
- `apiCall` å‡½æ•°é»˜è®¤ä½¿ç”¨POSTæ–¹æ³•
- è°ƒç”¨æ—¶æ²¡æœ‰æŒ‡å®šmethodå‚æ•°

**ä¿®å¤**:
```javascript
// ä¿®æ”¹å‰
const versionResponse = await apiCall('/patent/version');

// ä¿®æ”¹å
const versionResponse = await apiCall('/patent/version', null, 'GET');
```

**æ–‡ä»¶**: `js/main.js`

---

### 2. âœ… æ¨¡æ¿ä¸å­˜åœ¨é”™è¯¯ï¼ˆå½»åº•ä¿®å¤ï¼‰

**é”™è¯¯ä¿¡æ¯**:
```
21:53:28.634 æ¨¡æ¿ä¸å­˜åœ¨: undefined patentTemplate.js:222:17
```

**åŸå› **: 
- `initTemplates()` è°ƒç”¨ `loadTemplate()` æ—¶æ²¡æœ‰ä¼ å‚æ•°
- æ­¤æ—¶æ¨¡æ¿é€‰æ‹©å™¨è¿˜æ²¡æœ‰å€¼
- `loadTemplate()` å°è¯•ä»undefinedçš„é€‰æ‹©å™¨è·å–å€¼

**ä¿®å¤**:
```javascript
// ä¿®æ”¹å‰
function initTemplates() {
    appState.generator.customTemplates = JSON.parse(localStorage.getItem('custom_templates') || '[]');
    updateTemplateSelector();
    loadTemplate();  // âŒ æ²¡æœ‰å‚æ•°
}

// ä¿®æ”¹å
function initTemplates() {
    appState.generator.customTemplates = JSON.parse(localStorage.getItem('custom_templates') || '[]');
    updateTemplateSelector();
    // åŠ è½½é»˜è®¤æ¨¡æ¿ï¼ˆç¬¬ä¸€ä¸ªé¢„è®¾æ¨¡æ¿ï¼‰
    if (appState.generator.presetTemplates.length > 0) {
        loadTemplate(appState.generator.presetTemplates[0].name);  // âœ… ä¼ å…¥é»˜è®¤æ¨¡æ¿åç§°
    }
}
```

**æ–‡ä»¶**: `js/largeBatch.js`

---

### 3. âœ… é—®ä¸€é—®å¯¹è¯æ¡†æ”¯æŒMarkdownæ¸²æŸ“

**éœ€æ±‚**: 
- AIè¿”å›çš„å†…å®¹åŒ…å«Markdownæ ¼å¼ï¼ˆå¦‚ `**ç²—ä½“**`ï¼‰
- éœ€è¦æ¸²æŸ“æˆHTMLæ ·å¼ï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºåŸå§‹ç¬¦å·

**å®ç°**:
ä½¿ç”¨å·²å¼•å…¥çš„ `marked.js` åº“æ¸²æŸ“Markdown

```javascript
// æ–°çš„formatMessageContentå‡½æ•°
function formatMessageContent(content) {
    // æ£€æŸ¥æ˜¯å¦æœ‰markedåº“
    if (typeof marked !== 'undefined') {
        try {
            // é…ç½®markedé€‰é¡¹
            marked.setOptions({
                breaks: true,  // æ”¯æŒGFMæ¢è¡Œ
                gfm: true,     // å¯ç”¨GitHubé£æ ¼çš„Markdown
                headerIds: false,
                mangle: false
            });
            
            // ä½¿ç”¨markedæ¸²æŸ“Markdown
            return marked.parse(content);
        } catch (e) {
            console.error('Markdownæ¸²æŸ“å¤±è´¥:', e);
            return simpleFormatContent(content);
        }
    } else {
        return simpleFormatContent(content);
    }
}

// ç®€å•æ ¼å¼åŒ–ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰
function simpleFormatContent(content) {
    let formatted = content.replace(/</g, '&lt;').replace(/>/g, '&gt;');
    formatted = formatted.replace(/\n/g, '<br>');
    formatted = formatted.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
    formatted = formatted.replace(/\*(.+?)\*/g, '<em>$1</em>');
    // ... æ›´å¤šæ ¼å¼åŒ–
    return formatted;
}
```

**æ”¯æŒçš„Markdownè¯­æ³•**:
- âœ… **ç²—ä½“** (`**text**`)
- âœ… *æ–œä½“* (`*text*`)
- âœ… æ ‡é¢˜ (`# H1`, `## H2`, etc.)
- âœ… åˆ—è¡¨ (`- item`, `1. item`)
- âœ… ä»£ç å— (` ```code``` `)
- âœ… è¡Œå†…ä»£ç  (`` `code` ``)
- âœ… é“¾æ¥ (`[text](url)`)
- âœ… å¼•ç”¨ (`> quote`)
- âœ… æ¢è¡Œï¼ˆGFMé£æ ¼ï¼‰

**æ–‡ä»¶**: `js/patentChat.js`

---

## ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | è¡Œæ•° |
|------|---------|------|
| `js/main.js` | ä¿®å¤/patent/version APIè°ƒç”¨ | 1å¤„ |
| `js/largeBatch.js` | ä¿®å¤æ¨¡æ¿åˆå§‹åŒ– | 1å¤„ |
| `js/patentChat.js` | æ·»åŠ Markdownæ¸²æŸ“æ”¯æŒ | 40+è¡Œ |

---

## æµ‹è¯•éªŒè¯

### æµ‹è¯•1ï¼š/patent/version API
```javascript
// åœ¨æ§åˆ¶å°æµ‹è¯•
apiCall('/patent/version', null, 'GET').then(console.log);
// åº”è¯¥è¿”å›ç‰ˆæœ¬ä¿¡æ¯ï¼Œä¸å†æŠ¥405é”™è¯¯
```

### æµ‹è¯•2ï¼šæ¨¡æ¿åŠ è½½
1. åˆ·æ–°é¡µé¢
2. è¿›å…¥"å¤§æ‰¹é‡å¤„ç†"æ ‡ç­¾é¡µ
3. æ£€æŸ¥æ§åˆ¶å°æ— "æ¨¡æ¿ä¸å­˜åœ¨"é”™è¯¯
4. æ¨¡æ¿é€‰æ‹©å™¨åº”è¯¥æœ‰é»˜è®¤å€¼

### æµ‹è¯•3ï¼šMarkdownæ¸²æŸ“
1. åœ¨åŠŸèƒ½å…­ä¸­æŸ¥è¯¢ä¸€ä¸ªä¸“åˆ©
2. ç‚¹å‡»"é—®ä¸€é—®"æŒ‰é’®
3. æé—®ï¼š"è¯·ç”¨Markdownæ ¼å¼æ€»ç»“è¿™ä¸ªä¸“åˆ©çš„**æ ¸å¿ƒåˆ›æ–°ç‚¹**"
4. AIå›ç­”åº”è¯¥æ­£ç¡®æ¸²æŸ“Markdownæ ¼å¼ï¼š
   - **ç²—ä½“**æ˜¾ç¤ºä¸ºç²—ä½“
   - *æ–œä½“*æ˜¾ç¤ºä¸ºæ–œä½“
   - åˆ—è¡¨æ­£ç¡®ç¼©è¿›
   - ä»£ç å—æœ‰èƒŒæ™¯è‰²

---

## éƒ¨ç½²æ­¥éª¤

### 1. æ¨é€ä»£ç 
```bash
git add js/main.js js/largeBatch.js js/patentChat.js
git add ç¬¬ä¸‰è½®é”™è¯¯ä¿®å¤å®Œæˆ.md
git commit -m "ç¬¬ä¸‰è½®é”™è¯¯ä¿®å¤ï¼šAPIæ–¹æ³•ã€æ¨¡æ¿åˆå§‹åŒ–ã€Markdownæ¸²æŸ“"
git push origin main
```

### 2. éƒ¨ç½²åˆ°é˜¿é‡Œäº‘
```bash
.\é˜¿é‡Œäº‘æ‹‰å–ç§»åŠ¨ç«¯æ›´æ–°.bat
```

### 3. æ¸…é™¤ç¼“å­˜
```
Ctrl + Shift + Delete â†’ æ¸…é™¤ç¼“å­˜ â†’ Ctrl + F5
```

### 4. éªŒè¯ä¿®å¤
- [ ] æ§åˆ¶å°æ— 405é”™è¯¯
- [ ] æ§åˆ¶å°æ— "æ¨¡æ¿ä¸å­˜åœ¨"é”™è¯¯
- [ ] é—®ä¸€é—®å¯¹è¯æ¡†æ­£ç¡®æ¸²æŸ“Markdown

---

## Markdownæ¸²æŸ“ç¤ºä¾‹

### è¾“å…¥ï¼ˆAIè¿”å›ï¼‰:
```markdown
è¿™ä¸ªä¸“åˆ©çš„**æ ¸å¿ƒåˆ›æ–°ç‚¹**åŒ…æ‹¬ï¼š

1. **æŠ€æœ¯æ–¹æ¡ˆ**ï¼šé‡‡ç”¨äº†æ–°å‹çš„ç®—æ³•
2. *åº”ç”¨åœºæ™¯*ï¼šé€‚ç”¨äºç§»åŠ¨è®¾å¤‡
3. `ä»£ç å®ç°`ï¼šä½¿ç”¨Pythonè¯­è¨€

> è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨ç¤ºä¾‹

è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ[å®˜æ–¹æ–‡æ¡£](https://example.com)
```

### è¾“å‡ºï¼ˆæ¸²æŸ“åï¼‰:
è¿™ä¸ªä¸“åˆ©çš„**æ ¸å¿ƒåˆ›æ–°ç‚¹**åŒ…æ‹¬ï¼š

1. **æŠ€æœ¯æ–¹æ¡ˆ**ï¼šé‡‡ç”¨äº†æ–°å‹çš„ç®—æ³•
2. *åº”ç”¨åœºæ™¯*ï¼šé€‚ç”¨äºç§»åŠ¨è®¾å¤‡
3. `ä»£ç å®ç°`ï¼šä½¿ç”¨Pythonè¯­è¨€

> è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨ç¤ºä¾‹

è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ[å®˜æ–¹æ–‡æ¡£](https://example.com)

---

## æŠ€æœ¯ç»†èŠ‚

### marked.jsé…ç½®
```javascript
marked.setOptions({
    breaks: true,      // å•ä¸ªæ¢è¡Œç¬¦è½¬æ¢ä¸º<br>
    gfm: true,         // å¯ç”¨GitHubé£æ ¼Markdown
    headerIds: false,  // ç¦ç”¨æ ‡é¢˜IDï¼ˆé¿å…å†²çªï¼‰
    mangle: false      // ç¦ç”¨é‚®ç®±æ··æ·†
});
```

### é”™è¯¯å¤„ç†
- å¦‚æœmarked.jsåŠ è½½å¤±è´¥ï¼Œè‡ªåŠ¨é™çº§åˆ°ç®€å•æ ¼å¼åŒ–
- å¦‚æœMarkdownè§£æå¤±è´¥ï¼Œæ•è·é”™è¯¯å¹¶ä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ
- ç¡®ä¿åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½èƒ½æ­£å¸¸æ˜¾ç¤ºå†…å®¹

---

## ç›¸å…³æ–‡æ¡£

- [æ§åˆ¶å°é”™è¯¯ä¿®å¤å®Œæˆ.md](æ§åˆ¶å°é”™è¯¯ä¿®å¤å®Œæˆ.md) - ç¬¬ä¸€è½®ä¿®å¤
- [æ§åˆ¶å°é”™è¯¯åˆ†æå’Œä¿®å¤_ç¬¬äºŒè½®.md](æ§åˆ¶å°é”™è¯¯åˆ†æå’Œä¿®å¤_ç¬¬äºŒè½®.md) - ç¬¬äºŒè½®ä¿®å¤
- [æ¸…é™¤ç¼“å­˜å®Œå…¨æŒ‡å—.md](æ¸…é™¤ç¼“å­˜å®Œå…¨æŒ‡å—.md) - ç¼“å­˜æ¸…é™¤æŒ‡å—

---

**ä¿®å¤æ—¶é—´**: 2026-01-26 22:00  
**ä¿®å¤æ–‡ä»¶**: 3ä¸ª  
**æ–°å¢åŠŸèƒ½**: Markdownæ¸²æŸ“æ”¯æŒ  
**æµ‹è¯•çŠ¶æ€**: ğŸŸ¡ å¾…æµ‹è¯•
