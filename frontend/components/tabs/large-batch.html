<!-- 功能三：大批量处理 (UI重构) -->
        <div id="large_batch-tab" class="tab-content">
            <div class="progress-stepper" id="large-batch-stepper">
                <div class="step-item active" onclick="switchSubTab('generator', this)">
                    <div class="step-number">1</div>
                    <div class="step-title">生成请求文件</div>
                </div>
                <div class="step-item" onclick="switchSubTab('batch', this)">
                    <div class="step-number">2</div>
                    <div class="step-title">执行批处理</div>
                </div>
                <div class="step-item" onclick="switchSubTab('reporter', this)">
                    <div class="step-number">3</div>
                    <div class="step-title">解析报告</div>
                </div>
                <div class="progress-bar"></div>
            </div>
            
            <div id="sub-tab-generator" class="sub-tab-content">
                 <div class="step">
                    <div class="step-header">步骤 1: 上传专利数据 Excel 并配置分析列</div>
                    <input type="file" id="gen_file-input" accept=".xlsx, .xls">
                    <select id="gen_sheet-selector" style="display:none; margin-left: 10px;"></select>
                    <div id="column-config-container" style="display:none; margin-top: 20px;">
                        <div class="config-item row-flex">
                            <label for="column-count">分析列数量:</label>
                            <input type="number" id="column-count" value="2" min="1" max="10" style="width: 100px;">
                        </div>
                        <div id="column-config-area"></div>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-header">步骤 2: 配置 API 请求参数</div>
                    <div class="template-config-grid">
                        <div class="template-config-main">
                            <div class="model-temp-group">
                                <div class="config-item">
                                    <label for="api-model">选择模型:</label>
                                    <select id="api-model"></select>
                                </div>
                                <div class="config-item">
                                    <label for="api-temperature">温度:</label>
                                    <input type="number" id="api-temperature" value="0.1" step="0.1" min="0" max="1">
                                </div>
                            </div>
                        </div>
                        <div class="template-config-prompts">
                            <div class="config-item">
                                <label for="api-system-prompt">系统提示 (System Prompt):</label>
                                <textarea id="api-system-prompt" rows="3">你是一个高效的专利文本分析助手。</textarea>
                            </div>
                        </div>
                    </div>
                    <hr style="margin: 25px 0 20px; border-color: var(--border-color);">
                    <div class="config-item">
                        <label>用户提示 (User Prompt):</label>
                        <div class="user-prompt-container">
                            <div class="prompt-ab-grid">
                                <div class="prompt-section">
                                    <div class="prompt-section-title">A. 规则要求</div>
                                    <textarea id="prompt-rules" rows="3" placeholder="请在此处输入任务的核心指令、要求和背景信息。"></textarea>
                                </div>
                                <div class="prompt-section">
                                    <div class="prompt-section-title">B. 内容插入 (自动生成)</div>
                                    <div id="content-insertion-preview" class="preview-output">待上传Excel并配置分析列后自动显示...</div>
                                </div>
                            </div>
                            <div class="prompt-section">
                                <div class="prompt-section-title">C. 输出格式 (JSON)</div>
                                <div id="output-fields-container"></div>
                                <button id="add-output-field-btn" class="small-button" type="button">添加输出字段</button>
                                <div class="info" style="margin-top: 10px;">系统将自动把此处的字段包装成JSON格式要求。</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="step">
                    <div class="step-header">步骤 3: 生成并预览 JSONL 请求文件</div>
                    <button id="gen_generate-btn" disabled>生成 JSONL 文件</button>
                    <div class="preview-output" id="gen_preview_output" style="display:none;"></div>
                    <button id="gen_download-btn" style="display:none; margin-top: 15px;">下载 JSONL 文件</button>
                    <div class="info success" id="gen_ready_info" style="display:none;">文件已在内存中准备就绪，请切换到【2. 执行批处理】进行上传。</div>
                </div>
            </div>

            <!-- ▼▼▼ BUG 4 修复确认: 以下内容必须存在，否则页面会为空 ▼▼▼ -->
            <div id="sub-tab-batch" class="sub-tab-content">
                 <div class="step">
                    <div class="step-header">批量任务工作流</div>
                    <p>请按照1-4的顺序执行。点击步骤2后将启动自动状态检查。</p>
                    <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 15px; justify-content: center;">
                        <button id="batch_step1_upload" class="action-button">1. 上传请求文件</button>
                        <button id="batch_step2_create" class="action-button" disabled>2. 创建Batch任务</button>
                        <button id="batch_step3_download" class="action-button" disabled>3. 获取结果内容</button>
                    </div>
                    <div id="batch_id_reminder" class="info" style="display: none; margin-top: 20px; text-align: center;"></div>

                    <div id="auto-check-container" style="display:none; margin-top: 20px; text-align: center;">
                        <span id="auto_check_status" style="margin-right: 15px; color: var(--primary-color-dark); font-weight: bold;"></span>
                        <button id="batch_stop_check_btn" class="small-button" style="background: var(--warning-color); color: #fff;">停止自动检查</button>
                    </div>
                </div>
                
                <details open>
                    <summary>断点续查 / 任务恢复</summary>
                    <div class="step" style="border-top: none; margin-top: 0;">
                        <p class="info warning">如果您因关闭浏览器等原因中断了流程，但已记录下 Batch ID，可在此恢复任务状态。</p>
                        <div class="config-item row-flex">
                            <label for="recover_batch_id_input">Batch ID:</label>
                            <input type="text" id="recover_batch_id_input" placeholder="粘贴您记录的 Batch ID">
                        </div>
                        <button id="recover_state_btn">恢复查询状态</button>
                    </div>
                </details>

                <div class="step">
                    <div class="step-header">执行日志</div>
                    <div style="display: flex; justify-content: flex-end; margin-bottom: 10px;">
                        <button id="batch_step3_check" class="small-button">手动检查状态</button>
                    </div>
                    <div id="batch_log" class="preview-output">等待操作...</div>
                </div>
            </div>

            <div id="sub-tab-reporter" class="sub-tab-content">
                <div class="step">
                    <div class="step-header">步骤 1: 准备数据源</div>
                    <div class="reporter-uploads">
                        <div>
                            <p><strong>A. 上传原始 Excel 文件</strong> (用于数据匹配)</p>
                            <input type="file" id="rep_excel-input" accept=".xlsx, .xls">
                            <select id="rep_sheet-selector" style="display:none; margin-top: 10px;"></select>
                        </div>
                        <div style="margin-top:20px;">
                            <p><strong>B. 加载 Batch 任务结果文件</strong></p>
                            <input type="file" id="rep_jsonl-input" accept=".jsonl">
                            <div class="info success" id="reporter-info-box" style="display:none;">
                                检测到来自【2. 执行批处理】的结果文件已在内存中，将优先使用此数据。
                            </div>
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-header">步骤 2: 解析并生成最终报告</div>
                    <button id="rep_generate-report-btn" disabled>解析并生成最终报告</button>
                    <div class="preview-output" id="rep_output_preview" style="display:none;"></div>
                    <button id="rep_download-report-btn" style="display:none; margin-top: 15px;">下载最终报告 (Excel)</button>
                </div>
            </div>
            <!-- ▲▲▲ BUG 4 修复确认: 内容结束 ▲▲▲ -->
        </div>
