# 阿里云回滚 - 准确命令

## 项目路径确认
- 项目位置：`/home/appuser/patent-app`
- 用户：`appuser`
- Python环境：Python 3.11 (venv311)

## 立即回滚命令

### 方法1：切换到 appuser 用户后回滚

```bash
# 当前你是 root 用户，需要切换到 appuser
su - appuser

# 进入项目目录
cd ~/patent-app

# 查看当前状态和最近的提交
git status
git log --oneline -10

# 回滚到上一个版本
git reset --hard HEAD~1

# 激活 Python 3.11 虚拟环境
source venv311/bin/activate

# 重启服务（根据你的启动方式）
# 如果是 systemd 服务：
sudo systemctl restart patent_system

# 如果是手动运行的进程，先找到并杀掉
ps aux | grep "python.*app.py"
# 然后重新启动（根据你的启动脚本）
```

### 方法2：root 用户直接操作（推荐）

```bash
# 作为 root 用户，直接在 appuser 的项目目录操作
cd /home/appuser/patent-app

# 查看 Git 状态
git status
git log --oneline -10

# 回滚到上一个版本
git reset --hard HEAD~1

# 修改文件所有权（确保 appuser 可以访问）
chown -R appuser:appuser /home/appuser/patent-app

# 重启服务
systemctl restart patent_system
# 或者
systemctl status patent_system
```

## 一键回滚命令（复制粘贴即可）

```bash
cd /home/appuser/patent-app && git reset --hard HEAD~1 && chown -R appuser:appuser /home/appuser/patent-app && systemctl restart patent_system
```

## 查看回滚后的状态

```bash
# 查看当前 commit
cd /home/appuser/patent-app && git log -1

# 查看服务状态
systemctl status patent_system

# 查看服务日志
journalctl -u patent_system -n 50 -f
```

## 如果需要回滚到更早的版本

```bash
# 1. 查看提交历史
cd /home/appuser/patent-app
git log --oneline -20

# 2. 找到你想回滚到的 commit hash（例如：abc1234）

# 3. 回滚到指定版本
git reset --hard abc1234

# 4. 修改所有权
chown -R appuser:appuser /home/appuser/patent-app

# 5. 重启服务
systemctl restart patent_system
```

## 如果回滚错了，想恢复

```bash
# 1. 查看所有操作历史
cd /home/appuser/patent-app
git reflog

# 2. 找到回滚前的 commit（例如：def5678）

# 3. 恢复到回滚前的状态
git reset --hard def5678

# 4. 重启服务
systemctl restart patent_system
```

## 注意事项

1. **当前你是 root 用户**，可以直接操作 `/home/appuser/patent-app`
2. **回滚后记得修改文件所有权**：`chown -R appuser:appuser /home/appuser/patent-app`
3. **Python 3.11 环境**：项目使用 `venv311` 虚拟环境
4. **服务名称**：假设是 `patent_system`，如果不是请用 `systemctl list-units | grep patent` 查找

## 快速验证

```bash
# 验证回滚是否成功
cd /home/appuser/patent-app
git log -1
systemctl status patent_system
curl http://localhost:5000
```
