<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠŸèƒ½å…«å›¾ç‰‡ä¸Šä¼ æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        .upload-area {
            border: 2px dashed #28a745;
            border-radius: 6px;
            padding: 30px;
            text-align: center;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        .upload-area:hover {
            background-color: #f0f8f0;
            border-color: #20c997;
        }
        .status {
            margin-top: 15px;
            padding: 10px;
            background-color: #e3f2fd;
            border-radius: 4px;
            font-weight: bold;
        }
        .image-list {
            margin-top: 15px;
        }
        .image-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
            margin-bottom: 8px;
        }
        .image-item img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ åŠŸèƒ½å…«å›¾ç‰‡ä¸Šä¼ é—®é¢˜è¯Šæ–­</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯•1ï¼šåŸºç¡€æ–‡ä»¶è¾“å…¥</h2>
        <input type="file" id="basicInput" accept="image/*" multiple>
        <div class="status" id="status1">ç­‰å¾…é€‰æ‹©æ–‡ä»¶...</div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯•2ï¼šéšè—è¾“å…¥+ç‚¹å‡»è§¦å‘</h2>
        <input type="file" id="hiddenInput" accept="image/*" multiple style="display: none;">
        <div class="upload-area" id="clickArea">
            <p>ç‚¹å‡»æ­¤å¤„ä¸Šä¼ å›¾ç‰‡</p>
        </div>
        <div class="status" id="status2">ç­‰å¾…ç‚¹å‡»...</div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯•3ï¼šæ¨¡æ‹Ÿä¸»ç•Œé¢ç»“æ„</h2>
        <input type="file" id="drawing_upload_input" accept="image/*" multiple style="display: none;">
        <div id="drawing_paste_area" class="upload-area">
            <p>ç‚¹å‡»æˆ–ç²˜è´´å›¾ç‰‡</p>
        </div>
        <div class="status" id="status3">ç­‰å¾…æ“ä½œ...</div>
        <div id="uploaded_drawings_list" class="image-list"></div>
    </div>

    <script>
        // æµ‹è¯•1ï¼šåŸºç¡€æ–‡ä»¶è¾“å…¥
        document.getElementById('basicInput').addEventListener('change', function(e) {
            const files = e.target.files;
            document.getElementById('status1').textContent = `âœ… é€‰æ‹©äº† ${files.length} ä¸ªæ–‡ä»¶`;
            console.log('æµ‹è¯•1æˆåŠŸ:', files);
        });

        // æµ‹è¯•2ï¼šéšè—è¾“å…¥+ç‚¹å‡»è§¦å‘
        const hiddenInput = document.getElementById('hiddenInput');
        const clickArea = document.getElementById('clickArea');
        
        clickArea.addEventListener('click', function() {
            console.log('ç‚¹å‡»åŒºåŸŸè¢«ç‚¹å‡»');
            document.getElementById('status2').textContent = 'ğŸ”„ è§¦å‘æ–‡ä»¶é€‰æ‹©...';
            hiddenInput.click();
        });
        
        hiddenInput.addEventListener('change', function(e) {
            const files = e.target.files;
            document.getElementById('status2').textContent = `âœ… é€‰æ‹©äº† ${files.length} ä¸ªæ–‡ä»¶`;
            console.log('æµ‹è¯•2æˆåŠŸ:', files);
        });

        // æµ‹è¯•3ï¼šæ¨¡æ‹Ÿä¸»ç•Œé¢
        let uploadedDrawings = [];
        
        function initDrawingMarker() {
            console.log('ğŸš€ å¼€å§‹åˆå§‹åŒ–...');
            
            const drawingUploadInput = document.getElementById('drawing_upload_input');
            const drawingPasteArea = document.getElementById('drawing_paste_area');
            
            console.log('drawingUploadInput:', drawingUploadInput);
            console.log('drawingPasteArea:', drawingPasteArea);
            
            if (!drawingUploadInput) {
                console.error('âŒ æ‰¾ä¸åˆ° drawing_upload_input');
                document.getElementById('status3').textContent = 'âŒ æ‰¾ä¸åˆ°ä¸Šä¼ è¾“å…¥æ¡†';
                return;
            }
            
            if (!drawingPasteArea) {
                console.error('âŒ æ‰¾ä¸åˆ° drawing_paste_area');
                document.getElementById('status3').textContent = 'âŒ æ‰¾ä¸åˆ°ç²˜è´´åŒºåŸŸ';
                return;
            }
            
            // ç»‘å®šchangeäº‹ä»¶
            drawingUploadInput.addEventListener('change', function(e) {
                console.log('âœ… changeäº‹ä»¶è§¦å‘');
                handleDrawingUpload(e);
            });
            
            // ç»‘å®šclickäº‹ä»¶
            drawingPasteArea.addEventListener('click', function() {
                console.log('âœ… ç²˜è´´åŒºåŸŸè¢«ç‚¹å‡»');
                document.getElementById('status3').textContent = 'ğŸ”„ è§¦å‘æ–‡ä»¶é€‰æ‹©...';
                drawingUploadInput.click();
            });
            
            // ç»‘å®špasteäº‹ä»¶
            drawingPasteArea.addEventListener('paste', function(e) {
                console.log('âœ… pasteäº‹ä»¶è§¦å‘');
                handleDrawingPaste(e);
            });
            
            console.log('âœ… åˆå§‹åŒ–å®Œæˆ');
            document.getElementById('status3').textContent = 'âœ… åˆå§‹åŒ–å®Œæˆï¼Œå¯ä»¥ç‚¹å‡»ä¸Šä¼ ';
        }
        
        function handleDrawingUpload(event) {
            console.log('handleDrawingUpload è¢«è°ƒç”¨');
            const files = event.target.files;
            if (files.length === 0) return;
            
            document.getElementById('status3').textContent = `âœ… é€‰æ‹©äº† ${files.length} ä¸ªæ–‡ä»¶`;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (file.type.startsWith('image/')) {
                    processImageFile(file);
                }
            }
            
            event.target.value = '';
        }
        
        function handleDrawingPaste(event) {
            console.log('handleDrawingPaste è¢«è°ƒç”¨');
            const items = event.clipboardData.items;
            if (!items) return;
            
            for (let i = 0; i < items.length; i++) {
                if (items[i].type.startsWith('image/')) {
                    const file = items[i].getAsFile();
                    processImageFile(file);
                    break;
                }
            }
        }
        
        function processImageFile(file) {
            console.log('å¤„ç†å›¾ç‰‡æ–‡ä»¶:', file.name);
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageData = {
                    id: Date.now() + Math.random(),
                    name: file.name,
                    dataUrl: e.target.result
                };
                
                uploadedDrawings.push(imageData);
                updateUploadedDrawingsList();
            };
            reader.readAsDataURL(file);
        }
        
        function updateUploadedDrawingsList() {
            const listContainer = document.getElementById('uploaded_drawings_list');
            if (!listContainer) return;
            
            if (uploadedDrawings.length === 0) {
                listContainer.innerHTML = '<div style="color: #999; text-align: center;">æš‚æ— å›¾ç‰‡</div>';
                return;
            }
            
            let html = '';
            uploadedDrawings.forEach((drawing, index) => {
                html += `
                    <div class="image-item">
                        <img src="${drawing.dataUrl}" alt="${drawing.name}">
                        <div style="flex: 1;">
                            <div>${drawing.name}</div>
                        </div>
                        <button onclick="removeDrawing(${index})">åˆ é™¤</button>
                    </div>
                `;
            });
            
            listContainer.innerHTML = html;
            document.getElementById('status3').textContent = `âœ… å·²ä¸Šä¼  ${uploadedDrawings.length} å¼ å›¾ç‰‡`;
        }
        
        function removeDrawing(index) {
            uploadedDrawings.splice(index, 1);
            updateUploadedDrawingsList();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initDrawingMarker);
        } else {
            initDrawingMarker();
        }
    </script>
</body>
</html>
