# 阿里云后端日志查看指南

## 方法一：使用SSH查看实时日志（推荐）

### 1. SSH连接到阿里云服务器

```bash
ssh root@你的服务器IP
# 或者使用阿里云控制台的"远程连接"功能
```

### 2. 找到Flask应用进程

```bash
# 查找Python进程
ps aux | grep python

# 或者查找Flask进程
ps aux | grep flask

# 或者查找gunicorn进程（如果使用gunicorn部署）
ps aux | grep gunicorn
```

### 3. 查看实时日志

#### 如果使用systemd服务：
```bash
# 查看服务状态
sudo systemctl status your-app-name

# 查看实时日志
sudo journalctl -u your-app-name -f

# 查看最近100行日志
sudo journalctl -u your-app-name -n 100
```

#### 如果使用nohup或screen运行：
```bash
# 查找日志文件位置
find /home -name "*.log" 2>/dev/null
find /var/log -name "*flask*" 2>/dev/null

# 查看日志文件
tail -f /path/to/your/app.log

# 或者查看nohup.out
tail -f ~/nohup.out
```

#### 如果使用gunicorn：
```bash
# 查看gunicorn日志
tail -f /var/log/gunicorn/access.log
tail -f /var/log/gunicorn/error.log
```

### 4. 测试功能八并查看日志

在另一个终端或窗口：
1. 打开网站，进入功能八
2. 上传图片和说明书
3. 点击"开始处理"
4. 回到SSH终端查看实时日志输出

应该能看到类似这样的日志：
```
[DEBUG] Extracted reference_map: {'1': '底座', '2': '旋转臂'}
[DEBUG] Processing drawing: test.png
[DEBUG] Image size: (800, 600)
[DEBUG] Running OCR with method: grayscale
[DEBUG] OCR detected: '1' (confidence: 95)
```

## 方法二：查看应用目录中的日志文件

### 1. 进入应用目录

```bash
cd /path/to/your/app
# 通常是 /home/your-username/patent-workbench
```

### 2. 查找日志文件

```bash
# 列出所有日志文件
ls -lh *.log

# 查看最新的日志
tail -100 app.log
# 或
tail -100 flask.log
# 或
tail -100 error.log
```

### 3. 实时监控日志

```bash
tail -f app.log
```

## 方法三：使用阿里云控制台

### 1. 登录阿里云控制台

访问：https://ecs.console.aliyun.com/

### 2. 找到你的ECS实例

点击"实例" → 找到你的服务器

### 3. 远程连接

点击"远程连接" → 选择"VNC远程连接"或"Workbench"

### 4. 执行上述命令查看日志

## 方法四：检查Python print输出

如果Flask应用是直接运行的（不是后台服务），日志会输出到终端。

### 1. 找到运行Flask的终端/screen会话

```bash
# 列出所有screen会话
screen -ls

# 连接到screen会话
screen -r session_name
```

### 2. 查看输出

直接在终端中就能看到print输出的日志。

## 快速诊断脚本

创建一个诊断脚本来快速检查：

```bash
# 在服务器上创建文件
nano check_ocr.sh
```

粘贴以下内容：

```bash
#!/bin/bash

echo "=== 检查Tesseract安装 ==="
tesseract --version

echo ""
echo "=== 检查Python环境 ==="
python3 --version
pip3 list | grep pytesseract
pip3 list | grep opencv

echo ""
echo "=== 检查Flask进程 ==="
ps aux | grep python | grep -v grep

echo ""
echo "=== 查看最近的日志 ==="
if [ -f "app.log" ]; then
    echo "--- app.log 最后20行 ---"
    tail -20 app.log
fi

if [ -f "nohup.out" ]; then
    echo "--- nohup.out 最后20行 ---"
    tail -20 nohup.out
fi

echo ""
echo "=== 检查端口占用 ==="
netstat -tlnp | grep :5000
```

保存后运行：

```bash
chmod +x check_ocr.sh
./check_ocr.sh
```

## 常见日志位置

根据不同的部署方式，日志可能在：

1. **直接运行Flask**：
   - 终端输出
   - `nohup.out`（如果使用nohup）

2. **使用systemd**：
   - `journalctl -u service-name`
   - `/var/log/syslog`

3. **使用gunicorn**：
   - `/var/log/gunicorn/error.log`
   - `/var/log/gunicorn/access.log`

4. **使用nginx**：
   - `/var/log/nginx/error.log`
   - `/var/log/nginx/access.log`

5. **应用自定义日志**：
   - `~/patent-workbench/app.log`
   - `~/patent-workbench/flask.log`

## 如果找不到日志

### 临时启用详细日志

1. SSH到服务器
2. 停止当前Flask应用
3. 手动启动并查看输出：

```bash
cd /path/to/your/app
python3 run_app.py
```

这样所有print输出都会直接显示在终端。

### 或者修改Flask配置启用日志

在`run_app.py`或`app.py`中添加：

```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

## 需要提供的信息

请把以下信息发给我：

1. **Tesseract版本**：
   ```bash
   tesseract --version
   ```

2. **Python库版本**：
   ```bash
   pip3 list | grep -E "pytesseract|opencv|Pillow"
   ```

3. **功能八处理时的日志**（最重要）：
   - 使用功能八上传图片后
   - 复制后端输出的所有`[DEBUG]`和`[ERROR]`日志

4. **Flask进程信息**：
   ```bash
   ps aux | grep python
   ```

有了这些信息，我就能准确诊断问题了！
