# 功能六更新部署说明

## 更新时间
2026-01-24

## 更新内容

### 1. 附图爬取优化 🖼️
- ✅ 三层提取策略（figure标签 → description区域 → 全局扫描）
- ✅ 图片尺寸过滤（过滤小图标）
- ✅ 图片加载失败处理
- ✅ 点击查看原图功能

### 2. 字段快速复制功能 📋
- ✅ 每个字段旁边添加独立复制按钮
- ✅ 支持复制：摘要、发明人、受让人、日期、链接、权利要求、附图、说明书
- ✅ 复制成功后显示✓确认

### 3. 进阶信息提取 📊
- ✅ Patent Citations（引用专利）- 表格显示
- ✅ Cited By（被引用专利）- 表格显示
- ✅ Legal Events（法律事件）- 表格显示
- ⚠️ 需勾选"获取说明书字段"才会提取

## 部署步骤

### 方法1：使用批处理脚本（推荐）
```bash
# 双击运行
update_aliyun_now.bat
```

### 方法2：手动SSH命令
```bash
ssh root@43.99.101.195
# 输入密码后执行：
su - appuser -c "cd ~/patent-app && git pull origin main"
systemctl restart patent-app
systemctl status patent-app
```

### 方法3：使用PowerShell
```powershell
ssh root@43.99.101.195 "su - appuser -c 'cd ~/patent-app && git pull origin main' && systemctl restart patent-app"
```

## 测试步骤

### 1. 测试附图显示
```
1. 访问 http://43.99.101.195
2. 登录系统
3. 进入"功能六：批量专利解读"
4. 输入专利号：US10000000B2
5. 点击"批量查询专利"
6. 检查是否显示附图
```

### 2. 测试字段复制
```
1. 在查询结果中找到任意字段
2. 点击字段旁边的📋按钮
3. 粘贴到文本编辑器验证
4. 按钮应显示✓确认
```

### 3. 测试进阶信息
```
1. 勾选"获取说明书字段"
2. 输入专利号：US10000000B2
3. 点击"批量查询专利"
4. 向下滚动查看：
   - 📚 引用专利（绿色区域）
   - 🔗 被引用专利（橙色区域）
   - ⚖️ 法律事件（紫色区域）
```

## 注意事项

### 1. 进阶信息提取条件
⚠️ **必须勾选"获取说明书字段"才会提取进阶信息**

### 2. 附图提取成功率
- 依赖Google Patents的HTML结构
- 如果页面结构变化可能提取失败
- 已添加详细日志便于调试

### 3. 数据限制
- 引用专利：最多20条
- 被引用专利：最多20条
- 法律事件：最多20条

## 故障排查

### 问题1：附图不显示
**可能原因**：
- Google Patents页面结构变化
- 网络问题导致图片加载失败
- 专利本身没有附图

**解决方案**：
- 查看浏览器控制台错误
- 检查服务器日志：`tail -f /home/appuser/patent-app/logs/error.log`
- 尝试其他专利号

### 问题2：进阶信息不显示
**可能原因**：
- 未勾选"获取说明书字段"
- 专利本身没有这些信息
- HTML选择器匹配失败

**解决方案**：
- 确认已勾选"获取说明书字段"
- 尝试其他专利号
- 查看服务器日志

### 问题3：复制按钮不工作
**可能原因**：
- 浏览器不支持Clipboard API
- 浏览器权限问题

**解决方案**：
- 使用现代浏览器（Chrome 63+, Firefox 53+）
- 检查浏览器权限设置
- 使用"复制信息"按钮作为备选

## 服务器命令参考

### 查看服务状态
```bash
systemctl status patent-app
```

### 查看日志
```bash
# 实时日志
tail -f /home/appuser/patent-app/logs/error.log

# 最近50行
journalctl -u patent-app -n 50
```

### 重启服务
```bash
systemctl restart patent-app
```

### 查看进程
```bash
ps aux | grep gunicorn
```

## 回滚方案

如果更新后出现问题，可以回滚到上一个版本：

```bash
ssh root@43.99.101.195
su - appuser
cd ~/patent-app
git log --oneline -5  # 查看最近5次提交
git reset --hard 7e3d8bc  # 回滚到上一个版本
exit
systemctl restart patent-app
```

## 文件清单

### 新增文件
- `test_drawings_scraper.py` - 附图测试脚本
- `功能六增强完成_附图和进阶信息.md` - 功能文档
- `update_aliyun_now.bat` - 快速更新脚本
- `功能六更新部署说明.md` - 本文档

### 修改文件
- `backend/scraper/simple_scraper.py` - 爬虫增强
- `js/main.js` - 前端显示和复制功能

## 验收标准

- ✅ 附图能够正常显示
- ✅ 点击附图可以查看原图
- ✅ 每个字段的复制按钮正常工作
- ✅ 勾选"获取说明书字段"后能看到进阶信息
- ✅ 进阶信息表格正常显示
- ✅ 进阶信息可以复制

## 联系方式

如有问题，请联系：
- 邮箱：freecasafred@outlook.com
- GitHub Issues：提交到项目仓库

---

**部署完成时间**：待执行  
**部署人员**：待确认  
**测试状态**：待测试
